{
  "info": {
    "id": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
    "slug": "clever-garden",
    "projectID": "f517a0bef81c29b0d2894d744fb137e5c4dc0dfc",
    "directory": "/home/kas/dev/kasmos",
    "title": "Custom /kas.verify tiered PR review process",
    "version": "1.2.15",
    "summary": {
      "additions": 41,
      "deletions": 18,
      "files": 3
    },
    "time": {
      "created": 1772231145775,
      "updated": 1772231241987
    }
  },
  "messages": [
    {
      "info": {
        "role": "user",
        "time": {
          "created": 1772231145811
        },
        "summary": {
          "diffs": []
        },
        "agent": "coder",
        "model": {
          "providerID": "anthropic",
          "modelID": "claude-sonnet-4-6"
        },
        "variant": "medium",
        "id": "msg_ca13539410013MlZqwtGqx2TBW",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "text",
          "text": "Implement implement-a-custom-kas-verify-tiered-review-process-for. Goal: implement a custom /kas.verify tiered review process for PRs (evaluate using codex code review or some other github integration to use specific skills/review process we need to research it). this should trigger for new prs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?).",
          "id": "prt_ca1353941002TKT5vAU9rFQb7Q",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca13539410013MlZqwtGqx2TBW"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231145819,
          "completed": 1772231149161
        },
        "parentID": "msg_ca13539410013MlZqwtGqx2TBW",
        "modelID": "claude-sonnet-4-6",
        "providerID": "anthropic",
        "mode": "coder",
        "agent": "coder",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 27316,
          "input": 3,
          "output": 136,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 27177
          }
        },
        "variant": "medium",
        "finish": "tool-calls",
        "id": "msg_ca135395b0019DsbNv0pL0qyJb",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "cc1abc6f4cca52b90ac9dd1e2b9110cd97b1f4b8",
          "id": "prt_ca1353fbb001rgFDgMMXZjmMaL",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135395b0019DsbNv0pL0qyJb"
        },
        {
          "type": "reasoning",
          "text": "Let me start by loading the kasmos-coder skill as instructed, along with the cli-tools skill.",
          "metadata": {
            "anthropic": {
              "signature": "EoUCCkYICxgCKkD5gADJAk6s/REDACTED/REDACTED/REDACTED/REDACTED"
            }
          },
          "time": {
            "start": 1772231147452,
            "end": 1772231148608
          },
          "id": "prt_ca1353fbc001OJ3oObtpBd5FXb",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135395b0019DsbNv0pL0qyJb"
        },
        {
          "type": "tool",
          "callID": "toolu_01T5QHC3tiAATc6RrrnHkkwa",
          "tool": "skill",
          "state": {
            "status": "completed",
            "input": {
              "name": "kasmos-coder"
            },
            "output": "<skill_content name=\"kasmos-coder\">\n# Skill: kasmos-coder\n\n# kasmos-coder\n\nYou implement code. One task (managed) or a full plan sequentially (manual). Your disciplines are TDD, systematic debugging, evidence-first verification, and safe shared-worktree hygiene. Review feedback gets technical evaluation, not performative agreement.\n\n---\n\n## CLI Tools Hard Gate\n\n<HARD-GATE>\n### Banned Tools\n\nThese legacy tools are NEVER permitted. Using them is a violation, not a preference.\n\n| Banned | Replacement | No Exceptions |\n|--------|-------------|---------------|\n| `grep` | `rg` (ripgrep) | Even for simple one-liners |\n| `grep -r` | `rg` | Recursive grep is still grep |\n| `grep -E` | `rg` | Extended regex is still grep |\n| `sed` | `sd` | Even for one-liners |\n| `awk` | `yq`/`jq` (structured) or `sd` (text) | No awk for any purpose |\n| `find` | `fd` or glob tools | Even for simple file listing |\n| `diff` (standalone) | `difft` | `git diff` is fine — standalone `diff` is not |\n| `wc -l` | `scc` | Even for single files |\n\n**`git diff` is allowed** — it's a git subcommand, not standalone `diff`.\n\n**STOP.** If you are about to type `grep`, `sed`, `awk`, `find`, `diff`, or `wc` — stop. There are no exceptions.\n</HARD-GATE>\n\n### Tool Selection\n\n| Task | Use | Not |\n|------|-----|-----|\n| Find literal string | `rg` | `grep` |\n| Find files by name/ext | `fd` | `find` |\n| Replace string in files | `sd` | `sed` |\n| Rename symbol across files | `ast-grep` | `sed`/`sd` |\n| Structural code rewrite | `comby` | `sed`/`awk` |\n| Find code pattern | `ast-grep --pattern` | `rg` |\n| Read/modify YAML/TOML/JSON | `yq` / `jq` | `sed`/`awk` |\n| Review code changes | `difft` | `diff` |\n| Spell check code | `typos` | manual |\n| Count lines / codebase metrics | `scc` | `wc -l` |\n\n---\n\n## Where You Fit\n\n### Env Vars\n\n| Variable | Meaning |\n|----------|---------|\n| `KASMOS_MANAGED` | Set to `1` when kasmos TUI spawned you. Unset in raw terminal. |\n| `KASMOS_TASK` | The task number you're assigned (managed only). |\n| `KASMOS_WAVE` | The wave number (managed only). |\n| `KASMOS_PEERS` | Number of sibling agents running in parallel. `0` or unset = solo. |\n\n### Managed (`KASMOS_MANAGED=1`)\n\nkasmos spawned you to implement **one specific task** identified by `KASMOS_TASK`. Your scope:\n\n1. Read the plan file from `docs/plans/`. Find your wave (`KASMOS_WAVE`) and task (`KASMOS_TASK`).\n2. Implement that single task following TDD discipline below.\n3. Commit your work with task number in the commit message.\n4. Write the implement-finished sentinel (see **Signaling** section).\n5. **Stop.** Do not implement other tasks — they belong to sibling agents or future waves.\n\n### Manual (KASMOS_MANAGED unset)\n\nYou execute the full plan sequentially, wave by wave:\n\n1. Read the plan. Check its **Size** field to determine wave structure.\n2. Create a todo list with one item per task (all `pending`), then begin.\n3. Execute one wave at a time: implement each task (TDD), commit, then proceed to next task.\n4. After each wave completes, self-review before starting the next wave.\n5. When all waves complete, write the implement-finished sentinel (see **Signaling**).\n\n---\n\n## TDD Discipline\n\n### The Iron Law\n\n```\nNO PRODUCTION CODE WITHOUT A FAILING TEST FIRST\n```\n\nWrote code before writing the test? Delete it. Start over from the test. No exceptions:\n- Don't keep it \"for reference\" — you'll adapt it, which is testing after\n- Don't \"adapt\" it while writing tests — delete means delete\n- Implement fresh from tests\n\n### RED → GREEN → REFACTOR\n\n**RED — Write the failing test**\n\nWrite one minimal test showing the required behavior. Run it. Confirm:\n- Test actually fails (not errors from syntax — a genuine test failure)\n- Failure message is the expected one (\"function not found\", \"assertion error\")\n- Test fails because the feature is missing, not a typo\n\n**Never skip the RED verification.** If the test passes immediately, you are testing existing behavior. Fix the test.\n\n**GREEN — Minimal implementation**\n\nWrite the simplest code that makes the test pass. Don't add features. Don't refactor other code. Don't \"improve\" beyond what the test requires. Verify:\n- Your test passes\n- All other tests still pass\n- No new errors or warnings\n\n**REFACTOR — Clean up**\n\nOnly after green: remove duplication, improve names, extract helpers. Never add behavior during refactor. Keep tests green throughout.\n\n**Repeat** — one test per behavior. When the task is fully implemented, all new tests are green and no existing tests are broken.\n\n### Red Flags — STOP and Start Over\n\n| Thought | Action |\n|---------|--------|\n| \"I'll write tests after to verify it works\" | Delete code, write test first |\n| \"Too simple to need a test\" | Write the test — it takes 30 seconds |\n| \"I already manually tested it\" | Manual ≠ systematic. Write the test |\n| \"I'll keep this code as reference\" | Delete it. Keeping = adapting = testing after |\n| \"TDD will slow me down\" | Debugging later is slower. Write the test |\n| \"Just this once\" | Not a valid exception |\n\n---\n\n## Shared Worktree Safety\n\nWhen `KASMOS_PEERS > 0`, sibling agents are modifying this worktree concurrently.\n\n**Never:**\n- `git add .` or `git add -A` — you will stage a sibling's in-progress files\n- `git stash` — you will destroy sibling's uncommitted changes\n- `git reset` — you will destroy sibling's uncommitted changes\n- `git checkout -- <file>` on files you didn't modify — you will revert a sibling's edits\n- Run project-wide formatters (`go fmt ./...`, `prettier --write .`) — scope to your files only\n- Run project-wide linters across files you didn't touch\n\n**Always:**\n- `git add <specific-files>` — only the files you changed\n- Include task number in every commit message: `feat(task-6): add kasmos-coder skill`\n- Expect untracked files and dirty state from siblings — ignore them\n- Run tests scoped to your changed packages where possible before committing\n\n**When you see test failures in files outside your task scope:** Do not attempt to fix them. They may be caused by incomplete parallel work from a sibling agent. Report the failure context in your signal and stop.\n\n---\n\n## Debugging Discipline\n\nWhen tests fail, builds break, or behavior is unexpected — investigate before proposing fixes. Random patches mask the actual problem and create new ones.\n\n### The Four Phases\n\n**Phase 1 — Root Cause Investigation**\n\nBefore attempting any fix:\n1. Read error messages completely — stack traces, line numbers, error codes\n2. Reproduce the failure consistently — what exact steps trigger it?\n3. Check recent changes — git diff, recent commits, env differences\n4. In multi-component systems: add diagnostic instrumentation at each boundary to find exactly where it breaks. Run once to gather evidence, then analyze.\n5. Trace data flow — where does the bad value originate? Trace backward up the call stack to the source.\n\n**Phase 2 — Pattern Analysis**\n\nFind working examples in the codebase doing something similar. Compare them against the broken code. List every difference — don't assume \"that can't matter.\" Understand all dependencies (config, env, state).\n\n**Phase 3 — Hypothesis and Testing**\n\nForm one specific hypothesis: \"I think X is the root cause because Y.\" Test it with the smallest possible change. One variable at a time. Verify — did it work? If not, form a new hypothesis. Don't stack fixes.\n\n**Phase 4 — Implementation**\n\nWrite a failing test reproducing the bug first (TDD discipline applies to bugfixes). Implement the single fix addressing the root cause. Verify the test now passes and no other tests regressed.\n\n**If the fix doesn't work:** Return to Phase 1. Re-analyze with new information.\n\n**If 3 fixes have failed:** STOP. Question the architecture — each fix revealing a new problem in a different place is an architectural signal, not a debugging problem. Escalate or document the situation rather than attempting fix #4.\n\n### Red Flags — Return to Phase 1\n\n- \"Quick fix for now, investigate later\"\n- \"Just try changing X and see if it works\"\n- \"It's probably X, let me fix that\"\n- \"I don't fully understand but this might work\"\n- Proposing solutions before tracing data flow\n- \"One more fix attempt\" (when you've already tried 2+)\n- Each fix reveals a new problem in a different place\n\n---\n\n## Verification\n\nBefore claiming a task is complete, before committing, before writing the finished sentinel:\n\n### The Gate\n\n```\n1. IDENTIFY: What command proves this works?\n2. RUN: Execute it fresh. Complete output.\n3. READ: Full output. Check exit code. Count failures.\n4. VERIFY: Does output confirm the claim?\n   - If NO: State actual status with evidence.\n   - If YES: State claim WITH evidence.\n5. ONLY THEN: Claim completion.\n```\n\nSkipping any step is not verification — it's guessing.\n\n### Common Verification Commands\n\n```bash\n# Go\ngo build ./...\ngo test ./...\ngo test ./path/to/package/...   # scoped — preferred in shared worktree\n\n# Node\nnpm test\nnpm run build\n\n# Python\npytest\npytest path/to/tests/\n\n# General\ngo vet ./...\ntypos                            # spell check before committing\n```\n\n### Red Flags — STOP\n\n- Using \"should\", \"probably\", \"seems to\" before verification\n- Claiming tests pass without running them in this message\n- Trusting previous run output — always run fresh\n- Expressing satisfaction (\"Done!\", \"Perfect!\") before the verification command output is in view\n- Committing without a clean build\n\n---\n\n## Handling Reviewer Feedback\n\nCode review requires technical evaluation, not performative agreement.\n\n### Response Pattern\n\n```\n1. READ: Complete feedback without reacting\n2. UNDERSTAND: Restate the technical requirement (or ask if unclear)\n3. VERIFY: Check against the actual codebase\n4. EVALUATE: Is this technically sound for THIS codebase?\n5. RESPOND: Technical acknowledgment, or reasoned pushback with evidence\n6. IMPLEMENT: One item at a time, test each\n```\n\n### Forbidden Responses\n\n**Never:**\n- \"You're absolutely right!\" — performative\n- \"Great point!\" / \"Excellent feedback!\" — performative\n- \"Let me implement that now\" — before verification\n\n**Instead:**\n- Restate the technical requirement\n- Ask for clarification if anything is unclear\n- Push back with technical reasoning if the suggestion is wrong\n- Just start working — actions over words\n\n### Before Implementing Any Item\n\n- Unclear about any item? **Stop. Ask for clarification on all unclear items first.** Do not implement partial feedback — items may be related.\n- Does it break existing functionality? Verify before proceeding.\n- Does it violate YAGNI? Check if the feature is actually used (`rg` in codebase).\n- Does it conflict with architectural decisions already made? Escalate rather than blindly implement.\n\n### When to Push Back\n\nPush back when:\n- The suggestion breaks existing functionality (show the test)\n- The reviewer lacks full context for the decision\n- It violates YAGNI (feature not used anywhere)\n- It's technically incorrect for this stack/version\n- It conflicts with established architectural decisions\n\n**How:** Technical reasoning, not defensiveness. Reference working tests. Reference the code.\n\n### Implementation Order\n\nFor multi-item feedback:\n1. Clarify all unclear items first\n2. Blocking issues (breaks, security holes)\n3. Simple fixes (typos, wrong identifiers, missing imports)\n4. Complex fixes (refactoring, logic changes)\n5. Test each fix individually before moving to the next\n6. Verify no regressions after all items complete\n\n### Acknowledging Correct Feedback\n\n```\n✅ \"Fixed. [One sentence describing the change]\"\n✅ \"Good catch — [specific issue]. Fixed in [location].\"\n✅ [Just fix it. The code shows you heard the feedback.]\n\n❌ \"You're absolutely right!\"\n❌ \"Thanks for catching that!\"\n❌ Any gratitude expression\n```\n\n---\n\n## Signaling\n\n### Managed (`KASMOS_MANAGED=1`)\n\nAfter implementing and verifying your assigned task:\n\n```bash\ntouch docs/plans/.signals/implement-finished-<date>-<planfilename>.md\n```\n\nThe filename matches the plan filename exactly. Example:\n```bash\ntouch docs/plans/.signals/implement-finished-2026-02-27-kasmos-native-skills.md\n```\n\n**Do not edit `plan-state.json` directly** — kasmos reads sentinel files and transitions state.\n\nAfter writing the sentinel: **stop.** Do not implement other tasks, do not invoke branch finishing — kasmos handles orchestration.\n\n### Manual (KASMOS_MANAGED unset)\n\nExecute waves sequentially:\n\n1. Implement all tasks in Wave 1 (TDD, commit each task)\n2. Self-review Wave 1 before proceeding — run full tests, check for regressions\n3. Implement Wave 2, self-review, continue through all waves\n4. After all waves complete and all tests pass:\n\n```bash\n# Update plan-state.json — set the plan to \"reviewing\"\n# Read the file first, then edit the status field for this plan entry\n```\n\nThen handle branch finishing — present these options to the user:\n\n```\nimplementation complete. what would you like to do?\n\n1. merge back to <base-branch> locally\n2. push and create a pull request\n3. keep the branch as-is (handle it later)\n4. discard this work\n\nwhich option?\n```\n\n**Option 1 — Merge locally:**\n```bash\ngit checkout <base-branch>\ngit pull\ngit merge <feature-branch>\n<run tests on merged result>\ngit branch -d <feature-branch>\ngit worktree remove <worktree-path>\n```\n\n**Option 2 — Push and create PR:**\n```bash\ngit push -u origin <feature-branch>\ngh pr create --title \"<title>\" --body \"$(cat <<'EOF'\n## summary\n- <what changed>\n- <why>\n\n## test plan\n- [ ] <verification steps>\nEOF\n)\"\n```\nKeep the worktree until the PR merges.\n\n**Option 3 — Keep as-is:** Report path. Don't clean up. Don't update plan state.\n\n**Option 4 — Discard:** Confirm first with exact text `discard`. Then:\n```bash\ngit checkout <base-branch>\ngit branch -D <feature-branch>\ngit worktree remove <worktree-path>\n```\n\nUpdate `plan-state.json` to `\"done\"` after options 1, 2, or 4.\n\n---\n\n## Common Mistakes\n\n| Mistake | Fix |\n|---------|-----|\n| Writing production code before a failing test | Delete the code, write the test first |\n| Claiming tests pass without running them | Run the command, read the output |\n| `git add .` in a shared worktree | `git add <specific-files>` only |\n| Attempting fix #4 after 3 have failed | Stop — it's architecture, not a bug |\n| Performative agreement with reviewer | Technical verification, then act |\n| Implementing unclear review feedback | Ask for clarification on ALL unclear items first |\n| Running project-wide formatters | Scope formatters to your changed files only |\n| Editing `plan-state.json` when `KASMOS_MANAGED=1` | Write sentinel file instead |\n| Implementing sibling tasks in managed mode | Implement ONE task (KASMOS_TASK), then signal and stop |\n\nBase directory for this skill: file:///home/kas/dev/kasmos/.opencode/skills/kasmos-coder\nRelative paths in this skill (e.g., scripts/, reference/) are relative to this base directory.\nNote: file list is sampled.\n\n<skill_files>\n\n</skill_files>\n</skill_content>",
            "title": "Loaded skill: kasmos-coder",
            "metadata": {
              "name": "kasmos-coder",
              "dir": "/home/kas/dev/kasmos/.opencode/skills/kasmos-coder",
              "truncated": false
            },
            "time": {
              "start": 1772231148864,
              "end": 1772231148869
            }
          },
          "id": "prt_ca1354440001KButx2XVCyUus1",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135395b0019DsbNv0pL0qyJb"
        },
        {
          "type": "tool",
          "callID": "toolu_0165XNQbdUVVRcuVcVj2B75g",
          "tool": "skill",
          "state": {
            "status": "completed",
            "input": {
              "name": "cli-tools"
            },
            "output": "<skill_content name=\"cli-tools\">\n# Skill: cli-tools\n\n# CLI Tools\n\nModern CLI tools that replace legacy unix utilities for code-related tasks. These tools understand syntax, structure, and context — producing safer, faster, and more accurate results than regex-based alternatives.\n\n<HARD-GATE>\n## Banned Tools\n\nThese legacy tools are NEVER permitted. Using them is a violation, not a preference.\n\n| Banned | Replacement | No Exceptions |\n|--------|-------------|---------------|\n| `grep` | `rg` (ripgrep) | Even for simple one-liners. `rg` is faster, respects .gitignore, and handles encoding correctly |\n| `grep -r` | `rg` | Recursive grep is still grep. Always `rg` |\n| `grep -E` | `rg` | Extended regex is still grep. `rg` supports the same patterns |\n| `sed` | `sd` | Even for one-liners. `sd` has saner syntax and no delimiter escaping |\n| `awk` | `yq`/`jq` (structured) or `sd` (text) | No awk for any purpose |\n| `find` | `fd` or glob tools | Even for simple file listing. `fd` respects .gitignore; use `fd -e go` for extension |\n| `diff` (standalone) | `difft` | `git diff` is fine — standalone `diff` is not |\n| `wc -l` | `scc` | Even for single files |\n\n**`git diff` is allowed** — it's a git subcommand, not standalone `diff`. Use `GIT_EXTERNAL_DIFF=difft git diff` when reviewing code changes.\n\n**STOP.** If you are about to type `grep`, `sed`, `awk`, `find`, `diff`, or `wc` — stop and use the replacement. There are no exceptions. \"Just this once\" is a violation.\n</HARD-GATE>\n\n## Tool Selection by Task\n\nPick the right tool for the job. When multiple tools could work, the table shows the preferred choice and why.\n\n| Task | Use | Not | Why |\n|------|-----|-----|-----|\n| Rename symbol across files | `ast-grep` | `sed`/`sd` | AST-aware, won't rename inside strings/comments |\n| Structural code rewrite | `comby` | `sed`/`awk` | Understands balanced delimiters, nesting |\n| Find code pattern | `ast-grep --pattern` | `grep`/`rg` | Matches syntax, not text |\n| Find literal string | `rg` | `grep` | Fast, respects .gitignore, correct encoding |\n| Find files by name/extension | `fd` | `find` | Respects .gitignore, simpler syntax |\n| Replace string in files | `sd` | `sed` | No delimiter escaping, sane defaults |\n| Read/modify YAML/TOML/JSON | `yq` / `jq` | `sed`/`awk` | Understands structure, preserves formatting |\n| Review code changes | `difft` | `diff` | Syntax-aware, ignores formatting noise |\n| Spell check code | `typos` | manual | Understands camelCase, identifiers |\n| Count lines / codebase metrics | `scc` | `wc -l`/`cloc` | Fast, includes complexity estimates |\n| Multi-line structural rewrite | `comby` | `sed` | Handles cross-line patterns with holes |\n| Add/change function params | `comby` | manual | `func F(:[params])` patterns |\n| Simple literal find-replace | `sd` | `sed` | Simpler syntax, in-place by default |\n\n## ast-grep vs comby Decision\n\nBoth do structural code operations. Choose based on the transformation:\n\n| Scenario | Winner | Reason |\n|----------|--------|--------|\n| Rename all calls to a function | ast-grep | AST-level symbol matching |\n| Find all usages of a pattern | ast-grep | Tree-sitter precision |\n| Add/change function parameters | comby | Hole syntax `:[params]` is natural |\n| Replace entire function body | comby | `{:[_]}` discards balanced block |\n| Insert code after a function | comby | Match + append in rewrite |\n| Add to import block | comby | `import (:[imports])` pattern |\n| Multi-line structural rewrite | comby | Balanced delimiter matching |\n| Lint-style pattern detection | ast-grep | Rule-based scanning |\n\n## Quick Reference\n\n### rg (ripgrep)\n\nFast text search that respects .gitignore. Primary replacement for all `grep` variants.\n\n```bash\nrg 'pattern' [path]                            # basic search (recursive by default)\nrg 'pattern' --type go                         # filter by language type\nrg 'pattern' -g '*.go'                         # filter by glob\nrg 'pattern' -g '*.go' -g '!*_test.go'         # include/exclude globs\nrg -i 'pattern'                                # case insensitive\nrg -F 'literal[0]'                             # fixed string (no regex)\nrg -U 'start\\n.*end'                           # multiline match\nrg -l 'pattern'                                # list matching files only\nrg -c 'pattern'                                # count matches per file\nrg --no-heading -n 'pattern'                   # machine-readable output (file:line:match)\n```\n\n**In-depth reference:** [resources/rg.md](resources/rg.md)\n\n### ast-grep (`ast-grep`)\n\nAST-based code search and replace using tree-sitter. Matches syntax structure, not text.\n\n```bash\nast-grep run --pattern 'fmt.Errorf($$$)' --lang go          # find all calls\nast-grep run --pattern 'errors.New($A)' --rewrite 'fmt.Errorf($A)' --lang go  # replace\nast-grep run --pattern '$A != nil' --lang go src/            # search specific path\n```\n\nKey patterns: `$VAR` (single node), `$$$` (variable-length args), `$_` (wildcard)\n\n**In-depth reference:** [resources/ast-grep.md](resources/ast-grep.md)\n\n### comby (`comby`)\n\nStructural search/replace that understands balanced delimiters, strings, and comments. Superior to regex for multi-line code transformations.\n\n```bash\ncomby 'func :[name](:[args]) {:[body]}' 'func :[name](:[args]) error {:[body]}' .go -in-place\ncomby 'import (:[imports])' 'import (:[imports]\n\t\"new/package\"\n)' file.go -in-place\n```\n\n**Critical rule:** Always use `{:[body]}` (inline braces), never split `{` and `}` on separate lines.\n\nKey holes: `:[var]` (everything), `:[[var]]` (word), `:[_]` (unnamed wildcard), `:[var\\n]` (to newline)\n\n**In-depth reference:** [resources/comby.md](resources/comby.md) — read this before any non-trivial comby usage. Contains critical pitfalls around whitespace normalization and balanced delimiter matching.\n\n### difftastic (`difft`)\n\nSyntax-aware structural diff. Dramatically cleaner output for refactors and moves.\n\n```bash\ndifft old.go new.go                              # compare files\nGIT_EXTERNAL_DIFF=difft git diff                  # git integration\nGIT_EXTERNAL_DIFF=difft git log -p -- path/file   # file history\ndifft --display inline old.go new.go              # single-column output\n```\n\n**In-depth reference:** [resources/difftastic.md](resources/difftastic.md)\n\n### sd (`sd`)\n\nModern sed alternative. In-place by default, no delimiter escaping needed.\n\n```bash\nsd 'old_name' 'new_name' src/**/*.go              # replace in files\nsd 'version = \"(\\d+)\"' 'version = \"2\"' file.toml  # regex with groups\nsd -p 'foo' 'bar' file.txt                         # preview (dry run)\nsd -F 'literal[0]' 'replacement' file.txt          # fixed string mode\n```\n\n**In-depth reference:** [resources/sd.md](resources/sd.md)\n\n### yq (`yq`)\n\nYAML/JSON processor (jq wrapper for YAML). Query and modify structured config files.\n\n```bash\nyq '.metadata.name' file.yaml                     # read field\nyq -y '.key = \"value\"' file.yaml                   # modify YAML\nyq -y '.dependencies += {\"new\": \"^1.0\"}' pkg.yaml  # add to map\ncat file.yaml | yq '.items[].name'                 # query array\n```\n\nNote: This is the Python-based `yq` (kislyuk/yq), a jq wrapper. Uses jq filter syntax. Use `-y` flag for YAML output, otherwise outputs JSON.\n\n**In-depth reference:** [resources/yq.md](resources/yq.md)\n\n### typos (`typos`)\n\nFast source code spell checker. Understands identifiers, camelCase, filenames.\n\n```bash\ntypos                          # check entire project\ntypos src/                     # check specific path\ntypos --write-changes          # auto-fix typos\ntypos --format brief           # compact output\n```\n\nRun before commits to catch typos in identifiers, strings, and comments.\n\n**In-depth reference:** [resources/typos.md](resources/typos.md)\n\n### scc (`scc`)\n\nFast code counter with complexity estimates. Useful for project scope assessment.\n\n```bash\nscc                                  # full project summary\nscc internal/                        # specific directory\nscc --by-file --sort lines           # per-file breakdown\nscc --not-match '_test.go$'          # exclude test files\nscc --include-ext go,ts              # specific languages only\n```\n\n**In-depth reference:** [resources/scc.md](resources/scc.md)\n\n## Violations\n\nThese violations are not suggestions. If you do any of these, you are violating the skill.\n\n| Violation | Required Fix |\n|-----------|-------------|\n| Using `grep` for anything | Use `rg` for text search, `ast-grep` for code patterns |\n| Using `grep -r` (recursive) | Use `rg` — recursive by default, also respects .gitignore |\n| Using `grep -E` (extended regex) | Use `rg` — supports full regex including extended patterns |\n| Using `sed` for anything | Use `sd` for replacements, `ast-grep`/`comby` for refactoring |\n| Using `awk` for anything | Use `yq`/`jq` for structured data, `sd` for text processing |\n| Using `find` for anything | Use `fd` for file finding, glob tools for path patterns |\n| Using standalone `diff` | Use `difft` for syntax-aware structural diffs |\n| Using `wc -l` for counting | Use `scc` for language-aware counts + complexity |\n| Splitting `{` / `}` in comby templates | Always inline: `{:[body]}` not `{\\n:[body]\\n}` |\n| Forgetting `-in-place` with comby | Without it, comby only previews changes |\n\nBase directory for this skill: file:///home/kas/dev/kasmos/.opencode/skills/cli-tools\nRelative paths in this skill (e.g., scripts/, reference/) are relative to this base directory.\nNote: file list is sampled.\n\n<skill_files>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/yq.md</file>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/typos.md</file>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/sd.md</file>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/scc.md</file>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/difftastic.md</file>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/comby.md</file>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/ast-grep.md</file>\n<file>/home/kas/dev/kasmos/.opencode/skills/cli-tools/resources/rg.md</file>\n</skill_files>\n</skill_content>",
            "title": "Loaded skill: cli-tools",
            "metadata": {
              "name": "cli-tools",
              "dir": "/home/kas/dev/kasmos/.opencode/skills/cli-tools",
              "truncated": false
            },
            "time": {
              "start": 1772231149124,
              "end": 1772231149129
            }
          },
          "id": "prt_ca135454100192s6X1UMp40GnA",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135395b0019DsbNv0pL0qyJb"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "cc1abc6f4cca52b90ac9dd1e2b9110cd97b1f4b8",
          "cost": 0,
          "tokens": {
            "total": 27316,
            "input": 3,
            "output": 136,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 27177
            }
          },
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135395b0019DsbNv0pL0qyJb"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231149162,
          "completed": 1772231157314
        },
        "error": {
          "name": "MessageAbortedError",
          "data": {
            "message": "The operation was aborted."
          }
        },
        "parentID": "msg_ca13539410013MlZqwtGqx2TBW",
        "modelID": "claude-sonnet-4-6",
        "providerID": "anthropic",
        "mode": "coder",
        "agent": "coder",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "input": 0,
          "output": 0,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 0
          }
        },
        "variant": "medium",
        "id": "REDACTED",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "cc1abc6f4cca52b90ac9dd1e2b9110cd97b1f4b8",
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "reasoning",
          "text": "",
          "time": {
            "start": 1772231150139
          },
          "id": "prt_ca1354a3b002gZMrP5ia3Dbv3g",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "patch",
          "hash": "cc1abc6f4cca52b90ac9dd1e2b9110cd97b1f4b8",
          "files": [
            "/home/kas/dev/kasmos/ui/navigation_panel.go"
          ],
          "id": "prt_ca13566410019b12S9siJhUrwR",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        }
      ]
    },
    {
      "info": {
        "role": "user",
        "time": {
          "created": 1772231173760
        },
        "summary": {
          "diffs": [
            {
              "file": "docs/plans/plan-state.json",
              "before": "{\n  \"topics\": {\n    \"automation\": {\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"sidebar\": {\n      \"created_at\": \"2026-02-22T18:00:00Z\"\n    },\n    \"tools\": {\n      \"created_at\": \"2026-02-24T20:03:01Z\"\n    },\n    \"ui\": {\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"verify\": {\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"workflow\": {\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    }\n  },\n  \"plans\": {\n    \"2026-02-20-kq-init-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-plan-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-plan-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-project-skills-distribution.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-tool-discovery-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-wizard-ux-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-wizard-ux.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-agent-customize-gate.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-naming-and-toast-wrap.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-generate-opencode-jsonc-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-generate-opencode-jsonc.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-global-skill-sync.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-init-wizard-refinements.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-plan-centric-sidebar.md\": {\n      \"status\": \"cancelled\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-instance-grouping.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-lifecycle-sessions.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-rose-pine-moon-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-rose-pine-moon.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-nav-showhide.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-topics-as-collision-domains-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-topics-collision-domains.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-22-1a-tree-renderer.md\": {\n      \"status\": \"done\",\n      \"description\": \"tree-mode rendering branch in Sidebar.String() with indentation, chevrons, and status glyphs\",\n      \"branch\": \"kas/1a-tree-renderer-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1b-tree-navigation.md\": {\n      \"status\": \"done\",\n      \"description\": \"Left/Right tree-traversal methods and Space/Enter/arrow keybindings for tree-mode sidebar\",\n      \"branch\": \"kas/1b-tree-navigation-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1c-highlight-boost-list.md\": {\n      \"status\": \"done\",\n      \"description\": \"highlight-boost instance list with partition sort and dimmed rendering for non-matching instances\",\n      \"branch\": \"plan/1c-highlight-boost-list\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-2-tree-mode-wiring.md\": {\n      \"status\": \"done\",\n      \"description\": \"wire tree renderer, navigation, and highlight-boost together; remove DisableTreeMode gate\",\n      \"branch\": \"plan/2-tree-mode-wiring\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-async-metadata-tick.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-center-col-v-align.md\": {\n      \"status\": \"done\",\n      \"description\": \"center column is scrolled up slightly and also not bottom aligned\",\n      \"branch\": \"plan/center-col-v-align\",\n      \"created_at\": \"2026-02-22T08:33:42.034471509Z\"\n    },\n    \"2026-02-22-center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet.md\": {\n      \"status\": \"cancelled\",\n      \"branch\": \"plan/center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet\",\n      \"created_at\": \"2026-02-22T08:30:57.806756006Z\"\n    },\n    \"2026-02-22-customize-superpowers.md\": {\n      \"status\": \"done\",\n      \"description\": \"streamline interactions with superpowers and this app by personalizing the superpowers skills\",\n      \"branch\": \"plan/customize-superpowers\",\n      \"created_at\": \"2026-02-22T10:10:09.111289772Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-22-detect-permissions-needed.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"indicate in list view if permissions are needed and switch to live capture (or increased cache r/w if possible) to button presses dont jump back and forth\",\n      \"branch\": \"plan/detect-permissions-needed\",\n      \"created_at\": \"2026-02-22T08:35:22.645408061Z\"\n    },\n    \"2026-02-22-disable-cache-focused.md\": {\n      \"status\": \"done\",\n      \"description\": \"disable cache reading and poll tmux pane directly when focused to improve interactive experience (it glitches a lot currently)\",\n      \"branch\": \"plan/disable-cache-focused\",\n      \"created_at\": \"2026-02-22T09:56:55.401392089Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-dupe-task-after-plan-change.md\": {\n      \"status\": \"done\",\n      \"description\": \"i marked another plan done and suddenly i had 2 of another one that was running even though it hasn't switched to a review agent yet\",\n      \"branch\": \"plan/dupe-task-after-plan-change\",\n      \"created_at\": \"2026-02-22T10:00:27.703574166Z\"\n    },\n    \"2026-02-22-kq-check.md\": {\n      \"status\": \"done\",\n      \"description\": \"kq check command to audit skills sync health across all three layers (global, project, superpowers)\",\n      \"created_at\": \"2026-02-22T09:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-parallelize-superpowers.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"extract any parallelization opportunities by controlling individual task fixes (use new agent for each even if sequential)\",\n      \"branch\": \"plan/parallelize-superpowers\",\n      \"created_at\": \"2026-02-22T10:04:55.567483368Z\"\n    },\n    \"2026-02-22-planner-exit-prompt.md\": {\n      \"status\": \"done\",\n      \"description\": \"show confirmation dialog when planner finishes asking whether to start implementation\",\n      \"created_at\": \"2026-02-22T13:00:00Z\",\n      \"implemented\": \"2026-02-23\"\n    },\n    \"2026-02-22-remove-right-sidbar-right-to-focus-session.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/remove-right-sidbar-right-to-focus-session\",\n      \"created_at\": \"2026-02-22T12:15:27.104776176Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-rename-to-kasmos.md\": {\n      \"status\": \"done\",\n      \"description\": \"switch name back to kasmos and overtake that repo (rename that one to kasmold first)\",\n      \"branch\": \"plan/rename-to-kasmos\",\n      \"created_at\": \"2026-02-22T09:53:24.333455818Z\"\n    },\n    \"2026-02-22-shorten-cta.md\": {\n      \"status\": \"done\",\n      \"description\": \"drop plan from first part of cta below ascii art\",\n      \"branch\": \"plan/shorten-cta\",\n      \"created_at\": \"2026-02-22T09:54:49.026733734Z\"\n    },\n    \"2026-02-22-tab-focus-ring.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement 5-slot Tab focus ring: key defs, focusSlot state, key routing, tests, gradient, help\",\n      \"created_at\": \"2026-02-22T18:45:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-update-shortcut-hints.md\": {\n      \"status\": \"done\",\n      \"description\": \"D kill becomes K kill. i focus agent to i interactive mode. space actions becomes space shortcuts. hide P create PR and c checkout, remove R switch repo, keep the rest.\",\n      \"branch\": \"plan/update-shortcut-hints\",\n      \"created_at\": \"2026-02-22T12:12:58.588910211Z\"\n    },\n    \"2026-02-22-wave-orchestration.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement wave orchestration: plan parser, instance fields, orchestrator state machine, validation gate, prompt builder, wiring, wave badge\",\n      \"branch\": \"plan/wave-orchestration\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-23-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"description\": \"centralized FSM for plan lifecycle with flock serialization and agent sentinel files\",\n      \"branch\": \"plan/plan-state-machine\",\n      \"created_at\": \"2026-02-23T14:00:00Z\"\n    },\n    \"2026-02-23-update-ascii-art.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace KLIQUE ascii art banner with KASMOS using same ANSI Shadow font\",\n      \"branch\": \"plan/update-ascii-art\",\n      \"created_at\": \"2026-02-23T18:00:00Z\"\n    },\n    \"2026-02-24-add-episodic-memory.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"add episodic memory as a default skill when running init scaffolding command — shelved: none of the available memory plugins (episodic-memory, psychmem, hmem) are mature enough for dual-harness use yet\",\n      \"branch\": \"plan/add-episodic-memory\",\n      \"created_at\": \"2026-02-24T03:50:07.986559175Z\"\n    },\n    \"2026-02-24-clickup-import.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a feature for importing clickup tasks as plans using the official MCP server. this feature is optional and is only available when the clickup mcp server is detected. have it be an option at the bottom the plans list above history (+ import from clickup) or something like that. once the task details are downloaded, run the plan through superpowers brainstorming using a planning agent automatically to determine if it's ready for implementation or needs to be fleshed out.\",\n      \"branch\": \"plan/clickup-import\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T02:44:43.679630782Z\"\n    },\n    \"2026-02-24-live-preview-terminal.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace capture-pane polling with live EmbeddedTerminal VT emulator in preview pane, unify with focus mode\",\n      \"branch\": \"plan/live-preview-terminal\",\n      \"created_at\": \"2026-02-24T18:00:00Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-24-orphan-session-recovery.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"detect orphaned tmux sessions from plan agent crashes and let users reattach or kill them from the sidebar context menu\",\n      \"branch\": \"plan/orphan-session-recovery\",\n      \"created_at\": \"2026-02-24T04:07:00Z\"\n    },\n    \"2026-02-24-parallel-fix-agents.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"currently if the reviewer rejects an implementation, a single coder agent is spawned to address everything. instead, the reviewer agent should automatically propose what fixes need to be made that clearly states what (if anything) can be fixed in parallel. kasmos should then automatically follow those steps. the maximum parallel should follow the same rules\",\n      \"branch\": \"plan/parallel-fix-agents\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"2026-02-24-review-approval-gate.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual approval gate after automated review — two-popup flow for merge/PR before plan can be marked done\",\n      \"branch\": \"plan/review-approval-gate\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:45:00Z\"\n    },\n    \"2026-02-24-sentry-integration.md\": {\n      \"status\": \"done\",\n      \"description\": \"add sentry to the project for better debugging experience\",\n      \"branch\": \"plan/sentry-integration\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T20:03:01.389587403Z\"\n    },\n    \"2026-02-24-spring.md\": {\n      \"status\": \"done\",\n      \"description\": \"integrate harmonica to add a spring load-in animation for the kasmos logo on launch — scales from small to big — and vertically center both the logo and the call to action line below it\",\n      \"branch\": \"plan/spring\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-24T23:30:00Z\"\n    },\n    \"2026-02-24-wizard-tui-redesign.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace huh-form init wizard with full-screen bubbletea TUI using Rosé Pine Moon aesthetic\",\n      \"branch\": \"plan/wizard-tui-redesign\",\n      \"topic\": \"ui\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-25\"\n    },\n    \"2026-02-25-alt-v-not-working.md\": {\n      \"status\": \"done\",\n      \"description\": \"alt+v doesnt passthrough in interactive mode (i need for my custom variants toggle keybind)\",\n      \"branch\": \"plan/alt-v-not-working\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T18:58:19.973770029Z\"\n    },\n    \"2026-02-25-contextual-status-bar.md\": {\n      \"status\": \"done\",\n      \"description\": \"top status bar showing contextual info (wave progress, repo name, branch) based on focused/selected item\",\n      \"branch\": \"plan/contextual-status-bar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-25-enforce-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"automate cli-tools enforcement hooks installation during kas init for claude and opencode harnesses\",\n      \"branch\": \"plan/enforce-cli-tools\",\n      \"topic\": \"automation\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-25-fix-planner-missing-waves.md\": {\n      \"status\": \"done\",\n      \"description\": \"the planner agent should always use wave headers when launched via kasmos. a plan i just brainstormed had to go back to planner agent to add the headers\",\n      \"branch\": \"plan/fix-planner-missing-waves\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:40:28.678650334Z\"\n    },\n    \"2026-02-25-improve-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"update cli-tools to be more strict and ensure rg is ALWAYS used over grep as well as other tools\",\n      \"branch\": \"plan/improve-cli-tools\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-25T17:38:32.640854935Z\"\n    },\n    \"2026-02-25-new-plan-tab-cycle.md\": {\n      \"status\": \"done\",\n      \"description\": \"tab and shift tab should cycle through the 2 inputs not deselect once u reach end\",\n      \"branch\": \"plan/new-plan-tab-cycle\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T20:41:20.135133593Z\"\n    },\n    \"2026-02-25-opencode-default-harness.md\": {\n      \"status\": \"done\",\n      \"description\": \"opencode should be the default harness for each agent type, not claude\",\n      \"branch\": \"plan/opencode-default-harness\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T02:24:21.577814842Z\"\n    },\n    \"2026-02-25-prompt-via-cli.md\": {\n      \"status\": \"done\",\n      \"description\": \"instead of waiting for the session to become ready to send the prompt text, supply it via --prompt (opencode) or -p (claude) when launching the agent directly\",\n      \"branch\": \"plan/prompt-via-cli\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T17:31:48.642511235Z\"\n    },\n    \"2026-02-25-reintegrate-auto-accept.md\": {\n      \"status\": \"ready\",\n      \"branch\": \"plan/reintegrate-auto-accept\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T19:53:16.45886024Z\"\n    },\n    \"2026-02-25-scroll-overflow.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual scroll offset for list and sidebar overflow\",\n      \"branch\": \"plan/scroll-overflow\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T00:00:00Z\"\n    },\n    \"2026-02-25-show-plan-name-for-topics.md\": {\n      \"status\": \"done\",\n      \"description\": \"show the plan name you just entered when selecting a topic name because i have a bad memory and forget what plan i was adding\",\n      \"branch\": \"plan/show-plan-name-for-topics\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"2026-02-25-simplify-plan-creation.md\": {\n      \"status\": \"done\",\n      \"description\": \"add name and description for new plans to a single form popup. focuses on name by default - user can use tab navigation to the description input or use arrow down/up to navigate. hitting enter from either input creates the plan since description is optional\",\n      \"branch\": \"plan/simplify-plan-creation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    },\n    \"2026-02-25-solo-agent-mode.md\": {\n      \"status\": \"done\",\n      \"description\": \"start solo agent context menu action — single coder in worktree with minimal prompt, no wave/review lifecycle\",\n      \"branch\": \"plan/solo-agent-mode\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-26-bubblezone-mouse.md\": {\n      \"status\": \"done\",\n      \"description\": \"bubblezone zone-per-element mouse hit detection, focus-mode escape via click, SGR mouse forwarding to PTY\",\n      \"branch\": \"plan/bubblezone\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-22T08:28:43.336094301Z\"\n    },\n    \"2026-02-26-cleanup-superpowers-cmds.md\": {\n      \"status\": \"done\",\n      \"description\": \"it seems some superpowers plans keep pushing claude to use grep (specifically writing-plans just now). these should be overriden to reference their modern counterparts\",\n      \"branch\": \"plan/cleanup-superpowers-cmds\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T03:50:14.851365189Z\"\n    },\n    \"2026-02-26-details-tab.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace lazygit git tab with a read-only info tab\",\n      \"branch\": \"plan/details-tab\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T02:26:10.767895938Z\"\n    },\n    \"2026-02-26-detect-allow-perms.md\": {\n      \"status\": \"done\",\n      \"description\": \"detect when opencode is asking for perms to Allow once, Allow always, Reject. show a popup dialog allowing the user to pick then propagate their change to the session. if they choose approve always (which should be default selection), you'll send right arrow -\\u003e enter -\\u003e enter. approve once is a single enter. reject is right arrow -\\u003e right arrow -\\u003e enter\",\n      \"branch\": \"plan/detect-allow-perms\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:16:31.684660209Z\"\n    },\n    \"2026-02-26-enter-not-reachable.md\": {\n      \"status\": \"done\",\n      \"description\": \"can't reach the enter button via keyboard navigation in info tab. also move info tab to first position, agent second diff third\",\n      \"branch\": \"plan/enter-not-reachable\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T21:49:47.811876321Z\"\n    },\n    \"2026-02-26-kas-verify-loop.md\": {\n      \"status\": \"done\",\n      \"description\": \"update reviewer instructions to loop reviewer \\u003c-\\u003e fixer until all tiers pass and ALL issues have been addressed, no matter the severity\",\n      \"branch\": \"plan/kas-verify-loop\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:15:09.857895365Z\"\n    },\n    \"2026-02-26-new-plan-cli-command.md\": {\n      \"status\": \"planning\",\n      \"description\": \"kas new [title] [description] # new cli command (also runnable via kas n alias) to quickly create a new plan (no topic) with optional description via cli without having to launch tui\",\n      \"branch\": \"plan/new-cli-command\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T05:07:21.925625953Z\"\n    },\n    \"2026-02-26-no-plan-to-implement-prompt.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"you have to manually kill the planner agent before kasmos shows you the dialog to start implementation\",\n      \"branch\": \"plan/no-plan-to-implement-prompt\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T23:00:00Z\"\n    },\n    \"2026-02-26-redesign-instance-list.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-26-release-v1-0-0.md\": {\n      \"status\": \"done\",\n      \"description\": \"create github release, update versioning in project and deploy to homebrew\",\n      \"branch\": \"plan/release-v1-0-0\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T20:40:48.870776932Z\"\n    },\n    \"2026-02-26-sentry-analysis.md\": {\n      \"status\": \"ready\",\n      \"description\": \"have an agent go through sentry backlog to pick out some areas for improvement/patching\",\n      \"branch\": \"plan/sentry-analysis\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:14:59.843580163Z\"\n    },\n    \"2026-02-26-spawn-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"restore 's' keybind for spawning an agent for manual work. make sure it appears clean in the instance list but doesn't require being attached to a plan and sits outside the normal lifecycle (but can still be killed and managed the same)\",\n      \"branch\": \"plan/spawn-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T05:20:45.243395804Z\"\n    },\n    \"2026-02-26-stepthrough-worktrees.md\": {\n      \"status\": \"done\",\n      \"description\": \"stepthrough git worktree and branch usage in both standard and solo agent workflows. ensure it's being used properly, there are no gaps or incorrect commands, and we're cleanly managing history between parallel plan implementations.\",\n      \"branch\": \"plan/stepthrough-worktrees\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"2026-02-26-tmux-session-browser.md\": {\n      \"status\": \"done\",\n      \"description\": \"TUI overlay to browse, kill, and adopt orphaned tmux sessions\",\n      \"branch\": \"plan/tmux-session-browser\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T17:30:00Z\"\n    },\n    \"2026-02-26-validate-recent-merges.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"some work looks like it might've been lost or reverted, review the last few plans merged to determine what's been merged, what's been lost, and what can be recovered\",\n      \"branch\": \"plan/validate-recent-merges\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:18:22.559632982Z\"\n    },\n    \"2026-02-26-yes-keybind.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a y keybind to the instance list that sends yes to a session waiting for an answer to a yes/no question\",\n      \"branch\": \"plan/yes-keybind\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T16:42:11.713212759Z\"\n    },\n    \"2026-02-27-always-focus-sidebar.md\": {\n      \"status\": \"done\",\n      \"description\": \"the purple focus highlight and keyboard should always cling to the sidebar outside of interactive or attach mode. hitting tab required me to navigate left to get back to sidebar when it should just kept my selection and shown the agent tab instead\",\n      \"branch\": \"plan/always-focus-sidebar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T16:54:32.618130648Z\"\n    },\n    \"2026-02-27-audit-log.md\": {\n      \"status\": \"ready\",\n      \"description\": \"log all actions (new 'coder' agent spawned, finished successfully/failed, etc etc). useful for debugging but also browsing history and tracking who did what and why automatically\",\n      \"branch\": \"plan/audit-log\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T07:36:50.243680437Z\"\n    },\n    \"2026-02-27-build-custom-skills-replaced.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"build custom skills\\n\\ngenerate kasmos-specific skills that integrate the existing workflow and superpowers into a self contained, specific skillset\",\n      \"branch\": \"plan/build-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:13:27.704398153Z\"\n    },\n    \"2026-02-27-canceled-plans-delay-removal.md\": {\n      \"status\": \"done\",\n      \"description\": \"canceled plans delay removal\\n\\nafter cancelling a plan using the sidebar context menu, it remains in the list for 1-2 sec after closing the menu instead of hiding immediately even if still loading the full side effects in the background\",\n      \"branch\": \"plan/canceled-plans-delay-removal\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:36:48.99087766Z\"\n    },\n    \"2026-02-27-chat-and-custodial-customizations.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename custodial to custodian and make chat/custodian agent types configurable in the setup wizard\",\n      \"branch\": \"plan/chat-and-custodial-customizations\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T22:00:00Z\"\n    },\n    \"2026-02-27-cleanup-tracked-state.md\": {\n      \"status\": \"ready\",\n      \"description\": \"cleanup tracked state\\n\\nreevaluate what files should be tracked in git. anything covered by scaffolding should probably be excluded and I'm sure there's others that we shouldn't be tracking but are (.codex, .opencode, .claude, etc). evaluate all tracked files and if they reflect best practices for the libraries/frameworks in use\",\n      \"branch\": \"plan/cleanup-tracked-state\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T17:57:15.490968411Z\"\n    },\n    \"2026-02-27-create-a-debugging-skill-and-agent-type-should.md\": {\n      \"status\": \"ready\",\n      \"description\": \"create a debugging skill and agent type (should probably replace custodian) that's equipped to handle custodian's work but more importantly, is specialized in debugging and investigating issues, tieing up loose ends and targeted verification\",\n      \"branch\": \"plan/create-a-debugging-skill-and-agent-type-should\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-27T22:07:33.623625523Z\"\n    },\n    \"2026-02-27-create-kasmos-custodial-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"create custodial agent designed to efficiently and effectively handle touchup tasks and quick fixes geared around issues or ux gaps in the kasmos workflow. things like resetting a plan's status/overriding it, finishing the development branch by merging to main or creating a pr, etc.\",\n      \"branch\": \"plan/create-kasmos-custodial-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T17:47:32.295296289Z\"\n    },\n    \"2026-02-27-ctrl-ud-pagination.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"configure ctrl+u for paginate up in agent session, d for down. it's not currently working\",\n      \"branch\": \"plan/ctrl-ud-pagination\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T07:25:38.786253804Z\"\n    },\n    \"2026-02-27-disable-cla-for-prs.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/disable-cla-for-prs\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T16:50:23.219250196Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-fix-wave-header-generation.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/fix-wave-header-generation\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T16:16:33.640848697Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md\": {\n      \"status\": \"implementing\",\n      \"description\": \"implement a custom /kas.verify tiered review process for PRs (evaluate using codex code review or some other github integration to use specific skills/review process we need to research it). this should trigger for new prs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?)\",\n      \"branch\": \"plan/implement-a-custom-kas-verify-tiered-review-process-for\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T21:57:06.660976295Z\"\n    },\n    \"2026-02-27-improve-planner-to-implementation.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"improve planner to implementation\\n\\nthe automated workflow transition doesn't work until you manually kill the agent. retest with new skills and evaluate if it needs ot be fixed. the same goes for the final stages of the lifecycle, the final review and merge/pr finalization is clunky and difficult to manuver\",\n      \"branch\": \"plan/improve-planner-to-implementation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:35:51.890862288Z\"\n    },\n    \"2026-02-27-kasmos-custom-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"audit cli-tools references, add rg deep reference, write 5 kasmos-native skills (lifecycle/planner/coder/reviewer/custodial), update agent templates and prompt builders, remove old superpowers-derived scaffolded skills\",\n      \"branch\": \"plan/kasmos-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills-design.md\": {\n      \"status\": \"done\",\n      \"description\": \"design doc for kasmos-native skills system\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace superpowers skills with 5 kasmos-native skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-new-plan-issues.md\": {\n      \"status\": \"ready\",\n      \"description\": \"new-plan-issues\\n\\ndisappears if confirmation dialog shows while making a new plan, losing all contents. also, the box gets bigger when the agent pane either loads a session or switches (due to exit, etc)\",\n      \"branch\": \"plan/new-plan-issues\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:49:21.082140797Z\"\n    },\n    \"2026-02-27-plan-review.md\": {\n      \"status\": \"done\",\n      \"description\": \"plan-review\\n\\nimplement automatic plan reviews and fixing before writing the plan and proceeding to implementation (either manual or automatic, basically last step in planning is to review the plan)\",\n      \"branch\": \"plan/plan-review\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:19:27.808935081Z\"\n    },\n    \"2026-02-27-quit-confirmation-dialog.md\": {\n      \"status\": \"done\",\n      \"description\": \"quit confirmation dialog\\n\\nshow a quit confirmation dialog when user presses q\",\n      \"branch\": \"plan/quit-confirmation-dialog\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:49:35.747504695Z\"\n    },\n    \"2026-02-27-release-1-0-0-failures.md\": {\n      \"status\": \"done\",\n      \"description\": \"check github to see the failure reasons and fix then redeploy v1.0.0\",\n      \"branch\": \"plan/release-1-0-0-failures\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T06:41:42.078871243Z\"\n    },\n    \"2026-02-27-release-v1-1.md\": {\n      \"status\": \"done\",\n      \"description\": \"release v1.1\\n\\ncreate new tag to trigger build for v1.1.0 encorporating changes since last night\",\n      \"branch\": \"plan/release-v1-1\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:07:35.357546336Z\"\n    },\n    \"2026-02-27-reliable-planner-completion.md\": {\n      \"status\": \"done\",\n      \"description\": \"make planner explicitly confirm with user before signaling completion, instead of relying on agent remembering to touch sentinel after Q\\u0026A\",\n      \"branch\": \"plan/reliable-planner-completion\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:15:00Z\"\n    },\n    \"2026-02-27-rename-plan-menu.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename plan menu\\n\\nadd an option to rename plans in their context menu\",\n      \"branch\": \"plan/rename-plan-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n    },\n    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    },\n    \"2026-02-27-set-status-context-menu.md\": {\n      \"status\": \"ready\",\n      \"description\": \"set status context menu\\n\\ncurrently there is no way to update a plan status (eg. to fix if incorrect) without triggering automation side effects. i want to be able to correct a wrong plan that got out of sync without automation picking it up\",\n      \"branch\": \"plan/set-status-context-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:10:02.331577094Z\"\n    },\n    \"2026-02-27-simplify-new-plan.md\": {\n      \"status\": \"done\",\n      \"description\": \"simplify creation of a new plan by only using one multiline input field labeled something like \\\"describe what you want to work on...\\\" as a label then use either a headless claude code call to sonnet-4-6 to derive a title or do it without ai if you can easily. descriptionw will be what the user entered\",\n      \"branch\": \"plan/simplify-new-plan\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T15:52:02.820017802Z\"\n    },\n    \"2026-02-27-tmux-session-summary.md\": {\n      \"status\": \"done\",\n      \"description\": \"show a summary of active tmux sessions that would be shown if you did shift t keybind to browse the sessions, in addition to ones that are shown that aren't in there that are already, like, adopted or were the born with the same plan\",\n      \"branch\": \"plan/tmux-session-summary\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T07:41:00.300934469Z\"\n    }\n  }\n}\n",
              "after": "{\n  \"topics\": {\n    \"automation\": {\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"sidebar\": {\n      \"created_at\": \"2026-02-22T18:00:00Z\"\n    },\n    \"tools\": {\n      \"created_at\": \"2026-02-24T20:03:01Z\"\n    },\n    \"ui\": {\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"verify\": {\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"workflow\": {\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    }\n  },\n  \"plans\": {\n    \"2026-02-20-kq-init-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-plan-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-plan-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-project-skills-distribution.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-tool-discovery-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-wizard-ux-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-wizard-ux.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-agent-customize-gate.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-naming-and-toast-wrap.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-generate-opencode-jsonc-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-generate-opencode-jsonc.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-global-skill-sync.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-init-wizard-refinements.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-plan-centric-sidebar.md\": {\n      \"status\": \"cancelled\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-instance-grouping.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-lifecycle-sessions.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-rose-pine-moon-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-rose-pine-moon.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-nav-showhide.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-topics-as-collision-domains-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-topics-collision-domains.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-22-1a-tree-renderer.md\": {\n      \"status\": \"done\",\n      \"description\": \"tree-mode rendering branch in Sidebar.String() with indentation, chevrons, and status glyphs\",\n      \"branch\": \"kas/1a-tree-renderer-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1b-tree-navigation.md\": {\n      \"status\": \"done\",\n      \"description\": \"Left/Right tree-traversal methods and Space/Enter/arrow keybindings for tree-mode sidebar\",\n      \"branch\": \"kas/1b-tree-navigation-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1c-highlight-boost-list.md\": {\n      \"status\": \"done\",\n      \"description\": \"highlight-boost instance list with partition sort and dimmed rendering for non-matching instances\",\n      \"branch\": \"plan/1c-highlight-boost-list\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-2-tree-mode-wiring.md\": {\n      \"status\": \"done\",\n      \"description\": \"wire tree renderer, navigation, and highlight-boost together; remove DisableTreeMode gate\",\n      \"branch\": \"plan/2-tree-mode-wiring\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-async-metadata-tick.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-center-col-v-align.md\": {\n      \"status\": \"done\",\n      \"description\": \"center column is scrolled up slightly and also not bottom aligned\",\n      \"branch\": \"plan/center-col-v-align\",\n      \"created_at\": \"2026-02-22T08:33:42.034471509Z\"\n    },\n    \"2026-02-22-center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet.md\": {\n      \"status\": \"cancelled\",\n      \"branch\": \"plan/center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet\",\n      \"created_at\": \"2026-02-22T08:30:57.806756006Z\"\n    },\n    \"2026-02-22-customize-superpowers.md\": {\n      \"status\": \"done\",\n      \"description\": \"streamline interactions with superpowers and this app by personalizing the superpowers skills\",\n      \"branch\": \"plan/customize-superpowers\",\n      \"created_at\": \"2026-02-22T10:10:09.111289772Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-22-detect-permissions-needed.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"indicate in list view if permissions are needed and switch to live capture (or increased cache r/w if possible) to button presses dont jump back and forth\",\n      \"branch\": \"plan/detect-permissions-needed\",\n      \"created_at\": \"2026-02-22T08:35:22.645408061Z\"\n    },\n    \"2026-02-22-disable-cache-focused.md\": {\n      \"status\": \"done\",\n      \"description\": \"disable cache reading and poll tmux pane directly when focused to improve interactive experience (it glitches a lot currently)\",\n      \"branch\": \"plan/disable-cache-focused\",\n      \"created_at\": \"2026-02-22T09:56:55.401392089Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-dupe-task-after-plan-change.md\": {\n      \"status\": \"done\",\n      \"description\": \"i marked another plan done and suddenly i had 2 of another one that was running even though it hasn't switched to a review agent yet\",\n      \"branch\": \"plan/dupe-task-after-plan-change\",\n      \"created_at\": \"2026-02-22T10:00:27.703574166Z\"\n    },\n    \"2026-02-22-kq-check.md\": {\n      \"status\": \"done\",\n      \"description\": \"kq check command to audit skills sync health across all three layers (global, project, superpowers)\",\n      \"created_at\": \"2026-02-22T09:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-parallelize-superpowers.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"extract any parallelization opportunities by controlling individual task fixes (use new agent for each even if sequential)\",\n      \"branch\": \"plan/parallelize-superpowers\",\n      \"created_at\": \"2026-02-22T10:04:55.567483368Z\"\n    },\n    \"2026-02-22-planner-exit-prompt.md\": {\n      \"status\": \"done\",\n      \"description\": \"show confirmation dialog when planner finishes asking whether to start implementation\",\n      \"created_at\": \"2026-02-22T13:00:00Z\",\n      \"implemented\": \"2026-02-23\"\n    },\n    \"2026-02-22-remove-right-sidbar-right-to-focus-session.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/remove-right-sidbar-right-to-focus-session\",\n      \"created_at\": \"2026-02-22T12:15:27.104776176Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-rename-to-kasmos.md\": {\n      \"status\": \"done\",\n      \"description\": \"switch name back to kasmos and overtake that repo (rename that one to kasmold first)\",\n      \"branch\": \"plan/rename-to-kasmos\",\n      \"created_at\": \"2026-02-22T09:53:24.333455818Z\"\n    },\n    \"2026-02-22-shorten-cta.md\": {\n      \"status\": \"done\",\n      \"description\": \"drop plan from first part of cta below ascii art\",\n      \"branch\": \"plan/shorten-cta\",\n      \"created_at\": \"2026-02-22T09:54:49.026733734Z\"\n    },\n    \"2026-02-22-tab-focus-ring.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement 5-slot Tab focus ring: key defs, focusSlot state, key routing, tests, gradient, help\",\n      \"created_at\": \"2026-02-22T18:45:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-update-shortcut-hints.md\": {\n      \"status\": \"done\",\n      \"description\": \"D kill becomes K kill. i focus agent to i interactive mode. space actions becomes space shortcuts. hide P create PR and c checkout, remove R switch repo, keep the rest.\",\n      \"branch\": \"plan/update-shortcut-hints\",\n      \"created_at\": \"2026-02-22T12:12:58.588910211Z\"\n    },\n    \"2026-02-22-wave-orchestration.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement wave orchestration: plan parser, instance fields, orchestrator state machine, validation gate, prompt builder, wiring, wave badge\",\n      \"branch\": \"plan/wave-orchestration\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-23-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"description\": \"centralized FSM for plan lifecycle with flock serialization and agent sentinel files\",\n      \"branch\": \"plan/plan-state-machine\",\n      \"created_at\": \"2026-02-23T14:00:00Z\"\n    },\n    \"2026-02-23-update-ascii-art.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace KLIQUE ascii art banner with KASMOS using same ANSI Shadow font\",\n      \"branch\": \"plan/update-ascii-art\",\n      \"created_at\": \"2026-02-23T18:00:00Z\"\n    },\n    \"2026-02-24-add-episodic-memory.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"add episodic memory as a default skill when running init scaffolding command — shelved: none of the available memory plugins (episodic-memory, psychmem, hmem) are mature enough for dual-harness use yet\",\n      \"branch\": \"plan/add-episodic-memory\",\n      \"created_at\": \"2026-02-24T03:50:07.986559175Z\"\n    },\n    \"2026-02-24-clickup-import.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a feature for importing clickup tasks as plans using the official MCP server. this feature is optional and is only available when the clickup mcp server is detected. have it be an option at the bottom the plans list above history (+ import from clickup) or something like that. once the task details are downloaded, run the plan through superpowers brainstorming using a planning agent automatically to determine if it's ready for implementation or needs to be fleshed out.\",\n      \"branch\": \"plan/clickup-import\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T02:44:43.679630782Z\"\n    },\n    \"2026-02-24-live-preview-terminal.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace capture-pane polling with live EmbeddedTerminal VT emulator in preview pane, unify with focus mode\",\n      \"branch\": \"plan/live-preview-terminal\",\n      \"created_at\": \"2026-02-24T18:00:00Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-24-orphan-session-recovery.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"detect orphaned tmux sessions from plan agent crashes and let users reattach or kill them from the sidebar context menu\",\n      \"branch\": \"plan/orphan-session-recovery\",\n      \"created_at\": \"2026-02-24T04:07:00Z\"\n    },\n    \"2026-02-24-parallel-fix-agents.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"currently if the reviewer rejects an implementation, a single coder agent is spawned to address everything. instead, the reviewer agent should automatically propose what fixes need to be made that clearly states what (if anything) can be fixed in parallel. kasmos should then automatically follow those steps. the maximum parallel should follow the same rules\",\n      \"branch\": \"plan/parallel-fix-agents\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"2026-02-24-review-approval-gate.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual approval gate after automated review — two-popup flow for merge/PR before plan can be marked done\",\n      \"branch\": \"plan/review-approval-gate\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:45:00Z\"\n    },\n    \"2026-02-24-sentry-integration.md\": {\n      \"status\": \"done\",\n      \"description\": \"add sentry to the project for better debugging experience\",\n      \"branch\": \"plan/sentry-integration\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T20:03:01.389587403Z\"\n    },\n    \"2026-02-24-spring.md\": {\n      \"status\": \"done\",\n      \"description\": \"integrate harmonica to add a spring load-in animation for the kasmos logo on launch — scales from small to big — and vertically center both the logo and the call to action line below it\",\n      \"branch\": \"plan/spring\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-24T23:30:00Z\"\n    },\n    \"2026-02-24-wizard-tui-redesign.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace huh-form init wizard with full-screen bubbletea TUI using Rosé Pine Moon aesthetic\",\n      \"branch\": \"plan/wizard-tui-redesign\",\n      \"topic\": \"ui\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-25\"\n    },\n    \"2026-02-25-alt-v-not-working.md\": {\n      \"status\": \"done\",\n      \"description\": \"alt+v doesnt passthrough in interactive mode (i need for my custom variants toggle keybind)\",\n      \"branch\": \"plan/alt-v-not-working\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T18:58:19.973770029Z\"\n    },\n    \"2026-02-25-contextual-status-bar.md\": {\n      \"status\": \"done\",\n      \"description\": \"top status bar showing contextual info (wave progress, repo name, branch) based on focused/selected item\",\n      \"branch\": \"plan/contextual-status-bar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-25-enforce-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"automate cli-tools enforcement hooks installation during kas init for claude and opencode harnesses\",\n      \"branch\": \"plan/enforce-cli-tools\",\n      \"topic\": \"automation\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-25-fix-planner-missing-waves.md\": {\n      \"status\": \"done\",\n      \"description\": \"the planner agent should always use wave headers when launched via kasmos. a plan i just brainstormed had to go back to planner agent to add the headers\",\n      \"branch\": \"plan/fix-planner-missing-waves\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:40:28.678650334Z\"\n    },\n    \"2026-02-25-improve-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"update cli-tools to be more strict and ensure rg is ALWAYS used over grep as well as other tools\",\n      \"branch\": \"plan/improve-cli-tools\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-25T17:38:32.640854935Z\"\n    },\n    \"2026-02-25-new-plan-tab-cycle.md\": {\n      \"status\": \"done\",\n      \"description\": \"tab and shift tab should cycle through the 2 inputs not deselect once u reach end\",\n      \"branch\": \"plan/new-plan-tab-cycle\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T20:41:20.135133593Z\"\n    },\n    \"2026-02-25-opencode-default-harness.md\": {\n      \"status\": \"done\",\n      \"description\": \"opencode should be the default harness for each agent type, not claude\",\n      \"branch\": \"plan/opencode-default-harness\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T02:24:21.577814842Z\"\n    },\n    \"2026-02-25-prompt-via-cli.md\": {\n      \"status\": \"done\",\n      \"description\": \"instead of waiting for the session to become ready to send the prompt text, supply it via --prompt (opencode) or -p (claude) when launching the agent directly\",\n      \"branch\": \"plan/prompt-via-cli\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T17:31:48.642511235Z\"\n    },\n    \"2026-02-25-reintegrate-auto-accept.md\": {\n      \"status\": \"ready\",\n      \"branch\": \"plan/reintegrate-auto-accept\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T19:53:16.45886024Z\"\n    },\n    \"2026-02-25-scroll-overflow.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual scroll offset for list and sidebar overflow\",\n      \"branch\": \"plan/scroll-overflow\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T00:00:00Z\"\n    },\n    \"2026-02-25-show-plan-name-for-topics.md\": {\n      \"status\": \"done\",\n      \"description\": \"show the plan name you just entered when selecting a topic name because i have a bad memory and forget what plan i was adding\",\n      \"branch\": \"plan/show-plan-name-for-topics\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"2026-02-25-simplify-plan-creation.md\": {\n      \"status\": \"done\",\n      \"description\": \"add name and description for new plans to a single form popup. focuses on name by default - user can use tab navigation to the description input or use arrow down/up to navigate. hitting enter from either input creates the plan since description is optional\",\n      \"branch\": \"plan/simplify-plan-creation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    },\n    \"2026-02-25-solo-agent-mode.md\": {\n      \"status\": \"done\",\n      \"description\": \"start solo agent context menu action — single coder in worktree with minimal prompt, no wave/review lifecycle\",\n      \"branch\": \"plan/solo-agent-mode\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-26-bubblezone-mouse.md\": {\n      \"status\": \"done\",\n      \"description\": \"bubblezone zone-per-element mouse hit detection, focus-mode escape via click, SGR mouse forwarding to PTY\",\n      \"branch\": \"plan/bubblezone\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-22T08:28:43.336094301Z\"\n    },\n    \"2026-02-26-cleanup-superpowers-cmds.md\": {\n      \"status\": \"done\",\n      \"description\": \"it seems some superpowers plans keep pushing claude to use grep (specifically writing-plans just now). these should be overriden to reference their modern counterparts\",\n      \"branch\": \"plan/cleanup-superpowers-cmds\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T03:50:14.851365189Z\"\n    },\n    \"2026-02-26-details-tab.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace lazygit git tab with a read-only info tab\",\n      \"branch\": \"plan/details-tab\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T02:26:10.767895938Z\"\n    },\n    \"2026-02-26-detect-allow-perms.md\": {\n      \"status\": \"done\",\n      \"description\": \"detect when opencode is asking for perms to Allow once, Allow always, Reject. show a popup dialog allowing the user to pick then propagate their change to the session. if they choose approve always (which should be default selection), you'll send right arrow -\\u003e enter -\\u003e enter. approve once is a single enter. reject is right arrow -\\u003e right arrow -\\u003e enter\",\n      \"branch\": \"plan/detect-allow-perms\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:16:31.684660209Z\"\n    },\n    \"2026-02-26-enter-not-reachable.md\": {\n      \"status\": \"done\",\n      \"description\": \"can't reach the enter button via keyboard navigation in info tab. also move info tab to first position, agent second diff third\",\n      \"branch\": \"plan/enter-not-reachable\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T21:49:47.811876321Z\"\n    },\n    \"2026-02-26-kas-verify-loop.md\": {\n      \"status\": \"done\",\n      \"description\": \"update reviewer instructions to loop reviewer \\u003c-\\u003e fixer until all tiers pass and ALL issues have been addressed, no matter the severity\",\n      \"branch\": \"plan/kas-verify-loop\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:15:09.857895365Z\"\n    },\n    \"2026-02-26-new-plan-cli-command.md\": {\n      \"status\": \"planning\",\n      \"description\": \"kas new [title] [description] # new cli command (also runnable via kas n alias) to quickly create a new plan (no topic) with optional description via cli without having to launch tui\",\n      \"branch\": \"plan/new-cli-command\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T05:07:21.925625953Z\"\n    },\n    \"2026-02-26-no-plan-to-implement-prompt.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"you have to manually kill the planner agent before kasmos shows you the dialog to start implementation\",\n      \"branch\": \"plan/no-plan-to-implement-prompt\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T23:00:00Z\"\n    },\n    \"2026-02-26-redesign-instance-list.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-26-release-v1-0-0.md\": {\n      \"status\": \"done\",\n      \"description\": \"create github release, update versioning in project and deploy to homebrew\",\n      \"branch\": \"plan/release-v1-0-0\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T20:40:48.870776932Z\"\n    },\n    \"2026-02-26-sentry-analysis.md\": {\n      \"status\": \"ready\",\n      \"description\": \"have an agent go through sentry backlog to pick out some areas for improvement/patching\",\n      \"branch\": \"plan/sentry-analysis\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:14:59.843580163Z\"\n    },\n    \"2026-02-26-spawn-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"restore 's' keybind for spawning an agent for manual work. make sure it appears clean in the instance list but doesn't require being attached to a plan and sits outside the normal lifecycle (but can still be killed and managed the same)\",\n      \"branch\": \"plan/spawn-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T05:20:45.243395804Z\"\n    },\n    \"2026-02-26-stepthrough-worktrees.md\": {\n      \"status\": \"done\",\n      \"description\": \"stepthrough git worktree and branch usage in both standard and solo agent workflows. ensure it's being used properly, there are no gaps or incorrect commands, and we're cleanly managing history between parallel plan implementations.\",\n      \"branch\": \"plan/stepthrough-worktrees\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"2026-02-26-tmux-session-browser.md\": {\n      \"status\": \"done\",\n      \"description\": \"TUI overlay to browse, kill, and adopt orphaned tmux sessions\",\n      \"branch\": \"plan/tmux-session-browser\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T17:30:00Z\"\n    },\n    \"2026-02-26-validate-recent-merges.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"some work looks like it might've been lost or reverted, review the last few plans merged to determine what's been merged, what's been lost, and what can be recovered\",\n      \"branch\": \"plan/validate-recent-merges\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:18:22.559632982Z\"\n    },\n    \"2026-02-26-yes-keybind.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a y keybind to the instance list that sends yes to a session waiting for an answer to a yes/no question\",\n      \"branch\": \"plan/yes-keybind\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T16:42:11.713212759Z\"\n    },\n    \"2026-02-27-always-focus-sidebar.md\": {\n      \"status\": \"done\",\n      \"description\": \"the purple focus highlight and keyboard should always cling to the sidebar outside of interactive or attach mode. hitting tab required me to navigate left to get back to sidebar when it should just kept my selection and shown the agent tab instead\",\n      \"branch\": \"plan/always-focus-sidebar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T16:54:32.618130648Z\"\n    },\n    \"2026-02-27-audit-log.md\": {\n      \"status\": \"ready\",\n      \"description\": \"log all actions (new 'coder' agent spawned, finished successfully/failed, etc etc). useful for debugging but also browsing history and tracking who did what and why automatically\",\n      \"branch\": \"plan/audit-log\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T07:36:50.243680437Z\"\n    },\n    \"2026-02-27-build-custom-skills-replaced.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"build custom skills\\n\\ngenerate kasmos-specific skills that integrate the existing workflow and superpowers into a self contained, specific skillset\",\n      \"branch\": \"plan/build-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:13:27.704398153Z\"\n    },\n    \"2026-02-27-canceled-plans-delay-removal.md\": {\n      \"status\": \"done\",\n      \"description\": \"canceled plans delay removal\\n\\nafter cancelling a plan using the sidebar context menu, it remains in the list for 1-2 sec after closing the menu instead of hiding immediately even if still loading the full side effects in the background\",\n      \"branch\": \"plan/canceled-plans-delay-removal\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:36:48.99087766Z\"\n    },\n    \"2026-02-27-chat-about-this-menu-option-that-opens-up.md\": {\n      \"status\": \"ready\",\n      \"description\": \"chat about this menu option that opens up custodian agent with plan info and prompts user to ask a question\",\n      \"branch\": \"plan/chat-about-this-menu-option-that-opens-up\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T22:26:55.041161118Z\"\n    },\n    \"2026-02-27-chat-and-custodial-customizations.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename custodial to custodian and make chat/custodian agent types configurable in the setup wizard\",\n      \"branch\": \"plan/chat-and-custodial-customizations\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T22:00:00Z\"\n    },\n    \"2026-02-27-cleanup-tracked-state.md\": {\n      \"status\": \"ready\",\n      \"description\": \"cleanup tracked state\\n\\nreevaluate what files should be tracked in git. anything covered by scaffolding should probably be excluded and I'm sure there's others that we shouldn't be tracking but are (.codex, .opencode, .claude, etc). evaluate all tracked files and if they reflect best practices for the libraries/frameworks in use\",\n      \"branch\": \"plan/cleanup-tracked-state\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T17:57:15.490968411Z\"\n    },\n    \"2026-02-27-create-a-debugging-skill-and-agent-type-should.md\": {\n      \"status\": \"ready\",\n      \"description\": \"create a debugging skill and agent type (should probably replace custodian) that's equipped to handle custodian's work but more importantly, is specialized in debugging and investigating issues, tieing up loose ends and targeted verification\",\n      \"branch\": \"plan/create-a-debugging-skill-and-agent-type-should\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-27T22:07:33.623625523Z\"\n    },\n    \"2026-02-27-create-kasmos-custodial-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"create custodial agent designed to efficiently and effectively handle touchup tasks and quick fixes geared around issues or ux gaps in the kasmos workflow. things like resetting a plan's status/overriding it, finishing the development branch by merging to main or creating a pr, etc.\",\n      \"branch\": \"plan/create-kasmos-custodial-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T17:47:32.295296289Z\"\n    },\n    \"2026-02-27-ctrl-ud-pagination.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"configure ctrl+u for paginate up in agent session, d for down. it's not currently working\",\n      \"branch\": \"plan/ctrl-ud-pagination\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T07:25:38.786253804Z\"\n    },\n    \"2026-02-27-disable-cla-for-prs.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/disable-cla-for-prs\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T16:50:23.219250196Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-fix-wave-header-generation.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/fix-wave-header-generation\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T16:16:33.640848697Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"implement a custom /kas.verify tiered review process for PRs (evaluate using codex code review or some other github integration to use specific skills/review process we need to research it). this should trigger for new prs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?)\",\n      \"branch\": \"plan/implement-a-custom-kas-verify-tiered-review-process-for\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T21:57:06.660976295Z\"\n    },\n    \"2026-02-27-improve-planner-to-implementation.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"improve planner to implementation\\n\\nthe automated workflow transition doesn't work until you manually kill the agent. retest with new skills and evaluate if it needs ot be fixed. the same goes for the final stages of the lifecycle, the final review and merge/pr finalization is clunky and difficult to manuver\",\n      \"branch\": \"plan/improve-planner-to-implementation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:35:51.890862288Z\"\n    },\n    \"2026-02-27-kasmos-custom-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"audit cli-tools references, add rg deep reference, write 5 kasmos-native skills (lifecycle/planner/coder/reviewer/custodial), update agent templates and prompt builders, remove old superpowers-derived scaffolded skills\",\n      \"branch\": \"plan/kasmos-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills-design.md\": {\n      \"status\": \"done\",\n      \"description\": \"design doc for kasmos-native skills system\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace superpowers skills with 5 kasmos-native skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-new-plan-issues.md\": {\n      \"status\": \"ready\",\n      \"description\": \"new-plan-issues\\n\\ndisappears if confirmation dialog shows while making a new plan, losing all contents. also, the box gets bigger when the agent pane either loads a session or switches (due to exit, etc)\",\n      \"branch\": \"plan/new-plan-issues\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:49:21.082140797Z\"\n    },\n    \"2026-02-27-plan-review.md\": {\n      \"status\": \"done\",\n      \"description\": \"plan-review\\n\\nimplement automatic plan reviews and fixing before writing the plan and proceeding to implementation (either manual or automatic, basically last step in planning is to review the plan)\",\n      \"branch\": \"plan/plan-review\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:19:27.808935081Z\"\n    },\n    \"2026-02-27-quit-confirmation-dialog.md\": {\n      \"status\": \"done\",\n      \"description\": \"quit confirmation dialog\\n\\nshow a quit confirmation dialog when user presses q\",\n      \"branch\": \"plan/quit-confirmation-dialog\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:49:35.747504695Z\"\n    },\n    \"2026-02-27-release-1-0-0-failures.md\": {\n      \"status\": \"done\",\n      \"description\": \"check github to see the failure reasons and fix then redeploy v1.0.0\",\n      \"branch\": \"plan/release-1-0-0-failures\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T06:41:42.078871243Z\"\n    },\n    \"2026-02-27-release-v1-1.md\": {\n      \"status\": \"done\",\n      \"description\": \"release v1.1\\n\\ncreate new tag to trigger build for v1.1.0 encorporating changes since last night\",\n      \"branch\": \"plan/release-v1-1\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:07:35.357546336Z\"\n    },\n    \"2026-02-27-reliable-planner-completion.md\": {\n      \"status\": \"done\",\n      \"description\": \"make planner explicitly confirm with user before signaling completion, instead of relying on agent remembering to touch sentinel after Q\\u0026A\",\n      \"branch\": \"plan/reliable-planner-completion\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:15:00Z\"\n    },\n    \"2026-02-27-rename-plan-menu.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename plan menu\\n\\nadd an option to rename plans in their context menu\",\n      \"branch\": \"plan/rename-plan-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n    },\n    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now. evaluate using codex code review or some other github integration to use specific skills/review process (needs research). this should trigger for new PRs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?).\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    },\n    \"2026-02-27-set-status-context-menu.md\": {\n      \"status\": \"ready\",\n      \"description\": \"set status context menu\\n\\ncurrently there is no way to update a plan status (eg. to fix if incorrect) without triggering automation side effects. i want to be able to correct a wrong plan that got out of sync without automation picking it up\",\n      \"branch\": \"plan/set-status-context-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:10:02.331577094Z\"\n    },\n    \"2026-02-27-simplify-new-plan.md\": {\n      \"status\": \"done\",\n      \"description\": \"simplify creation of a new plan by only using one multiline input field labeled something like \\\"describe what you want to work on...\\\" as a label then use either a headless claude code call to sonnet-4-6 to derive a title or do it without ai if you can easily. descriptionw will be what the user entered\",\n      \"branch\": \"plan/simplify-new-plan\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T15:52:02.820017802Z\"\n    },\n    \"2026-02-27-tmux-session-summary.md\": {\n      \"status\": \"done\",\n      \"description\": \"show a summary of active tmux sessions that would be shown if you did shift t keybind to browse the sessions, in addition to ones that are shown that aren't in there that are already, like, adopted or were the born with the same plan\",\n      \"branch\": \"plan/tmux-session-summary\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T07:41:00.300934469Z\"\n    }\n  }\n}\n",
              "additions": 9,
              "deletions": 2,
              "status": "modified"
            },
            {
              "file": "ui/nav_panel_test.go",
              "before": "package ui\n\nimport (\n\t\"testing\"\n\n\t\"github.com/charmbracelet/bubbles/spinner\"\n\t\"github.com/kastheco/kasmos/session\"\n\t\"github.com/stretchr/testify/assert\"\n\t\"github.com/stretchr/testify/require\"\n)\n\nfunc newTestPanel() *NavigationPanel {\n\tsp := spinner.New(spinner.WithSpinner(spinner.Dot))\n\treturn NewNavigationPanel(&sp)\n}\n\nfunc makeInst(title, planFile string, status session.Status) *session.Instance {\n\treturn &session.Instance{\n\t\tTitle:    title,\n\t\tPlanFile: planFile,\n\t\tStatus:   status,\n\t}\n}\n\n// ---------- rebuildRows grouping ----------\n\nfunc TestRebuildRows_EmptyPanel(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetData(nil, nil, nil, nil, nil)\n\tassert.Empty(t, n.rows)\n\tassert.Equal(t, 0, n.selectedIdx)\n}\n\nfunc TestRebuildRows_PlansWithInstances(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"plan-a.md\"},\n\t\t{Filename: \"plan-b.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"a-impl\", \"plan-a.md\", session.Running),\n\t\tmakeInst(\"b-impl\", \"plan-b.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\n\t\t\"plan-a.md\": {HasRunning: true},\n\t\t\"plan-b.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Both plans have running instances so they should be expanded.\n\t// Expected: plan-a header, a-impl, plan-b header, b-impl\n\trequire.Len(t, n.rows, 4)\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, \"a-impl\", n.rows[1].Label)\n\tassert.Equal(t, navRowPlanHeader, n.rows[2].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[3].Kind)\n}\n\nfunc TestRebuildRows_SoloInstances(t *testing.T) {\n\tn := newTestPanel()\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"solo-1\", \"\", session.Running),\n\t\tmakeInst(\"solo-2\", \"\", session.Ready),\n\t}\n\tn.SetData(nil, instances, nil, nil, nil)\n\n\t// Solo instances: solo header + 2 instances\n\trequire.Len(t, n.rows, 3)\n\tassert.Equal(t, navRowSoloHeader, n.rows[0].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[2].Kind)\n}\n\nfunc TestRebuildRows_MixedPlanAndSolo(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"plan-impl\", \"plan.md\", session.Running),\n\t\tmakeInst(\"adhoc\", \"\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// plan header + plan instance + solo header + solo instance\n\trequire.Len(t, n.rows, 4)\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, \"plan-impl\", n.rows[1].Label)\n\tassert.Equal(t, navRowSoloHeader, n.rows[2].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[3].Kind)\n\tassert.Equal(t, \"adhoc\", n.rows[3].Label)\n}\n\nfunc TestRebuildRows_HistoryAndCancelled(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"old-plan.md\"}}\n\tcancelled := []PlanDisplay{{Filename: \"bad-plan.md\"}}\n\tn.SetData(nil, nil, history, cancelled, nil)\n\n\t// history toggle + cancelled row\n\trequire.Len(t, n.rows, 2)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n\tassert.Equal(t, navRowCancelled, n.rows[1].Kind)\n}\n\nfunc TestRebuildRows_HistoryExpanded(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{\n\t\t{Filename: \"old-a.md\"},\n\t\t{Filename: \"old-b.md\"},\n\t}\n\tn.SetData(nil, nil, history, nil, nil)\n\trequire.Len(t, n.rows, 1) // just the toggle, collapsed\n\n\t// Select the history toggle and expand it\n\tn.selectedIdx = 0\n\tn.ToggleSelectedExpand()\n\tassert.True(t, n.historyExpanded)\n\t// toggle + 2 history plans\n\trequire.Len(t, n.rows, 3)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n\tassert.Equal(t, navRowHistoryPlan, n.rows[1].Kind)\n\tassert.Equal(t, navRowHistoryPlan, n.rows[2].Kind)\n}\n\nfunc TestRebuildRows_DeadSection_DonePlanWithInstances(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Running)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Done plan with instances goes to dead section (expanded by default).\n\t// Expect: dead toggle + plan header + instance.\n\trequire.True(t, len(n.rows) >= 3)\n\tassert.Equal(t, navRowDeadToggle, n.rows[0].Kind)\n\tassert.Equal(t, \"dead\", n.rows[0].Label)\n\tassert.Equal(t, navRowPlanHeader, n.rows[1].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[2].Kind)\n\t// No history toggle since the only done plan went to dead.\n\tfor _, row := range n.rows {\n\t\tassert.NotEqual(t, navRowHistoryToggle, row.Kind)\n\t}\n}\n\nfunc TestRebuildRows_DeadSection_Collapsible(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Running)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Dead section is expanded by default.\n\tassert.True(t, n.deadExpanded)\n\trequire.True(t, len(n.rows) >= 3)\n\tassert.Equal(t, navRowPlanHeader, n.rows[1].Kind)\n\tassert.Equal(t, \"done-plan.md\", n.rows[1].PlanFile)\n\tassert.Equal(t, navRowInstance, n.rows[2].Kind)\n\tassert.Equal(t, \"worker\", n.rows[2].Label)\n\n\t// Collapse it.\n\tn.selectedIdx = 0\n\tn.ToggleSelectedExpand()\n\tassert.False(t, n.deadExpanded)\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowDeadToggle, n.rows[0].Kind)\n}\n\nfunc TestRebuildRows_DonePlanWithRunningInstances_AppearsInActiveSection(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Running)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Done plan with running instances should NOT be in dead section.\n\t// It should appear as an active plan (plan header + instance).\n\tfor _, row := range n.rows {\n\t\tassert.NotEqual(t, navRowDeadToggle, row.Kind,\n\t\t\t\"running instances should not be in dead section\")\n\t}\n\t// Should have plan header + instance in the active area.\n\trequire.True(t, len(n.rows) >= 2, \"expected at least plan header + instance, got %d rows\", len(n.rows))\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, \"done-plan.md\", n.rows[0].PlanFile)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, \"worker\", n.rows[1].Label)\n}\n\nfunc TestRebuildRows_DonePlanWithDeadInstances_GoesToDeadSection(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\t// Ready (not running) instance — plan should go to dead section.\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Ready)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Done plan with only non-running instances goes to dead section.\n\t// Plan header is collapsed (no running instances), so we get dead toggle + plan header.\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.Equal(t, navRowDeadToggle, n.rows[0].Kind)\n\tassert.Equal(t, \"dead\", n.rows[0].Label)\n\tassert.Equal(t, navRowPlanHeader, n.rows[1].Kind)\n}\n\nfunc TestRebuildRows_DonePlanMixedInstances_RunningPromotesToActive(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\t// Mix of running and ready instances — running takes priority.\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"ready-worker\", \"done-plan.md\", session.Ready),\n\t\tmakeInst(\"running-worker\", \"done-plan.md\", session.Running),\n\t}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Plan has at least one running instance → should be in active section, not dead.\n\tfor _, row := range n.rows {\n\t\tassert.NotEqual(t, navRowDeadToggle, row.Kind,\n\t\t\t\"plan with running instances should not be in dead section\")\n\t}\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, \"done-plan.md\", n.rows[0].PlanFile)\n}\n\nfunc TestRebuildRows_DeadSection_DonePlanWithoutInstances_GoesToHistory(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"clean-done.md\", Status: \"done\"}}\n\tn.SetData(nil, nil, history, nil, nil)\n\n\t// No instances → goes to history, not dead.\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n}\n\nfunc TestInspectPlan_MovesHistoryToDead(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{\n\t\t{Filename: \"plan-a.md\", Status: \"done\"},\n\t\t{Filename: \"plan-b.md\", Status: \"done\"},\n\t}\n\tn.SetData(nil, nil, history, nil, nil)\n\n\t// Both in history initially.\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n\n\t// Inspect plan-a → moves to dead.\n\tn.InspectPlan(\"plan-a.md\")\n\tassert.True(t, n.deadExpanded)\n\n\t// Should have dead toggle + plan header (expanded) + history toggle.\n\tvar hasDead, hasHistory bool\n\tfor _, row := range n.rows {\n\t\tif row.Kind == navRowDeadToggle {\n\t\t\thasDead = true\n\t\t}\n\t\tif row.Kind == navRowHistoryToggle {\n\t\t\thasHistory = true\n\t\t}\n\t}\n\tassert.True(t, hasDead, \"should have dead section\")\n\tassert.True(t, hasHistory, \"plan-b should still be in history\")\n}\n\nfunc TestRebuildRows_ClickUpAvailable(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetClickUpAvailable(true)\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowImportAction, n.rows[0].Kind)\n\tassert.Equal(t, SidebarImportClickUp, n.rows[0].ID)\n}\n\n// ---------- sort ordering ----------\n\nfunc TestSortOrder_NotificationsFirst(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"running.md\"},\n\t\t{Filename: \"notified.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"running-impl\", \"running.md\", session.Running),\n\t\tmakeInst(\"notified-impl\", \"notified.md\", session.Running),\n\t}\n\tinstances[1].Notified = true\n\tstatuses := map[string]TopicStatus{\n\t\t\"running.md\":  {HasRunning: true},\n\t\t\"notified.md\": {HasNotification: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Notified plan should sort before running-only plan.\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.Contains(t, n.rows[0].PlanFile, \"notified.md\")\n}\n\nfunc TestSortOrder_InstancesWithinPlan(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"paused\", \"plan.md\", session.Paused),\n\t\tmakeInst(\"running\", \"plan.md\", session.Running),\n\t\t{Title: \"notified\", PlanFile: \"plan.md\", Status: session.Running, Notified: true},\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true, HasNotification: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Within plan: notified (0) < running (1) < paused (3)\n\trequire.Len(t, n.rows, 4) // header + 3 instances\n\tassert.Equal(t, \"notified\", n.rows[1].Label)\n\tassert.Equal(t, \"running\", n.rows[2].Label)\n\tassert.Equal(t, \"paused\", n.rows[3].Label)\n}\n\n// ---------- navigation (Up/Down/Left/Right) ----------\n\nfunc TestNavigation_UpDown(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\t// rows: [header, instance]\n\trequire.Len(t, n.rows, 2)\n\n\tassert.Equal(t, 0, n.selectedIdx)\n\tn.Down()\n\tassert.Equal(t, 1, n.selectedIdx)\n\tn.Down() // at end, should stay\n\tassert.Equal(t, 1, n.selectedIdx)\n\tn.Up()\n\tassert.Equal(t, 0, n.selectedIdx)\n\tn.Up() // at start, should stay\n\tassert.Equal(t, 0, n.selectedIdx)\n}\n\nfunc TestNavigation_LeftCollapsesAndJumpsToParent(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Select the instance (row 1)\n\tn.selectedIdx = 1\n\t// Left on instance should jump to parent plan header\n\tn.Left()\n\tassert.Equal(t, 0, n.selectedIdx)\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\n\t// Left on expanded plan header should collapse it\n\tassert.False(t, n.rows[0].Collapsed)\n\tn.Left()\n\t// After collapse, rebuild happens — only plan header remains\n\trequire.Len(t, n.rows, 1)\n\tassert.True(t, n.rows[0].Collapsed)\n}\n\nfunc TestNavigation_RightExpandsAndDescends(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Ready), // Ready — not running\n\t}\n\tn.SetData(plans, instances, nil, nil, nil)\n\t// Plan has no running/notification → auto-collapsed\n\trequire.Len(t, n.rows, 1)\n\tassert.True(t, n.rows[0].Collapsed)\n\n\t// Right on collapsed plan should expand\n\tn.Right()\n\trequire.Len(t, n.rows, 2)\n\tassert.False(t, n.rows[0].Collapsed)\n\tassert.Equal(t, 0, n.selectedIdx) // still on header\n\n\t// Right on expanded plan should descend to first child\n\tn.Right()\n\tassert.Equal(t, 1, n.selectedIdx)\n}\n\n// ---------- expand/collapse ----------\n\nfunc TestToggleSelectedExpand_PlanHeader(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\trequire.Len(t, n.rows, 2) // expanded\n\n\tok := n.ToggleSelectedExpand()\n\tassert.True(t, ok)\n\trequire.Len(t, n.rows, 1) // collapsed\n\n\tok = n.ToggleSelectedExpand()\n\tassert.True(t, ok)\n\trequire.Len(t, n.rows, 2) // expanded again\n}\n\nfunc TestToggleSelectedExpand_Instance_ReturnsFalse(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\tn.selectedIdx = 1 // instance row\n\n\tok := n.ToggleSelectedExpand()\n\tassert.False(t, ok)\n}\n\nfunc TestAutoCollapse_NoRunningNoNotification(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Paused),\n\t}\n\tn.SetData(plans, instances, nil, nil, nil)\n\n\t// No running/notification → auto-collapsed, instance hidden\n\trequire.Len(t, n.rows, 1)\n\tassert.True(t, n.rows[0].Collapsed)\n}\n\nfunc TestUserOverride_PreservesCollapsedState(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// User manually collapses (sets override)\n\tn.ToggleSelectedExpand()\n\trequire.Len(t, n.rows, 1)\n\n\t// Refresh data — override should persist even though plan has running instances\n\tn.SetData(plans, instances, nil, nil, statuses)\n\trequire.Len(t, n.rows, 1, \"user override should keep plan collapsed\")\n}\n\n// ---------- selection API ----------\n\nfunc TestGetSelectedInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"solo\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst}, nil, nil, nil)\n\n\t// row 0 = solo header, row 1 = instance\n\tn.selectedIdx = 0\n\tassert.Nil(t, n.GetSelectedInstance())\n\n\tn.selectedIdx = 1\n\tassert.Equal(t, inst, n.GetSelectedInstance())\n}\n\nfunc TestGetSelectedPlanFile(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\t// Plan header row\n\tn.selectedIdx = 0\n\tassert.Equal(t, \"plan.md\", n.GetSelectedPlanFile())\n}\n\nfunc TestIsSelectedPlanHeader(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\tn.selectedIdx = 0\n\tassert.True(t, n.IsSelectedPlanHeader())\n\n\tn.selectedIdx = 1\n\tassert.False(t, n.IsSelectedPlanHeader())\n}\n\nfunc TestSoloHeaderSkippedDuringNavigation(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"plan-impl\", \"plan.md\", session.Running),\n\t\tmakeInst(\"adhoc\", \"\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Layout: [0]=plan header, [1]=plan-impl, [2]=solo header, [3]=adhoc\n\n\t// Down from plan-impl should skip solo header, land on adhoc\n\tn.selectedIdx = 1\n\tn.Down()\n\tassert.Equal(t, 3, n.selectedIdx, \"Down should skip solo header\")\n\n\t// Up from adhoc should skip solo header, land on plan-impl\n\tn.Up()\n\tassert.Equal(t, 1, n.selectedIdx, \"Up should skip solo header\")\n}\n\nfunc TestSoloHeaderSkippedBySelectFirst(t *testing.T) {\n\tn := newTestPanel()\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"adhoc\", \"\", session.Running),\n\t}\n\tn.SetData(nil, instances, nil, nil, nil)\n\n\t// Layout: [0]=solo header, [1]=adhoc\n\tn.SelectFirst()\n\tassert.Equal(t, 1, n.selectedIdx, \"SelectFirst should skip solo header\")\n}\n\nfunc TestSelectByID(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"a.md\"},\n\t\t{Filename: \"b.md\"},\n\t}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\tok := n.SelectByID(SidebarPlanPrefix + \"b.md\")\n\tassert.True(t, ok)\n\tassert.Equal(t, \"b.md\", n.GetSelectedPlanFile())\n}\n\nfunc TestSelectInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"s1\", \"\", session.Running)\n\tinst2 := makeInst(\"s2\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2}, nil, nil, nil)\n\n\tok := n.SelectInstance(inst2)\n\tassert.True(t, ok)\n\tassert.Equal(t, inst2, n.GetSelectedInstance())\n}\n\nfunc TestGetSelectedID(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"my-plan.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\tassert.Equal(t, SidebarPlanPrefix+\"my-plan.md\", n.GetSelectedID())\n}\n\n// ---------- selection persistence ----------\n\nfunc TestSelectionPersistence_AcrossRebuild(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"a.md\"},\n\t\t{Filename: \"b.md\"},\n\t}\n\tn.SetData(plans, nil, nil, nil, nil)\n\tn.selectedIdx = 1 // select plan-b header\n\tprevID := n.rows[1].ID\n\n\t// Refresh data — same plans, selection should be preserved\n\tn.SetData(plans, nil, nil, nil, nil)\n\tassert.Equal(t, prevID, n.rows[n.selectedIdx].ID)\n}\n\n// ---------- Kill/Remove ----------\n\nfunc TestRemoveByTitle(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"keep\", \"\", session.Running)\n\tinst2 := makeInst(\"remove-me\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2}, nil, nil, nil)\n\n\tremoved := n.RemoveByTitle(\"remove-me\")\n\tassert.NotNil(t, removed)\n\tassert.Equal(t, \"remove-me\", removed.Title)\n\tassert.Equal(t, 1, n.TotalInstances())\n}\n\nfunc TestRemoveByTitle_NotFound(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"x\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst}, nil, nil, nil)\n\n\tremoved := n.RemoveByTitle(\"nonexistent\")\n\tassert.Nil(t, removed)\n\tassert.Equal(t, 1, n.TotalInstances())\n}\n\nfunc TestRemove_SelectedInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"target\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst}, nil, nil, nil)\n\tn.selectedIdx = 1 // instance row\n\n\tn.Remove()\n\tassert.Equal(t, 0, n.TotalInstances())\n}\n\n// ---------- search ----------\n\nfunc TestSearch_ActivateDeactivate(t *testing.T) {\n\tn := newTestPanel()\n\tassert.False(t, n.IsSearchActive())\n\n\tn.ActivateSearch()\n\tassert.True(t, n.IsSearchActive())\n\tassert.Equal(t, \"\", n.GetSearchQuery())\n\n\tn.SetSearchQuery(\"hello\")\n\tassert.Equal(t, \"hello\", n.GetSearchQuery())\n\n\tn.DeactivateSearch()\n\tassert.False(t, n.IsSearchActive())\n\tassert.Equal(t, \"\", n.GetSearchQuery())\n}\n\nfunc TestSearch_FiltersVisibleRows(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(80, 40)\n\tplans := []PlanDisplay{\n\t\t{Filename: \"auth-plan.md\"},\n\t\t{Filename: \"billing-plan.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"auth-impl\", \"auth-plan.md\", session.Running),\n\t\tmakeInst(\"billing-impl\", \"billing-plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\n\t\t\"auth-plan.md\":    {HasRunning: true},\n\t\t\"billing-plan.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\tn.ActivateSearch()\n\tn.SetSearchQuery(\"auth\")\n\toutput := n.String()\n\tassert.Contains(t, output, \"auth\")\n\t// billing should be filtered out\n\tassert.NotContains(t, output, \"billing\")\n}\n\n// ---------- rendering ----------\n\nfunc TestString_BasicOutput(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tplans := []PlanDisplay{{Filename: \"my-plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"worker\", \"my-plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"my-plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\toutput := n.String()\n\tassert.Contains(t, output, \"my-plan\")\n\tassert.Contains(t, output, \"worker\")\n}\n\nfunc TestString_EmptyPanel(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tn.SetData(nil, nil, nil, nil, nil)\n\toutput := n.String()\n\tassert.NotEmpty(t, output) // should still render search box + border\n}\n\n// ---------- CycleActive ----------\n\nfunc TestCycleNextActive(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"a\", \"\", session.Running)\n\tinst2 := makeInst(\"b\", \"\", session.Paused)\n\tinst3 := makeInst(\"c\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2, inst3}, nil, nil, nil)\n\n\t// Select first instance\n\tn.SelectInstance(inst1)\n\t// CycleNextActive should skip paused inst2 and land on inst3\n\tn.CycleNextActive()\n\tassert.Equal(t, inst3, n.GetSelectedInstance())\n}\n\nfunc TestCyclePrevActive(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"a\", \"\", session.Running)\n\tinst2 := makeInst(\"b\", \"\", session.Paused)\n\tinst3 := makeInst(\"c\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2, inst3}, nil, nil, nil)\n\n\t// Select last instance\n\tn.SelectInstance(inst3)\n\tn.CyclePrevActive()\n\tassert.Equal(t, inst1, n.GetSelectedInstance())\n}\n\n// ---------- misc ----------\n\nfunc TestSetSize(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(100, 50)\n\tassert.Equal(t, 100, n.width)\n\tassert.Equal(t, 50, n.height)\n}\n\nfunc TestSetFocused(t *testing.T) {\n\tn := newTestPanel()\n\tassert.True(t, n.IsFocused()) // default\n\tn.SetFocused(false)\n\tassert.False(t, n.IsFocused())\n}\n\nfunc TestSelectedSpaceAction(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Plan header expanded → \"collapse\"\n\tn.selectedIdx = 0\n\tassert.Equal(t, \"collapse\", n.SelectedSpaceAction())\n\n\t// Collapse it\n\tn.ToggleSelectedExpand()\n\tassert.Equal(t, \"expand\", n.SelectedSpaceAction())\n\n\t// Instance → \"toggle\"\n\tn.ToggleSelectedExpand()\n\tn.selectedIdx = 1\n\tassert.Equal(t, \"toggle\", n.SelectedSpaceAction())\n}\n\nfunc TestAddInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"new\", \"\", session.Loading)\n\tcleanup := n.AddInstance(inst)\n\tassert.NotNil(t, cleanup)\n\tassert.Equal(t, 1, n.TotalInstances())\n\tassert.Equal(t, inst, n.GetInstances()[0])\n}\n\nfunc TestClear(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetData(nil, []*session.Instance{makeInst(\"x\", \"\", session.Running)}, nil, nil, nil)\n\tassert.Equal(t, 1, n.TotalInstances())\n\n\tn.Clear()\n\tassert.Equal(t, 0, n.TotalInstances())\n\tassert.Empty(t, n.rows)\n}\n\nfunc TestSelectFirst(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"a.md\"}, {Filename: \"b.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\tn.selectedIdx = 1\n\n\tn.SelectFirst()\n\tassert.Equal(t, 0, n.selectedIdx)\n}\n\nfunc TestClickItem(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"a.md\"}, {Filename: \"b.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\tn.ClickItem(1)\n\tassert.Equal(t, 1, n.selectedIdx)\n}\n\n// ---------- SelectInstance auto-expand ----------\n\nfunc TestSelectInstance_ExpandsCollapsedPlan(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinst := makeInst(\"worker\", \"p.md\", session.Ready)\n\t// No running/notification → plan auto-collapses, instance hidden\n\tn.SetData(plans, []*session.Instance{inst}, nil, nil, nil)\n\trequire.Len(t, n.rows, 1, \"plan should be auto-collapsed\")\n\tassert.True(t, n.rows[0].Collapsed)\n\n\t// SelectInstance should auto-expand the plan to reveal the instance\n\tok := n.SelectInstance(inst)\n\tassert.True(t, ok, \"SelectInstance should succeed by expanding the plan\")\n\tassert.Equal(t, inst, n.GetSelectedInstance())\n\t// Plan should now be expanded\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.False(t, n.rows[0].Collapsed)\n}\n\nfunc TestCycleActive_ExpandsCollapsedPlan(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"a.md\"},\n\t\t{Filename: \"b.md\"},\n\t}\n\tinstA := makeInst(\"a-worker\", \"a.md\", session.Running)\n\tinstB := makeInst(\"b-worker\", \"b.md\", session.Running)\n\tstatuses := map[string]TopicStatus{\n\t\t\"a.md\": {HasRunning: true},\n\t\t\"b.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, []*session.Instance{instA, instB}, nil, nil, statuses)\n\n\t// Select A, then manually collapse B\n\tn.SelectInstance(instA)\n\t// Find B's plan header and collapse it\n\tfor i, row := range n.rows {\n\t\tif row.Kind == navRowPlanHeader && row.PlanFile == \"b.md\" {\n\t\t\tn.selectedIdx = i\n\t\t\tn.ToggleSelectedExpand()\n\t\t\tbreak\n\t\t}\n\t}\n\t// Go back to instA\n\tn.SelectInstance(instA)\n\n\t// CycleNextActive should find instB even though its plan is collapsed\n\tn.CycleNextActive()\n\tassert.Equal(t, instB, n.GetSelectedInstance(), \"cycle should auto-expand collapsed plan\")\n}\n\n// ---------- FindPlanInstance ----------\n\nfunc TestFindPlanInstance_ReturnsRunning(t *testing.T) {\n\tn := newTestPanel()\n\tready := &session.Instance{Title: \"ready\", PlanFile: \"p.md\", Status: session.Ready}\n\trunning := &session.Instance{Title: \"running\", PlanFile: \"p.md\", Status: session.Running}\n\tn.SetData(nil, []*session.Instance{ready, running}, nil, nil, nil)\n\n\tresult := n.FindPlanInstance(\"p.md\")\n\tassert.Equal(t, running, result, \"should prefer running instance\")\n}\n\nfunc TestFindPlanInstance_NoneStarted(t *testing.T) {\n\tn := newTestPanel()\n\tpaused := makeInst(\"paused\", \"p.md\", session.Paused)\n\tn.SetData(nil, []*session.Instance{paused}, nil, nil, nil)\n\n\tresult := n.FindPlanInstance(\"p.md\")\n\tassert.Nil(t, result, \"paused-only plan should return nil\")\n}\n\n// ---------- rendering ----------\n\nfunc TestString_SectionHeaders(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 40)\n\tplans := []PlanDisplay{\n\t\t{Filename: \"active-plan.md\"},\n\t\t{Filename: \"idle-plan.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"worker\", \"active-plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\n\t\t\"active-plan.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\toutput := n.String()\n\tassert.Contains(t, output, \"active\")\n\tassert.Contains(t, output, \"idle\")\n}\n\nfunc TestString_InstanceDisplayTitle(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinst := &session.Instance{\n\t\tTitle:      \"p-W2-T5\",\n\t\tPlanFile:   \"p.md\",\n\t\tStatus:     session.Running,\n\t\tWaveNumber: 2,\n\t\tTaskNumber: 5,\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, []*session.Instance{inst}, nil, nil, statuses)\n\n\toutput := n.String()\n\tassert.Contains(t, output, \"wave 2\")\n\tassert.Contains(t, output, \"task 5\")\n\tassert.NotContains(t, output, \"W2-T5\", \"raw wave/task format should not appear\")\n}\n\nfunc TestString_Legend(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tn.SetData(nil, nil, nil, nil, nil)\n\toutput := n.String()\n\tassert.Contains(t, output, \"running\")\n\tassert.Contains(t, output, \"review\")\n\tassert.Contains(t, output, \"idle\")\n}\n",
              "after": "package ui\n\nimport (\n\t\"testing\"\n\n\t\"github.com/charmbracelet/bubbles/spinner\"\n\t\"github.com/kastheco/kasmos/session\"\n\t\"github.com/stretchr/testify/assert\"\n\t\"github.com/stretchr/testify/require\"\n)\n\nfunc newTestPanel() *NavigationPanel {\n\tsp := spinner.New(spinner.WithSpinner(spinner.Dot))\n\treturn NewNavigationPanel(&sp)\n}\n\nfunc makeInst(title, planFile string, status session.Status) *session.Instance {\n\treturn &session.Instance{\n\t\tTitle:    title,\n\t\tPlanFile: planFile,\n\t\tStatus:   status,\n\t}\n}\n\n// ---------- rebuildRows grouping ----------\n\nfunc TestRebuildRows_EmptyPanel(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetData(nil, nil, nil, nil, nil)\n\tassert.Empty(t, n.rows)\n\tassert.Equal(t, 0, n.selectedIdx)\n}\n\nfunc TestRebuildRows_PlansWithInstances(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"plan-a.md\"},\n\t\t{Filename: \"plan-b.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"a-impl\", \"plan-a.md\", session.Running),\n\t\tmakeInst(\"b-impl\", \"plan-b.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\n\t\t\"plan-a.md\": {HasRunning: true},\n\t\t\"plan-b.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Both plans have running instances so they should be expanded.\n\t// Expected: plan-a header, a-impl, plan-b header, b-impl\n\trequire.Len(t, n.rows, 4)\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, \"a-impl\", n.rows[1].Label)\n\tassert.Equal(t, navRowPlanHeader, n.rows[2].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[3].Kind)\n}\n\nfunc TestRebuildRows_SoloInstances(t *testing.T) {\n\tn := newTestPanel()\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"solo-1\", \"\", session.Running),\n\t\tmakeInst(\"solo-2\", \"\", session.Ready),\n\t}\n\tn.SetData(nil, instances, nil, nil, nil)\n\n\t// Solo instances: solo header + 2 instances\n\trequire.Len(t, n.rows, 3)\n\tassert.Equal(t, navRowSoloHeader, n.rows[0].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[2].Kind)\n}\n\nfunc TestRebuildRows_MixedPlanAndSolo(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"plan-impl\", \"plan.md\", session.Running),\n\t\tmakeInst(\"adhoc\", \"\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// plan header + plan instance + solo header + solo instance\n\trequire.Len(t, n.rows, 4)\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, \"plan-impl\", n.rows[1].Label)\n\tassert.Equal(t, navRowSoloHeader, n.rows[2].Kind)\n\tassert.Equal(t, navRowInstance, n.rows[3].Kind)\n\tassert.Equal(t, \"adhoc\", n.rows[3].Label)\n}\n\nfunc TestRebuildRows_HistoryAndCancelled(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"old-plan.md\"}}\n\tcancelled := []PlanDisplay{{Filename: \"bad-plan.md\"}}\n\tn.SetData(nil, nil, history, cancelled, nil)\n\n\t// history toggle + cancelled row\n\trequire.Len(t, n.rows, 2)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n\tassert.Equal(t, navRowCancelled, n.rows[1].Kind)\n}\n\nfunc TestRebuildRows_HistoryExpanded(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{\n\t\t{Filename: \"old-a.md\"},\n\t\t{Filename: \"old-b.md\"},\n\t}\n\tn.SetData(nil, nil, history, nil, nil)\n\trequire.Len(t, n.rows, 1) // just the toggle, collapsed\n\n\t// Select the history toggle and expand it\n\tn.selectedIdx = 0\n\tn.ToggleSelectedExpand()\n\tassert.True(t, n.historyExpanded)\n\t// toggle + 2 history plans\n\trequire.Len(t, n.rows, 3)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n\tassert.Equal(t, navRowHistoryPlan, n.rows[1].Kind)\n\tassert.Equal(t, navRowHistoryPlan, n.rows[2].Kind)\n}\n\nfunc TestRebuildRows_DeadSection_DonePlanWithNonRunningInstances(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\t// Ready (non-running) instance — plan goes to dead section.\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Ready)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Done plan with non-running instances goes to dead section (expanded by default).\n\t// Plan header is auto-collapsed (no running instances), so no child instance rows.\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.Equal(t, navRowDeadToggle, n.rows[0].Kind)\n\tassert.Equal(t, \"dead\", n.rows[0].Label)\n\tassert.Equal(t, navRowPlanHeader, n.rows[1].Kind)\n\t// No history toggle since the only done plan went to dead.\n\tfor _, row := range n.rows {\n\t\tassert.NotEqual(t, navRowHistoryToggle, row.Kind)\n\t}\n}\n\nfunc TestRebuildRows_DeadSection_Collapsible(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\t// Use Ready (non-running) instance so plan goes to dead section.\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Ready)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Dead section is expanded by default.\n\tassert.True(t, n.deadExpanded)\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.Equal(t, navRowPlanHeader, n.rows[1].Kind)\n\tassert.Equal(t, \"done-plan.md\", n.rows[1].PlanFile)\n\t// Plan header is auto-collapsed (no running instances), so instance row is hidden.\n\n\t// Collapse the dead section.\n\tn.selectedIdx = 0\n\tn.ToggleSelectedExpand()\n\tassert.False(t, n.deadExpanded)\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowDeadToggle, n.rows[0].Kind)\n}\n\nfunc TestRebuildRows_DonePlanWithRunningInstances_AppearsInActiveSection(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Running)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Done plan with running instances should NOT be in dead section.\n\t// It should appear as an active plan (plan header + instance).\n\tfor _, row := range n.rows {\n\t\tassert.NotEqual(t, navRowDeadToggle, row.Kind,\n\t\t\t\"running instances should not be in dead section\")\n\t}\n\t// Should have plan header + instance in the active area.\n\trequire.True(t, len(n.rows) >= 2, \"expected at least plan header + instance, got %d rows\", len(n.rows))\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, \"done-plan.md\", n.rows[0].PlanFile)\n\tassert.Equal(t, navRowInstance, n.rows[1].Kind)\n\tassert.Equal(t, \"worker\", n.rows[1].Label)\n}\n\nfunc TestRebuildRows_DonePlanWithDeadInstances_GoesToDeadSection(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\t// Ready (not running) instance — plan should go to dead section.\n\tinstances := []*session.Instance{makeInst(\"worker\", \"done-plan.md\", session.Ready)}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Done plan with only non-running instances goes to dead section.\n\t// Plan header is collapsed (no running instances), so we get dead toggle + plan header.\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.Equal(t, navRowDeadToggle, n.rows[0].Kind)\n\tassert.Equal(t, \"dead\", n.rows[0].Label)\n\tassert.Equal(t, navRowPlanHeader, n.rows[1].Kind)\n}\n\nfunc TestRebuildRows_DonePlanMixedInstances_RunningPromotesToActive(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"done-plan.md\", Status: \"done\"}}\n\t// Mix of running and ready instances — running takes priority.\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"ready-worker\", \"done-plan.md\", session.Ready),\n\t\tmakeInst(\"running-worker\", \"done-plan.md\", session.Running),\n\t}\n\tn.SetData(nil, instances, history, nil, nil)\n\n\t// Plan has at least one running instance → should be in active section, not dead.\n\tfor _, row := range n.rows {\n\t\tassert.NotEqual(t, navRowDeadToggle, row.Kind,\n\t\t\t\"plan with running instances should not be in dead section\")\n\t}\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\tassert.Equal(t, \"done-plan.md\", n.rows[0].PlanFile)\n}\n\nfunc TestRebuildRows_DeadSection_DonePlanWithoutInstances_GoesToHistory(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{{Filename: \"clean-done.md\", Status: \"done\"}}\n\tn.SetData(nil, nil, history, nil, nil)\n\n\t// No instances → goes to history, not dead.\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n}\n\nfunc TestInspectPlan_MovesHistoryToDead(t *testing.T) {\n\tn := newTestPanel()\n\thistory := []PlanDisplay{\n\t\t{Filename: \"plan-a.md\", Status: \"done\"},\n\t\t{Filename: \"plan-b.md\", Status: \"done\"},\n\t}\n\tn.SetData(nil, nil, history, nil, nil)\n\n\t// Both in history initially.\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowHistoryToggle, n.rows[0].Kind)\n\n\t// Inspect plan-a → moves to dead.\n\tn.InspectPlan(\"plan-a.md\")\n\tassert.True(t, n.deadExpanded)\n\n\t// Should have dead toggle + plan header (expanded) + history toggle.\n\tvar hasDead, hasHistory bool\n\tfor _, row := range n.rows {\n\t\tif row.Kind == navRowDeadToggle {\n\t\t\thasDead = true\n\t\t}\n\t\tif row.Kind == navRowHistoryToggle {\n\t\t\thasHistory = true\n\t\t}\n\t}\n\tassert.True(t, hasDead, \"should have dead section\")\n\tassert.True(t, hasHistory, \"plan-b should still be in history\")\n}\n\nfunc TestRebuildRows_ClickUpAvailable(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetClickUpAvailable(true)\n\trequire.Len(t, n.rows, 1)\n\tassert.Equal(t, navRowImportAction, n.rows[0].Kind)\n\tassert.Equal(t, SidebarImportClickUp, n.rows[0].ID)\n}\n\n// ---------- sort ordering ----------\n\nfunc TestSortOrder_NotificationsFirst(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"running.md\"},\n\t\t{Filename: \"notified.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"running-impl\", \"running.md\", session.Running),\n\t\tmakeInst(\"notified-impl\", \"notified.md\", session.Running),\n\t}\n\tinstances[1].Notified = true\n\tstatuses := map[string]TopicStatus{\n\t\t\"running.md\":  {HasRunning: true},\n\t\t\"notified.md\": {HasNotification: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Notified plan should sort before running-only plan.\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.Contains(t, n.rows[0].PlanFile, \"notified.md\")\n}\n\nfunc TestSortOrder_InstancesWithinPlan(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"paused\", \"plan.md\", session.Paused),\n\t\tmakeInst(\"running\", \"plan.md\", session.Running),\n\t\t{Title: \"notified\", PlanFile: \"plan.md\", Status: session.Running, Notified: true},\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true, HasNotification: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Within plan: notified (0) < running (1) < paused (3)\n\trequire.Len(t, n.rows, 4) // header + 3 instances\n\tassert.Equal(t, \"notified\", n.rows[1].Label)\n\tassert.Equal(t, \"running\", n.rows[2].Label)\n\tassert.Equal(t, \"paused\", n.rows[3].Label)\n}\n\n// ---------- navigation (Up/Down/Left/Right) ----------\n\nfunc TestNavigation_UpDown(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\t// rows: [header, instance]\n\trequire.Len(t, n.rows, 2)\n\n\tassert.Equal(t, 0, n.selectedIdx)\n\tn.Down()\n\tassert.Equal(t, 1, n.selectedIdx)\n\tn.Down() // at end, should stay\n\tassert.Equal(t, 1, n.selectedIdx)\n\tn.Up()\n\tassert.Equal(t, 0, n.selectedIdx)\n\tn.Up() // at start, should stay\n\tassert.Equal(t, 0, n.selectedIdx)\n}\n\nfunc TestNavigation_LeftCollapsesAndJumpsToParent(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Select the instance (row 1)\n\tn.selectedIdx = 1\n\t// Left on instance should jump to parent plan header\n\tn.Left()\n\tassert.Equal(t, 0, n.selectedIdx)\n\tassert.Equal(t, navRowPlanHeader, n.rows[0].Kind)\n\n\t// Left on expanded plan header should collapse it\n\tassert.False(t, n.rows[0].Collapsed)\n\tn.Left()\n\t// After collapse, rebuild happens — only plan header remains\n\trequire.Len(t, n.rows, 1)\n\tassert.True(t, n.rows[0].Collapsed)\n}\n\nfunc TestNavigation_RightExpandsAndDescends(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Ready), // Ready — not running\n\t}\n\tn.SetData(plans, instances, nil, nil, nil)\n\t// Plan has no running/notification → auto-collapsed\n\trequire.Len(t, n.rows, 1)\n\tassert.True(t, n.rows[0].Collapsed)\n\n\t// Right on collapsed plan should expand\n\tn.Right()\n\trequire.Len(t, n.rows, 2)\n\tassert.False(t, n.rows[0].Collapsed)\n\tassert.Equal(t, 0, n.selectedIdx) // still on header\n\n\t// Right on expanded plan should descend to first child\n\tn.Right()\n\tassert.Equal(t, 1, n.selectedIdx)\n}\n\n// ---------- expand/collapse ----------\n\nfunc TestToggleSelectedExpand_PlanHeader(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\trequire.Len(t, n.rows, 2) // expanded\n\n\tok := n.ToggleSelectedExpand()\n\tassert.True(t, ok)\n\trequire.Len(t, n.rows, 1) // collapsed\n\n\tok = n.ToggleSelectedExpand()\n\tassert.True(t, ok)\n\trequire.Len(t, n.rows, 2) // expanded again\n}\n\nfunc TestToggleSelectedExpand_Instance_ReturnsFalse(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\tn.selectedIdx = 1 // instance row\n\n\tok := n.ToggleSelectedExpand()\n\tassert.False(t, ok)\n}\n\nfunc TestAutoCollapse_NoRunningNoNotification(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Paused),\n\t}\n\tn.SetData(plans, instances, nil, nil, nil)\n\n\t// No running/notification → auto-collapsed, instance hidden\n\trequire.Len(t, n.rows, 1)\n\tassert.True(t, n.rows[0].Collapsed)\n}\n\nfunc TestUserOverride_PreservesCollapsedState(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// User manually collapses (sets override)\n\tn.ToggleSelectedExpand()\n\trequire.Len(t, n.rows, 1)\n\n\t// Refresh data — override should persist even though plan has running instances\n\tn.SetData(plans, instances, nil, nil, statuses)\n\trequire.Len(t, n.rows, 1, \"user override should keep plan collapsed\")\n}\n\n// ---------- selection API ----------\n\nfunc TestGetSelectedInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"solo\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst}, nil, nil, nil)\n\n\t// row 0 = solo header, row 1 = instance\n\tn.selectedIdx = 0\n\tassert.Nil(t, n.GetSelectedInstance())\n\n\tn.selectedIdx = 1\n\tassert.Equal(t, inst, n.GetSelectedInstance())\n}\n\nfunc TestGetSelectedPlanFile(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\t// Plan header row\n\tn.selectedIdx = 0\n\tassert.Equal(t, \"plan.md\", n.GetSelectedPlanFile())\n}\n\nfunc TestIsSelectedPlanHeader(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\tn.selectedIdx = 0\n\tassert.True(t, n.IsSelectedPlanHeader())\n\n\tn.selectedIdx = 1\n\tassert.False(t, n.IsSelectedPlanHeader())\n}\n\nfunc TestSoloHeaderSkippedDuringNavigation(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"plan-impl\", \"plan.md\", session.Running),\n\t\tmakeInst(\"adhoc\", \"\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Layout: [0]=plan header, [1]=plan-impl, [2]=solo header, [3]=adhoc\n\n\t// Down from plan-impl should skip solo header, land on adhoc\n\tn.selectedIdx = 1\n\tn.Down()\n\tassert.Equal(t, 3, n.selectedIdx, \"Down should skip solo header\")\n\n\t// Up from adhoc should skip solo header, land on plan-impl\n\tn.Up()\n\tassert.Equal(t, 1, n.selectedIdx, \"Up should skip solo header\")\n}\n\nfunc TestSoloHeaderSkippedBySelectFirst(t *testing.T) {\n\tn := newTestPanel()\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"adhoc\", \"\", session.Running),\n\t}\n\tn.SetData(nil, instances, nil, nil, nil)\n\n\t// Layout: [0]=solo header, [1]=adhoc\n\tn.SelectFirst()\n\tassert.Equal(t, 1, n.selectedIdx, \"SelectFirst should skip solo header\")\n}\n\nfunc TestSelectByID(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"a.md\"},\n\t\t{Filename: \"b.md\"},\n\t}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\tok := n.SelectByID(SidebarPlanPrefix + \"b.md\")\n\tassert.True(t, ok)\n\tassert.Equal(t, \"b.md\", n.GetSelectedPlanFile())\n}\n\nfunc TestSelectInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"s1\", \"\", session.Running)\n\tinst2 := makeInst(\"s2\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2}, nil, nil, nil)\n\n\tok := n.SelectInstance(inst2)\n\tassert.True(t, ok)\n\tassert.Equal(t, inst2, n.GetSelectedInstance())\n}\n\nfunc TestGetSelectedID(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"my-plan.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\tassert.Equal(t, SidebarPlanPrefix+\"my-plan.md\", n.GetSelectedID())\n}\n\n// ---------- selection persistence ----------\n\nfunc TestSelectionPersistence_AcrossRebuild(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"a.md\"},\n\t\t{Filename: \"b.md\"},\n\t}\n\tn.SetData(plans, nil, nil, nil, nil)\n\tn.selectedIdx = 1 // select plan-b header\n\tprevID := n.rows[1].ID\n\n\t// Refresh data — same plans, selection should be preserved\n\tn.SetData(plans, nil, nil, nil, nil)\n\tassert.Equal(t, prevID, n.rows[n.selectedIdx].ID)\n}\n\n// ---------- Kill/Remove ----------\n\nfunc TestRemoveByTitle(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"keep\", \"\", session.Running)\n\tinst2 := makeInst(\"remove-me\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2}, nil, nil, nil)\n\n\tremoved := n.RemoveByTitle(\"remove-me\")\n\tassert.NotNil(t, removed)\n\tassert.Equal(t, \"remove-me\", removed.Title)\n\tassert.Equal(t, 1, n.TotalInstances())\n}\n\nfunc TestRemoveByTitle_NotFound(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"x\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst}, nil, nil, nil)\n\n\tremoved := n.RemoveByTitle(\"nonexistent\")\n\tassert.Nil(t, removed)\n\tassert.Equal(t, 1, n.TotalInstances())\n}\n\nfunc TestRemove_SelectedInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"target\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst}, nil, nil, nil)\n\tn.selectedIdx = 1 // instance row\n\n\tn.Remove()\n\tassert.Equal(t, 0, n.TotalInstances())\n}\n\n// ---------- search ----------\n\nfunc TestSearch_ActivateDeactivate(t *testing.T) {\n\tn := newTestPanel()\n\tassert.False(t, n.IsSearchActive())\n\n\tn.ActivateSearch()\n\tassert.True(t, n.IsSearchActive())\n\tassert.Equal(t, \"\", n.GetSearchQuery())\n\n\tn.SetSearchQuery(\"hello\")\n\tassert.Equal(t, \"hello\", n.GetSearchQuery())\n\n\tn.DeactivateSearch()\n\tassert.False(t, n.IsSearchActive())\n\tassert.Equal(t, \"\", n.GetSearchQuery())\n}\n\nfunc TestSearch_FiltersVisibleRows(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(80, 40)\n\tplans := []PlanDisplay{\n\t\t{Filename: \"auth-plan.md\"},\n\t\t{Filename: \"billing-plan.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"auth-impl\", \"auth-plan.md\", session.Running),\n\t\tmakeInst(\"billing-impl\", \"billing-plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\n\t\t\"auth-plan.md\":    {HasRunning: true},\n\t\t\"billing-plan.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\tn.ActivateSearch()\n\tn.SetSearchQuery(\"auth\")\n\toutput := n.String()\n\tassert.Contains(t, output, \"auth\")\n\t// billing should be filtered out\n\tassert.NotContains(t, output, \"billing\")\n}\n\n// ---------- rendering ----------\n\nfunc TestString_BasicOutput(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tplans := []PlanDisplay{{Filename: \"my-plan.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"worker\", \"my-plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"my-plan.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\toutput := n.String()\n\tassert.Contains(t, output, \"my-plan\")\n\tassert.Contains(t, output, \"worker\")\n}\n\nfunc TestString_EmptyPanel(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tn.SetData(nil, nil, nil, nil, nil)\n\toutput := n.String()\n\tassert.NotEmpty(t, output) // should still render search box + border\n}\n\n// ---------- CycleActive ----------\n\nfunc TestCycleNextActive(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"a\", \"\", session.Running)\n\tinst2 := makeInst(\"b\", \"\", session.Paused)\n\tinst3 := makeInst(\"c\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2, inst3}, nil, nil, nil)\n\n\t// Select first instance\n\tn.SelectInstance(inst1)\n\t// CycleNextActive should skip paused inst2 and land on inst3\n\tn.CycleNextActive()\n\tassert.Equal(t, inst3, n.GetSelectedInstance())\n}\n\nfunc TestCyclePrevActive(t *testing.T) {\n\tn := newTestPanel()\n\tinst1 := makeInst(\"a\", \"\", session.Running)\n\tinst2 := makeInst(\"b\", \"\", session.Paused)\n\tinst3 := makeInst(\"c\", \"\", session.Running)\n\tn.SetData(nil, []*session.Instance{inst1, inst2, inst3}, nil, nil, nil)\n\n\t// Select last instance\n\tn.SelectInstance(inst3)\n\tn.CyclePrevActive()\n\tassert.Equal(t, inst1, n.GetSelectedInstance())\n}\n\n// ---------- misc ----------\n\nfunc TestSetSize(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(100, 50)\n\tassert.Equal(t, 100, n.width)\n\tassert.Equal(t, 50, n.height)\n}\n\nfunc TestSetFocused(t *testing.T) {\n\tn := newTestPanel()\n\tassert.True(t, n.IsFocused()) // default\n\tn.SetFocused(false)\n\tassert.False(t, n.IsFocused())\n}\n\nfunc TestSelectedSpaceAction(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"inst\", \"p.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\n\t// Plan header expanded → \"collapse\"\n\tn.selectedIdx = 0\n\tassert.Equal(t, \"collapse\", n.SelectedSpaceAction())\n\n\t// Collapse it\n\tn.ToggleSelectedExpand()\n\tassert.Equal(t, \"expand\", n.SelectedSpaceAction())\n\n\t// Instance → \"toggle\"\n\tn.ToggleSelectedExpand()\n\tn.selectedIdx = 1\n\tassert.Equal(t, \"toggle\", n.SelectedSpaceAction())\n}\n\nfunc TestAddInstance(t *testing.T) {\n\tn := newTestPanel()\n\tinst := makeInst(\"new\", \"\", session.Loading)\n\tcleanup := n.AddInstance(inst)\n\tassert.NotNil(t, cleanup)\n\tassert.Equal(t, 1, n.TotalInstances())\n\tassert.Equal(t, inst, n.GetInstances()[0])\n}\n\nfunc TestClear(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetData(nil, []*session.Instance{makeInst(\"x\", \"\", session.Running)}, nil, nil, nil)\n\tassert.Equal(t, 1, n.TotalInstances())\n\n\tn.Clear()\n\tassert.Equal(t, 0, n.TotalInstances())\n\tassert.Empty(t, n.rows)\n}\n\nfunc TestSelectFirst(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"a.md\"}, {Filename: \"b.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\tn.selectedIdx = 1\n\n\tn.SelectFirst()\n\tassert.Equal(t, 0, n.selectedIdx)\n}\n\nfunc TestClickItem(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"a.md\"}, {Filename: \"b.md\"}}\n\tn.SetData(plans, nil, nil, nil, nil)\n\n\tn.ClickItem(1)\n\tassert.Equal(t, 1, n.selectedIdx)\n}\n\n// ---------- SelectInstance auto-expand ----------\n\nfunc TestSelectInstance_ExpandsCollapsedPlan(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinst := makeInst(\"worker\", \"p.md\", session.Ready)\n\t// No running/notification → plan auto-collapses, instance hidden\n\tn.SetData(plans, []*session.Instance{inst}, nil, nil, nil)\n\trequire.Len(t, n.rows, 1, \"plan should be auto-collapsed\")\n\tassert.True(t, n.rows[0].Collapsed)\n\n\t// SelectInstance should auto-expand the plan to reveal the instance\n\tok := n.SelectInstance(inst)\n\tassert.True(t, ok, \"SelectInstance should succeed by expanding the plan\")\n\tassert.Equal(t, inst, n.GetSelectedInstance())\n\t// Plan should now be expanded\n\trequire.True(t, len(n.rows) >= 2)\n\tassert.False(t, n.rows[0].Collapsed)\n}\n\nfunc TestCycleActive_ExpandsCollapsedPlan(t *testing.T) {\n\tn := newTestPanel()\n\tplans := []PlanDisplay{\n\t\t{Filename: \"a.md\"},\n\t\t{Filename: \"b.md\"},\n\t}\n\tinstA := makeInst(\"a-worker\", \"a.md\", session.Running)\n\tinstB := makeInst(\"b-worker\", \"b.md\", session.Running)\n\tstatuses := map[string]TopicStatus{\n\t\t\"a.md\": {HasRunning: true},\n\t\t\"b.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, []*session.Instance{instA, instB}, nil, nil, statuses)\n\n\t// Select A, then manually collapse B\n\tn.SelectInstance(instA)\n\t// Find B's plan header and collapse it\n\tfor i, row := range n.rows {\n\t\tif row.Kind == navRowPlanHeader && row.PlanFile == \"b.md\" {\n\t\t\tn.selectedIdx = i\n\t\t\tn.ToggleSelectedExpand()\n\t\t\tbreak\n\t\t}\n\t}\n\t// Go back to instA\n\tn.SelectInstance(instA)\n\n\t// CycleNextActive should find instB even though its plan is collapsed\n\tn.CycleNextActive()\n\tassert.Equal(t, instB, n.GetSelectedInstance(), \"cycle should auto-expand collapsed plan\")\n}\n\n// ---------- FindPlanInstance ----------\n\nfunc TestFindPlanInstance_ReturnsRunning(t *testing.T) {\n\tn := newTestPanel()\n\tready := &session.Instance{Title: \"ready\", PlanFile: \"p.md\", Status: session.Ready}\n\trunning := &session.Instance{Title: \"running\", PlanFile: \"p.md\", Status: session.Running}\n\tn.SetData(nil, []*session.Instance{ready, running}, nil, nil, nil)\n\n\tresult := n.FindPlanInstance(\"p.md\")\n\tassert.Equal(t, running, result, \"should prefer running instance\")\n}\n\nfunc TestFindPlanInstance_NoneStarted(t *testing.T) {\n\tn := newTestPanel()\n\tpaused := makeInst(\"paused\", \"p.md\", session.Paused)\n\tn.SetData(nil, []*session.Instance{paused}, nil, nil, nil)\n\n\tresult := n.FindPlanInstance(\"p.md\")\n\tassert.Nil(t, result, \"paused-only plan should return nil\")\n}\n\n// ---------- rendering ----------\n\nfunc TestString_SectionHeaders(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 40)\n\tplans := []PlanDisplay{\n\t\t{Filename: \"active-plan.md\"},\n\t\t{Filename: \"idle-plan.md\"},\n\t}\n\tinstances := []*session.Instance{\n\t\tmakeInst(\"worker\", \"active-plan.md\", session.Running),\n\t}\n\tstatuses := map[string]TopicStatus{\n\t\t\"active-plan.md\": {HasRunning: true},\n\t}\n\tn.SetData(plans, instances, nil, nil, statuses)\n\toutput := n.String()\n\tassert.Contains(t, output, \"active\")\n\tassert.Contains(t, output, \"idle\")\n}\n\nfunc TestString_InstanceDisplayTitle(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tplans := []PlanDisplay{{Filename: \"p.md\"}}\n\tinst := &session.Instance{\n\t\tTitle:      \"p-W2-T5\",\n\t\tPlanFile:   \"p.md\",\n\t\tStatus:     session.Running,\n\t\tWaveNumber: 2,\n\t\tTaskNumber: 5,\n\t}\n\tstatuses := map[string]TopicStatus{\"p.md\": {HasRunning: true}}\n\tn.SetData(plans, []*session.Instance{inst}, nil, nil, statuses)\n\n\toutput := n.String()\n\tassert.Contains(t, output, \"wave 2\")\n\tassert.Contains(t, output, \"task 5\")\n\tassert.NotContains(t, output, \"W2-T5\", \"raw wave/task format should not appear\")\n}\n\nfunc TestString_Legend(t *testing.T) {\n\tn := newTestPanel()\n\tn.SetSize(60, 30)\n\tn.SetData(nil, nil, nil, nil, nil)\n\toutput := n.String()\n\tassert.Contains(t, output, \"running\")\n\tassert.Contains(t, output, \"review\")\n\tassert.Contains(t, output, \"idle\")\n}\n",
              "additions": 11,
              "deletions": 11,
              "status": "modified"
            },
            {
              "file": "ui/navigation_panel.go",
              "before": "package ui\n\nimport (\n\t\"fmt\"\n\t\"sort\"\n\t\"strings\"\n\n\t\"github.com/charmbracelet/bubbles/spinner\"\n\t\"github.com/charmbracelet/lipgloss\"\n\t\"github.com/charmbracelet/x/ansi\"\n\t\"github.com/kastheco/kasmos/config/planstate\"\n\t\"github.com/kastheco/kasmos/session\"\n\tzone \"github.com/lrstanley/bubblezone\"\n\t\"github.com/mattn/go-runewidth\"\n)\n\nconst (\n\tSidebarPlanPrefix        = \"__plan__\"\n\tSidebarTopicPrefix       = \"__topic__\"\n\tSidebarPlanHistoryToggle = \"__plan_history_toggle__\"\n\tSidebarImportClickUp     = \"__import_clickup__\"\n)\n\ntype PlanDisplay struct {\n\tFilename    string\n\tStatus      string\n\tDescription string\n\tBranch      string\n\tTopic       string\n}\n\ntype TopicStatus struct {\n\tHasRunning      bool\n\tHasNotification bool\n}\n\ntype navRowKind int\n\nconst (\n\tnavRowPlanHeader navRowKind = iota\n\tnavRowInstance\n\tnavRowSoloHeader\n\tnavRowTopicHeader\n\tnavRowImportAction\n\tnavRowDeadToggle\n\tnavRowDeadPlan\n\tnavRowHistoryToggle\n\tnavRowHistoryPlan\n\tnavRowCancelled\n)\n\ntype navRow struct {\n\tKind            navRowKind\n\tID              string\n\tLabel           string\n\tPlanFile        string\n\tInstance        *session.Instance\n\tCollapsed       bool\n\tHasRunning      bool\n\tHasNotification bool\n\tIndent          int // indentation level in spaces (0 = top-level)\n}\n\n// Navigation panel styles\nvar (\n\tnavItemStyle          = lipgloss.NewStyle().Foreground(ColorText).Padding(0, 1)\n\tnavSelectedRowStyle   = lipgloss.NewStyle().Background(ColorIris).Foreground(ColorBase).Padding(0, 1)\n\tnavActiveRowStyle     = lipgloss.NewStyle().Background(ColorOverlay).Foreground(ColorText).Padding(0, 1)\n\tnavSectionDivStyle    = lipgloss.NewStyle().Foreground(ColorMuted).Padding(0, 1)\n\tnavPlanLabelStyle     = lipgloss.NewStyle().Foreground(ColorText).Bold(true)\n\tnavInstanceLabelStyle = lipgloss.NewStyle().Foreground(ColorSubtle)\n\tnavRunningIconStyle   = lipgloss.NewStyle().Foreground(ColorFoam)\n\tnavReadyIconStyle     = lipgloss.NewStyle().Foreground(ColorFoam)\n\tnavNotifyIconStyle    = lipgloss.NewStyle().Foreground(ColorRose)\n\tnavPausedIconStyle    = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavCompletedIconStyle = lipgloss.NewStyle().Foreground(ColorFoam).Faint(true)\n\tnavIdleIconStyle      = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavCancelledLblStyle  = lipgloss.NewStyle().Foreground(ColorMuted).Strikethrough(true)\n\tnavImportStyle        = lipgloss.NewStyle().Foreground(ColorFoam).Padding(0, 1)\n\tnavHistoryDivStyle    = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavLegendLabelStyle   = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavSearchBoxStyle     = lipgloss.NewStyle().Border(lipgloss.RoundedBorder()).BorderForeground(ColorOverlay).Padding(0, 1)\n\tnavSearchActiveStyle  = lipgloss.NewStyle().Border(lipgloss.RoundedBorder()).BorderForeground(ColorFoam).Padding(0, 1)\n)\n\ntype NavigationPanel struct {\n\tspinner *spinner.Model\n\n\trows         []navRow\n\tselectedIdx  int\n\tscrollOffset int\n\n\tplans          []PlanDisplay\n\ttopics         []TopicDisplay\n\tinstances      []*session.Instance\n\tdeadPlans      []PlanDisplay\n\thistoryPlans   []PlanDisplay\n\tcancelled      []PlanDisplay\n\tplanStatuses   map[string]TopicStatus\n\tcollapsed      map[string]bool\n\tuserOverrides  map[string]bool\n\tinspectedPlans map[string]bool\n\n\tdeadExpanded    bool\n\thistoryExpanded bool\n\tsearchActive    bool\n\tsearchQuery     string\n\tclickUpAvail    bool\n\n\trepoName    string\n\trepoHovered bool\n\n\twidth, height int\n\tfocused       bool\n}\n\ntype TopicDisplay struct {\n\tName  string\n\tPlans []PlanDisplay\n}\n\nfunc NewNavigationPanel(sp *spinner.Model) *NavigationPanel {\n\treturn &NavigationPanel{\n\t\tspinner:        sp,\n\t\tplanStatuses:   make(map[string]TopicStatus),\n\t\tcollapsed:      make(map[string]bool),\n\t\tuserOverrides:  make(map[string]bool),\n\t\tinspectedPlans: make(map[string]bool),\n\t\tdeadExpanded:   true,\n\t\tfocused:        true,\n\t}\n}\n\nfunc (n *NavigationPanel) SetData(plans []PlanDisplay, instances []*session.Instance, history []PlanDisplay, cancelled []PlanDisplay, planStatuses map[string]TopicStatus) {\n\tn.plans = plans\n\tn.instances = instances\n\tn.cancelled = cancelled\n\tif planStatuses == nil {\n\t\tn.planStatuses = make(map[string]TopicStatus)\n\t} else {\n\t\tn.planStatuses = planStatuses\n\t}\n\t// Split history into dead (has instances or manually inspected) and history.\n\tn.splitDeadFromHistory(history)\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) SetPlans(plans []PlanDisplay) {\n\tn.plans = plans\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) SetTopicsAndPlans(topics []TopicDisplay, ungrouped []PlanDisplay, history []PlanDisplay, cancelled ...[]PlanDisplay) {\n\tn.topics = topics\n\tif len(cancelled) > 0 {\n\t\tn.cancelled = cancelled[0]\n\t}\n\tplans := make([]PlanDisplay, 0, len(ungrouped))\n\tplans = append(plans, ungrouped...)\n\tfor _, t := range topics {\n\t\tplans = append(plans, t.Plans...)\n\t}\n\tn.plans = plans\n\t// Split history into dead (has instances or manually inspected) and history.\n\tn.splitDeadFromHistory(history)\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) SetItems(_ []string, _ map[string]int, _ int, _ map[string]bool, _ map[string]TopicStatus, planStatuses map[string]TopicStatus) {\n\tif planStatuses != nil {\n\t\tn.planStatuses = planStatuses\n\t}\n\tn.rebuildRows()\n}\n\n// splitDeadFromHistory partitions finished plans into three buckets:\n//   - active (promoted to n.plans): has running/loading instances\n//   - dead: has only non-running instances or was manually inspected\n//   - history: no instances at all\nfunc (n *NavigationPanel) splitDeadFromHistory(finished []PlanDisplay) {\n\ttype planInfo struct {\n\t\thasInstances bool\n\t\thasRunning   bool\n\t}\n\tinfoByPlan := make(map[string]planInfo, len(n.instances))\n\tfor _, inst := range n.instances {\n\t\tif inst.PlanFile != \"\" {\n\t\t\tinfo := infoByPlan[inst.PlanFile]\n\t\t\tinfo.hasInstances = true\n\t\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\t\tinfo.hasRunning = true\n\t\t\t}\n\t\t\tinfoByPlan[inst.PlanFile] = info\n\t\t}\n\t}\n\tn.deadPlans = nil\n\tn.historyPlans = nil\n\tfor _, p := range finished {\n\t\tinfo := infoByPlan[p.Filename]\n\t\tif info.hasRunning {\n\t\t\t// Running instances → promote to active plans list.\n\t\t\tn.plans = append(n.plans, p)\n\t\t} else if info.hasInstances || n.inspectedPlans[p.Filename] {\n\t\t\tn.deadPlans = append(n.deadPlans, p)\n\t\t} else {\n\t\t\tn.historyPlans = append(n.historyPlans, p)\n\t\t}\n\t}\n}\n\n// resplitDead re-partitions dead and history plans based on current instances.\nfunc (n *NavigationPanel) resplitDead() {\n\tall := make([]PlanDisplay, 0, len(n.deadPlans)+len(n.historyPlans))\n\tall = append(all, n.deadPlans...)\n\tall = append(all, n.historyPlans...)\n\tn.splitDeadFromHistory(all)\n}\n\n// InspectPlan moves a history plan into the dead section for manual inspection.\nfunc (n *NavigationPanel) InspectPlan(planFile string) {\n\tif n.inspectedPlans == nil {\n\t\tn.inspectedPlans = make(map[string]bool)\n\t}\n\tn.inspectedPlans[planFile] = true\n\tn.resplitDead()\n\tn.deadExpanded = true\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) rebuildRows() {\n\tprevID := \"\"\n\tif n.selectedIdx >= 0 && n.selectedIdx < len(n.rows) {\n\t\tprevID = n.rows[n.selectedIdx].ID\n\t}\n\n\tinstancesByPlan := make(map[string][]*session.Instance)\n\tvar solo []*session.Instance\n\tfor _, inst := range n.instances {\n\t\tif inst.PlanFile == \"\" {\n\t\t\tsolo = append(solo, inst)\n\t\t\tcontinue\n\t\t}\n\t\tinstancesByPlan[inst.PlanFile] = append(instancesByPlan[inst.PlanFile], inst)\n\t}\n\n\tsortInstances := func(list []*session.Instance) {\n\t\tsort.SliceStable(list, func(i, j int) bool {\n\t\t\tki := navInstanceSortKey(list[i])\n\t\t\tkj := navInstanceSortKey(list[j])\n\t\t\tif ki != kj {\n\t\t\t\treturn ki < kj\n\t\t\t}\n\t\t\treturn strings.ToLower(list[i].Title) < strings.ToLower(list[j].Title)\n\t\t})\n\t}\n\tfor _, list := range instancesByPlan {\n\t\tsortInstances(list)\n\t}\n\tsortInstances(solo)\n\n\tplans := append([]PlanDisplay(nil), n.plans...)\n\tsort.SliceStable(plans, func(i, j int) bool {\n\t\tpi, pj := plans[i], plans[j]\n\t\tki := navPlanSortKey(pi, instancesByPlan[pi.Filename], n.planStatuses[pi.Filename])\n\t\tkj := navPlanSortKey(pj, instancesByPlan[pj.Filename], n.planStatuses[pj.Filename])\n\t\tif ki != kj {\n\t\t\treturn ki < kj\n\t\t}\n\t\treturn strings.ToLower(planstate.DisplayName(pi.Filename)) < strings.ToLower(planstate.DisplayName(pj.Filename))\n\t})\n\n\trows := make([]navRow, 0, len(plans)+len(n.instances)+len(n.deadPlans)+len(n.historyPlans)+len(n.cancelled)+6)\n\n\t// Helper to append a plan header + its child instances.\n\t// indent is the indentation level in spaces for the plan row.\n\tappendPlan := func(p PlanDisplay, indent int) {\n\t\tinsts := instancesByPlan[p.Filename]\n\t\thasRunning, hasNotification := aggregateNavPlanStatus(insts, n.planStatuses[p.Filename])\n\t\tcollapsed := n.isPlanCollapsed(p.Filename, hasRunning, hasNotification)\n\t\trows = append(rows, navRow{\n\t\t\tKind:            navRowPlanHeader,\n\t\t\tID:              SidebarPlanPrefix + p.Filename,\n\t\t\tLabel:           planstate.DisplayName(p.Filename),\n\t\t\tPlanFile:        p.Filename,\n\t\t\tCollapsed:       collapsed,\n\t\t\tHasRunning:      hasRunning,\n\t\t\tHasNotification: hasNotification,\n\t\t\tIndent:          indent,\n\t\t})\n\t\tif !collapsed {\n\t\t\tfor _, inst := range insts {\n\t\t\t\trows = append(rows, navRow{\n\t\t\t\t\tKind:     navRowInstance,\n\t\t\t\t\tID:       \"inst:\" + inst.Title,\n\t\t\t\t\tLabel:    inst.Title,\n\t\t\t\t\tPlanFile: inst.PlanFile,\n\t\t\t\t\tInstance: inst,\n\t\t\t\t\tIndent:   indent,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t// Dead section: done plans with instances or manually inspected.\n\t// Shown above active plans so they're accessible for cleanup.\n\tif len(n.deadPlans) > 0 {\n\t\trows = append(rows, navRow{Kind: navRowDeadToggle, ID: \"__dead_toggle__\", Label: \"dead\", Collapsed: !n.deadExpanded})\n\t\tif n.deadExpanded {\n\t\t\tfor _, p := range n.deadPlans {\n\t\t\t\tappendPlan(p, 2)\n\t\t\t}\n\t\t}\n\t}\n\n\t// Split plans into active (sort key 0,1) and idle (sort key 2).\n\tvar activePlans, idlePlans []PlanDisplay\n\tfor _, p := range plans {\n\t\tsk := navPlanSortKey(p, instancesByPlan[p.Filename], n.planStatuses[p.Filename])\n\t\tif sk < 2 {\n\t\t\tactivePlans = append(activePlans, p)\n\t\t} else {\n\t\t\tidlePlans = append(idlePlans, p)\n\t\t}\n\t}\n\n\t// Emit active plans flat.\n\tfor _, p := range activePlans {\n\t\tappendPlan(p, 0)\n\t}\n\n\t// Solo instances between active and idle.\n\tif len(solo) > 0 {\n\t\trows = append(rows, navRow{Kind: navRowSoloHeader, ID: \"__solo__\", Label: \"agents\"})\n\t\tfor _, inst := range solo {\n\t\t\trows = append(rows, navRow{Kind: navRowInstance, ID: \"inst:\" + inst.Title, Label: inst.Title, Instance: inst})\n\t\t}\n\t}\n\n\t// Idle plans grouped by topic.\n\t// Build a set of idle filenames for quick lookup.\n\tidleSet := make(map[string]bool, len(idlePlans))\n\tfor _, p := range idlePlans {\n\t\tidleSet[p.Filename] = true\n\t}\n\n\t// Emit topics that contain idle plans.\n\temitted := make(map[string]bool)\n\tfor _, t := range n.topics {\n\t\tvar topicIdlePlans []PlanDisplay\n\t\tfor _, p := range t.Plans {\n\t\t\tif idleSet[p.Filename] {\n\t\t\t\ttopicIdlePlans = append(topicIdlePlans, p)\n\t\t\t}\n\t\t}\n\t\tif len(topicIdlePlans) == 0 {\n\t\t\tcontinue\n\t\t}\n\t\ttopicID := SidebarTopicPrefix + t.Name\n\t\tcollapsed := n.collapsed[topicID]\n\t\trows = append(rows, navRow{\n\t\t\tKind:      navRowTopicHeader,\n\t\t\tID:        topicID,\n\t\t\tLabel:     t.Name,\n\t\t\tCollapsed: collapsed,\n\t\t})\n\t\tif !collapsed {\n\t\t\tfor _, p := range topicIdlePlans {\n\t\t\t\tappendPlan(p, 2)\n\t\t\t\temitted[p.Filename] = true\n\t\t\t}\n\t\t} else {\n\t\t\tfor _, p := range topicIdlePlans {\n\t\t\t\temitted[p.Filename] = true\n\t\t\t}\n\t\t}\n\t}\n\n\t// Emit ungrouped idle plans (no topic).\n\tfor _, p := range idlePlans {\n\t\tif !emitted[p.Filename] {\n\t\t\tappendPlan(p, 0)\n\t\t}\n\t}\n\n\tif n.clickUpAvail {\n\t\trows = append(rows, navRow{Kind: navRowImportAction, ID: SidebarImportClickUp, Label: \"+ import from clickup\"})\n\t}\n\n\tif len(n.historyPlans) > 0 {\n\t\trows = append(rows, navRow{Kind: navRowHistoryToggle, ID: SidebarPlanHistoryToggle, Label: \"history\", Collapsed: !n.historyExpanded})\n\t\tif n.historyExpanded {\n\t\t\tfor _, p := range n.historyPlans {\n\t\t\t\trows = append(rows, navRow{Kind: navRowHistoryPlan, ID: SidebarPlanPrefix + p.Filename, Label: planstate.DisplayName(p.Filename), PlanFile: p.Filename})\n\t\t\t}\n\t\t}\n\t}\n\n\tfor _, p := range n.cancelled {\n\t\trows = append(rows, navRow{Kind: navRowCancelled, ID: SidebarPlanPrefix + p.Filename, Label: planstate.DisplayName(p.Filename), PlanFile: p.Filename})\n\t}\n\n\tn.rows = rows\n\tif len(rows) == 0 {\n\t\tn.selectedIdx = 0\n\t\tn.scrollOffset = 0\n\t\treturn\n\t}\n\tif prevID != \"\" {\n\t\tfor i, row := range rows {\n\t\t\tif row.ID == prevID {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n\tif n.selectedIdx >= len(rows) {\n\t\tn.selectedIdx = len(rows) - 1\n\t}\n\tif n.selectedIdx < 0 {\n\t\tn.selectedIdx = 0\n\t}\n\tn.clampScroll()\n}\n\nfunc navInstanceSortKey(inst *session.Instance) int {\n\tif inst.ImplementationComplete {\n\t\treturn 3\n\t}\n\tswitch inst.Status {\n\tcase session.Running, session.Loading:\n\t\treturn 0\n\tcase session.Paused:\n\t\treturn 2\n\t}\n\tif inst.Notified {\n\t\treturn 1\n\t}\n\t// Ready / unknown\n\treturn 3\n}\n\nfunc navPlanSortKey(_ PlanDisplay, insts []*session.Instance, st TopicStatus) int {\n\thasNotification := st.HasNotification\n\thasRunning := st.HasRunning\n\tfor _, inst := range insts {\n\t\tif inst.Notified {\n\t\t\thasNotification = true\n\t\t}\n\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\thasRunning = true\n\t\t}\n\t}\n\tif hasNotification {\n\t\treturn 0\n\t}\n\tif hasRunning {\n\t\treturn 1\n\t}\n\treturn 2\n}\n\nfunc aggregateNavPlanStatus(insts []*session.Instance, st TopicStatus) (bool, bool) {\n\thasRunning := st.HasRunning\n\thasNotification := st.HasNotification\n\tfor _, inst := range insts {\n\t\tif inst.Notified {\n\t\t\thasNotification = true\n\t\t}\n\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\thasRunning = true\n\t\t}\n\t}\n\treturn hasRunning, hasNotification\n}\n\nfunc (n *NavigationPanel) isPlanCollapsed(planFile string, hasRunning, hasNotification bool) bool {\n\tif _, ok := n.userOverrides[planFile]; ok {\n\t\treturn n.collapsed[planFile]\n\t}\n\treturn !hasRunning && !hasNotification\n}\n\nfunc (n *NavigationPanel) SetSize(width, height int) {\n\tn.width, n.height = width, height\n\tn.clampScroll()\n}\nfunc (n *NavigationPanel) SetFocused(focused bool)    { n.focused = focused }\nfunc (n *NavigationPanel) IsFocused() bool            { return n.focused }\nfunc (n *NavigationPanel) SetRepoName(name string)    { n.repoName = name }\nfunc (n *NavigationPanel) SetRepoHovered(h bool)      { n.repoHovered = h }\nfunc (n *NavigationPanel) SetClickUpAvailable(a bool) { n.clickUpAvail = a; n.rebuildRows() }\n\nfunc (n *NavigationPanel) ActivateSearch()        { n.searchActive = true; n.searchQuery = \"\" }\nfunc (n *NavigationPanel) DeactivateSearch()      { n.searchActive = false; n.searchQuery = \"\" }\nfunc (n *NavigationPanel) IsSearchActive() bool   { return n.searchActive }\nfunc (n *NavigationPanel) GetSearchQuery() string { return n.searchQuery }\nfunc (n *NavigationPanel) SetSearchQuery(q string) {\n\tn.searchQuery = q\n\t// If the current selection is hidden by the new filter, snap to the first visible row.\n\tif q != \"\" && len(n.rows) > 0 && !n.rowMatchesSearch(n.selectedIdx) {\n\t\tfor i := range n.rows {\n\t\t\tif n.rows[i].Kind != navRowSoloHeader && n.rowMatchesSearch(i) {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunc (n *NavigationPanel) ToggleSelectedExpand() bool {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn false\n\t}\n\trow := n.rows[n.selectedIdx]\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tn.collapsed[row.PlanFile] = !row.Collapsed\n\t\tn.userOverrides[row.PlanFile] = true\n\t\tn.rebuildRows()\n\t\treturn true\n\tcase navRowTopicHeader:\n\t\tn.collapsed[row.ID] = !row.Collapsed\n\t\tn.rebuildRows()\n\t\treturn true\n\tcase navRowDeadToggle:\n\t\tn.deadExpanded = !n.deadExpanded\n\t\tn.rebuildRows()\n\t\treturn true\n\tcase navRowHistoryToggle:\n\t\tn.historyExpanded = !n.historyExpanded\n\t\tn.rebuildRows()\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\nfunc (n *NavigationPanel) Up() {\n\torig := n.selectedIdx\n\tfor n.selectedIdx > 0 {\n\t\tn.selectedIdx--\n\t\tif n.rows[n.selectedIdx].Kind == navRowSoloHeader {\n\t\t\tcontinue // skip non-selectable divider\n\t\t}\n\t\tif !n.rowMatchesSearch(n.selectedIdx) {\n\t\t\tcontinue // skip rows hidden by search filter\n\t\t}\n\t\tn.clampScroll()\n\t\treturn\n\t}\n\t// No valid row found above — revert.\n\tn.selectedIdx = orig\n}\n\nfunc (n *NavigationPanel) Down() {\n\torig := n.selectedIdx\n\tfor n.selectedIdx+1 < len(n.rows) {\n\t\tn.selectedIdx++\n\t\tif n.rows[n.selectedIdx].Kind == navRowSoloHeader {\n\t\t\tcontinue\n\t\t}\n\t\tif !n.rowMatchesSearch(n.selectedIdx) {\n\t\t\tcontinue\n\t\t}\n\t\tn.clampScroll()\n\t\treturn\n\t}\n\tn.selectedIdx = orig\n}\n\n// rowMatchesSearch returns true if the row at idx is visible under the current\n// search filter. Always true when search is inactive or query is empty.\nfunc (n *NavigationPanel) rowMatchesSearch(idx int) bool {\n\tif !n.searchActive || n.searchQuery == \"\" {\n\t\treturn true\n\t}\n\trow := n.rows[idx]\n\tq := strings.ToLower(n.searchQuery)\n\treturn strings.Contains(strings.ToLower(row.Label), q) ||\n\t\tstrings.Contains(strings.ToLower(row.PlanFile), q)\n}\n\nfunc (n *NavigationPanel) Left() {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn\n\t}\n\trow := n.rows[n.selectedIdx]\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tif !row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t}\n\tcase navRowInstance:\n\t\tfor i := n.selectedIdx - 1; i >= 0; i-- {\n\t\t\tif n.rows[i].Kind == navRowPlanHeader {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunc (n *NavigationPanel) Right() {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn\n\t}\n\trow := n.rows[n.selectedIdx]\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tif row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t} else {\n\t\t\tn.Down()\n\t\t}\n\tcase navRowDeadToggle:\n\t\tif row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t} else {\n\t\t\tn.Down()\n\t\t}\n\tcase navRowHistoryToggle:\n\t\tif row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t}\n\t}\n}\n\nfunc (n *NavigationPanel) GetSelectedInstance() *session.Instance {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn nil\n\t}\n\treturn n.rows[n.selectedIdx].Instance\n}\n\nfunc (n *NavigationPanel) GetSelectedPlanFile() string {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn \"\"\n\t}\n\treturn n.rows[n.selectedIdx].PlanFile\n}\n\nfunc (n *NavigationPanel) IsSelectedPlanHeader() bool {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn false\n\t}\n\tk := n.rows[n.selectedIdx].Kind\n\treturn k == navRowPlanHeader || k == navRowHistoryPlan || k == navRowCancelled\n}\n\n// IsSelectedHistoryPlan returns true if the selected row is a history plan entry.\nfunc (n *NavigationPanel) IsSelectedHistoryPlan() bool {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn false\n\t}\n\treturn n.rows[n.selectedIdx].Kind == navRowHistoryPlan\n}\n\nfunc (n *NavigationPanel) GetSelectedID() string {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn \"\"\n\t}\n\treturn n.rows[n.selectedIdx].ID\n}\n\nfunc (n *NavigationPanel) GetSelectedIdx() int  { return n.selectedIdx }\nfunc (n *NavigationPanel) GetScrollOffset() int { return n.scrollOffset }\n\nfunc (n *NavigationPanel) ClickItem(row int) {\n\tif row >= 0 && row < len(n.rows) {\n\t\tn.selectedIdx = row\n\t\tn.clampScroll()\n\t}\n}\n\nfunc (n *NavigationPanel) SelectByID(id string) bool {\n\tfor i, row := range n.rows {\n\t\tif row.ID == id {\n\t\t\tn.selectedIdx = i\n\t\t\tn.clampScroll()\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}\n\nfunc (n *NavigationPanel) SelectInstance(inst *session.Instance) bool {\n\tfor i, row := range n.rows {\n\t\tif row.Instance == inst {\n\t\t\tn.selectedIdx = i\n\t\t\tn.clampScroll()\n\t\t\treturn true\n\t\t}\n\t}\n\t// Instance not visible — may be under a collapsed plan. Expand it.\n\tif inst.PlanFile != \"\" {\n\t\tn.collapsed[inst.PlanFile] = false\n\t\tn.userOverrides[inst.PlanFile] = true\n\t\tn.rebuildRows()\n\t\tfor i, row := range n.rows {\n\t\t\tif row.Instance == inst {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t}\n\treturn false\n}\n\nfunc (n *NavigationPanel) SetSelectedInstance(idx int) {\n\tif idx < 0 || idx >= len(n.instances) {\n\t\treturn\n\t}\n\t_ = n.SelectInstance(n.instances[idx])\n}\n\nfunc (n *NavigationPanel) SelectedIndex() int {\n\tinst := n.GetSelectedInstance()\n\tif inst == nil {\n\t\treturn 0\n\t}\n\tfor i, item := range n.instances {\n\t\tif item == inst {\n\t\t\treturn i\n\t\t}\n\t}\n\treturn 0\n}\n\nfunc (n *NavigationPanel) CycleNextActive() {\n\tn.cycleActive(1)\n}\n\nfunc (n *NavigationPanel) CyclePrevActive() {\n\tn.cycleActive(-1)\n}\n\nfunc (n *NavigationPanel) cycleActive(step int) {\n\t// Build the cycle list in visual (top-to-bottom) order so Ctrl+Up/Down\n\t// follows the on-screen layout across attention/active/solo sections.\n\t// For collapsed plan headers, insert their hidden instances at the\n\t// header's position so cycling can auto-expand them.\n\tvar ordered []*session.Instance\n\tfor _, row := range n.rows {\n\t\tswitch {\n\t\tcase row.Kind == navRowInstance && row.Instance != nil:\n\t\t\tif !row.Instance.Paused() {\n\t\t\t\tordered = append(ordered, row.Instance)\n\t\t\t}\n\t\tcase row.Kind == navRowPlanHeader && row.Collapsed:\n\t\t\t// Plan is collapsed — its instances aren't in rows.\n\t\t\t// Insert them here so they appear at the right visual position.\n\t\t\tfor _, inst := range n.instances {\n\t\t\t\tif inst.PlanFile == row.PlanFile && !inst.Paused() {\n\t\t\t\t\tordered = append(ordered, inst)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif len(ordered) == 0 {\n\t\treturn\n\t}\n\n\t// Find current position. Match by instance pointer from the selected row.\n\tcur := -1\n\tsel := n.GetSelectedInstance()\n\tif sel != nil {\n\t\tfor i, inst := range ordered {\n\t\t\tif inst == sel {\n\t\t\t\tcur = i\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\tif cur < 0 {\n\t\tcur = 0\n\t}\n\n\tnext := (cur + step + len(ordered)) % len(ordered)\n\tn.SelectInstance(ordered[next])\n}\n\nfunc (n *NavigationPanel) GetInstances() []*session.Instance { return n.instances }\nfunc (n *NavigationPanel) TotalInstances() int               { return len(n.instances) }\nfunc (n *NavigationPanel) NumInstances() int                 { return len(n.instances) }\n\nfunc (n *NavigationPanel) AddInstance(inst *session.Instance) func() {\n\tn.instances = append(n.instances, inst)\n\tn.resplitDead()\n\tn.rebuildRows()\n\treturn func() {}\n}\n\nfunc (n *NavigationPanel) RemoveByTitle(title string) *session.Instance {\n\tfor i, inst := range n.instances {\n\t\tif inst.Title == title {\n\t\t\tn.instances = append(n.instances[:i], n.instances[i+1:]...)\n\t\t\tn.resplitDead()\n\t\t\tn.rebuildRows()\n\t\t\treturn inst\n\t\t}\n\t}\n\treturn nil\n}\n\nfunc (n *NavigationPanel) Remove() {\n\tinst := n.GetSelectedInstance()\n\tif inst != nil {\n\t\tn.RemoveByTitle(inst.Title)\n\t}\n}\n\nfunc (n *NavigationPanel) Kill() {\n\tinst := n.GetSelectedInstance()\n\tif inst != nil {\n\t\t_ = inst.Kill()\n\t\tn.RemoveByTitle(inst.Title)\n\t}\n}\n\nfunc (n *NavigationPanel) Attach() (chan struct{}, error) {\n\tinst := n.GetSelectedInstance()\n\tif inst == nil {\n\t\treturn nil, fmt.Errorf(\"no instance selected\")\n\t}\n\treturn inst.Attach()\n}\n\nfunc (n *NavigationPanel) Clear() {\n\tn.instances = nil\n\tn.rows = nil\n\tn.selectedIdx = 0\n\tn.scrollOffset = 0\n}\n\nfunc (n *NavigationPanel) SetSessionPreviewSize(width, height int) error {\n\tvar err error\n\tfor _, item := range n.instances {\n\t\tif !item.Started() || item.Paused() {\n\t\t\tcontinue\n\t\t}\n\t\tif innerErr := item.SetPreviewSize(width, height); innerErr != nil {\n\t\t\terr = innerErr\n\t\t}\n\t}\n\treturn err\n}\n\nfunc (n *NavigationPanel) SelectFirst() {\n\tif len(n.rows) > 0 {\n\t\tn.selectedIdx = 0\n\t\t// Skip non-selectable divider rows.\n\t\tif n.rows[0].Kind == navRowSoloHeader && len(n.rows) > 1 {\n\t\t\tn.selectedIdx = 1\n\t\t}\n\t\tn.clampScroll()\n\t}\n}\n\nfunc (n *NavigationPanel) SelectedSpaceAction() string {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn \"toggle\"\n\t}\n\tswitch n.rows[n.selectedIdx].Kind {\n\tcase navRowPlanHeader, navRowDeadToggle, navRowHistoryToggle:\n\t\tif n.rows[n.selectedIdx].Collapsed {\n\t\t\treturn \"expand\"\n\t\t}\n\t\treturn \"collapse\"\n\tdefault:\n\t\treturn \"toggle\"\n\t}\n}\n\nfunc (n *NavigationPanel) availRows() int {\n\tavail := n.height - 8\n\tif avail < 1 {\n\t\treturn 1\n\t}\n\treturn avail\n}\n\nfunc (n *NavigationPanel) clampScroll() {\n\tif len(n.rows) == 0 {\n\t\tn.scrollOffset = 0\n\t\treturn\n\t}\n\tavail := n.availRows()\n\tif n.selectedIdx < n.scrollOffset {\n\t\tn.scrollOffset = n.selectedIdx\n\t}\n\tif n.selectedIdx >= n.scrollOffset+avail {\n\t\tn.scrollOffset = n.selectedIdx - avail + 1\n\t}\n\tif n.scrollOffset < 0 {\n\t\tn.scrollOffset = 0\n\t}\n}\n\n// FindPlanInstance returns the best interactive candidate for a plan.\n// Priority: running > any non-paused instance. The caller should check\n// Started()/Paused() on the returned instance before entering focus mode.\nfunc (n *NavigationPanel) FindPlanInstance(planFile string) *session.Instance {\n\tvar best *session.Instance\n\tfor _, inst := range n.instances {\n\t\tif inst.PlanFile != planFile || inst.Paused() {\n\t\t\tcontinue\n\t\t}\n\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\treturn inst\n\t\t}\n\t\tif best == nil {\n\t\t\tbest = inst\n\t\t}\n\t}\n\treturn best\n}\n\n// navInstanceTitle returns a clean display title for an instance in the sidebar.\nfunc navInstanceTitle(inst *session.Instance) string {\n\tswitch {\n\tcase inst.WaveNumber > 0 && inst.TaskNumber > 0:\n\t\treturn fmt.Sprintf(\"wave %d · task %d\", inst.WaveNumber, inst.TaskNumber)\n\tcase inst.AgentType == session.AgentTypeReviewer && inst.PlanFile != \"\":\n\t\treturn \"review\"\n\tcase inst.AgentType == session.AgentTypePlanner && inst.PlanFile != \"\":\n\t\treturn \"planning\"\n\tcase inst.SoloAgent && inst.PlanFile != \"\":\n\t\treturn planstate.DisplayName(inst.PlanFile)\n\tcase inst.AgentType == session.AgentTypeCoder && inst.PlanFile != \"\" && inst.WaveNumber == 0:\n\t\treturn \"applying fixes\"\n\tdefault:\n\t\treturn inst.Title\n\t}\n}\n\n// navInstanceStatusIcon returns a styled status glyph for an instance.\nfunc (n *NavigationPanel) navInstanceStatusIcon(inst *session.Instance) string {\n\tif inst.SoloAgent && inst.Exited {\n\t\treturn navCancelledLblStyle.Render(\"✕\")\n\t}\n\tif inst.ImplementationComplete {\n\t\treturn navCompletedIconStyle.Render(\"✓\")\n\t}\n\tswitch inst.Status {\n\tcase session.Running, session.Loading:\n\t\tif n.spinner != nil {\n\t\t\treturn strings.TrimRight(n.spinner.View(), \" \")\n\t\t}\n\t\treturn navRunningIconStyle.Render(\"●\")\n\tcase session.Ready:\n\t\tif inst.Notified {\n\t\t\treturn navNotifyIconStyle.Render(\"◉\")\n\t\t}\n\t\treturn navReadyIconStyle.Render(\"●\")\n\tcase session.Paused:\n\t\treturn navPausedIconStyle.Render(\"\\uf04c\")\n\tdefault:\n\t\treturn navIdleIconStyle.Render(\"○\")\n\t}\n}\n\n// navPlanStatusIcon returns a styled status glyph for a plan header row.\nfunc navPlanStatusIcon(row navRow) string {\n\tif row.HasNotification {\n\t\treturn navNotifyIconStyle.Render(\"◉\")\n\t}\n\tif row.HasRunning {\n\t\treturn navRunningIconStyle.Render(\"●\")\n\t}\n\treturn navIdleIconStyle.Render(\"○\")\n}\n\n// navSectionLabel returns a lowercase section label for a plan sort key.\nfunc navSectionLabel(key int) string {\n\tswitch key {\n\tcase 0:\n\t\treturn \"attention\"\n\tcase 1:\n\t\treturn \"active\"\n\tdefault:\n\t\treturn \"plans\"\n\t}\n}\n\n// navDividerLine builds a full-width rule like \"──── label ────\" spanning w cells.\nfunc navDividerLine(label string, w int) string {\n\tinner := \" \" + label + \" \"\n\tinnerW := runewidth.StringWidth(inner)\n\tremaining := w - innerW\n\tif remaining < 2 {\n\t\treturn navHistoryDivStyle.Render(inner)\n\t}\n\tleft := remaining / 2\n\tright := remaining - left\n\treturn navHistoryDivStyle.Render(strings.Repeat(\"─\", left) + inner + strings.Repeat(\"─\", right))\n}\n\n// renderNavRow renders a single row's content (without selection styling).\nfunc (n *NavigationPanel) renderNavRow(row navRow, contentWidth int) string {\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tchevron := \"▸\"\n\t\tif !row.Collapsed {\n\t\t\tchevron = \"▾\"\n\t\t}\n\t\tstatusIcon := navPlanStatusIcon(row)\n\t\tstatusW := lipgloss.Width(statusIcon)\n\t\tindent := strings.Repeat(\" \", row.Indent)\n\t\tindentW := row.Indent\n\n\t\tlabel := row.Label\n\t\t// Layout: indent + chevron(1) + space(1) + label + gap + space(1) + status\n\t\tmaxLabel := contentWidth - indentW - 3 - statusW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\n\t\tusedW := indentW + 2 + runewidth.StringWidth(label) + 1 + statusW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\t\t// Plans under topics use normal weight; top-level plans use bold.\n\t\tlabelStyle := navPlanLabelStyle\n\t\tif row.Indent > 0 {\n\t\t\tlabelStyle = navPlanLabelStyle.Bold(false)\n\t\t}\n\t\treturn indent + chevron + \" \" + labelStyle.Render(label) + strings.Repeat(\" \", gap) + \" \" + statusIcon\n\n\tcase navRowInstance:\n\t\tinst := row.Instance\n\t\tisSolo := row.PlanFile == \"\"\n\n\t\tif inst == nil {\n\t\t\tif isSolo {\n\t\t\t\treturn row.Label\n\t\t\t}\n\t\t\treturn \"    \" + row.Label\n\t\t}\n\t\ttitle := navInstanceTitle(inst)\n\t\tstatusIcon := n.navInstanceStatusIcon(inst)\n\t\tstatusW := lipgloss.Width(statusIcon)\n\n\t\tindentW := row.Indent + 4\n\t\tif isSolo {\n\t\t\tindentW = 0\n\t\t}\n\t\t// Layout: indent + title + gap + space(1) + status\n\t\tmaxLabel := contentWidth - indentW - 1 - statusW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(title) > maxLabel {\n\t\t\ttitle = runewidth.Truncate(title, maxLabel-1, \"…\")\n\t\t}\n\n\t\tusedW := indentW + runewidth.StringWidth(title) + 1 + statusW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\n\t\tindent := strings.Repeat(\" \", indentW)\n\t\tlabelStyle := navInstanceLabelStyle\n\t\tif isSolo {\n\t\t\tindent = \"\"\n\t\t\tlabelStyle = navPlanLabelStyle\n\t\t}\n\t\t// Killed solo agents: grey + strikethrough.\n\t\tif inst.SoloAgent && inst.Exited {\n\t\t\tlabelStyle = navCancelledLblStyle\n\t\t\tstatusIcon = navCancelledLblStyle.Render(\"✕\")\n\t\t\tstatusW = lipgloss.Width(statusIcon)\n\t\t\t// Recompute gap with updated status width.\n\t\t\tusedW = indentW + runewidth.StringWidth(title) + 1 + statusW\n\t\t\tgap = contentWidth - usedW\n\t\t\tif gap < 0 {\n\t\t\t\tgap = 0\n\t\t\t}\n\t\t}\n\t\treturn indent + labelStyle.Render(title) + strings.Repeat(\" \", gap) + \" \" + statusIcon\n\n\tcase navRowSoloHeader:\n\t\treturn navDividerLine(\"agents\", contentWidth)\n\n\tcase navRowTopicHeader:\n\t\tchevron := \"▸\"\n\t\tif !row.Collapsed {\n\t\t\tchevron = \"▾\"\n\t\t}\n\t\tlabel := row.Label\n\t\tmaxLabel := contentWidth - 2 // chevron + space\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\t\treturn chevron + \" \" + navPlanLabelStyle.Render(label)\n\n\tcase navRowDeadToggle:\n\t\treturn navDividerLine(\"dead\", contentWidth)\n\n\tcase navRowHistoryToggle:\n\t\tchevron := \"▸\"\n\t\tif !row.Collapsed {\n\t\t\tchevron = \"▾\"\n\t\t}\n\t\treturn navDividerLine(chevron+\" history\", contentWidth)\n\n\tcase navRowHistoryPlan:\n\t\tlabel := row.Label\n\t\tdoneIcon := navCompletedIconStyle.Render(\"●\")\n\t\tdoneW := lipgloss.Width(doneIcon)\n\t\tmaxLabel := contentWidth - 1 - doneW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\t\tusedW := runewidth.StringWidth(label) + 1 + doneW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\t\treturn navIdleIconStyle.Render(label) + strings.Repeat(\" \", gap) + \" \" + doneIcon\n\n\tcase navRowCancelled:\n\t\tlabel := row.Label\n\t\tconst trailW = 2\n\t\tmaxLabel := contentWidth - trailW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\t\tusedW := runewidth.StringWidth(label) + trailW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\t\treturn navCancelledLblStyle.Render(label) + strings.Repeat(\" \", gap) + \" \" + navCancelledLblStyle.Render(\"✕\")\n\n\tcase navRowImportAction:\n\t\treturn row.Label\n\n\tdefault:\n\t\treturn row.Label\n\t}\n}\n\nfunc (n *NavigationPanel) String() string {\n\tborder := lipgloss.NewStyle().Border(lipgloss.RoundedBorder()).BorderForeground(ColorOverlay).Padding(0, 1)\n\tif n.focused {\n\t\tborder = border.Border(lipgloss.DoubleBorder()).BorderForeground(ColorIris)\n\t}\n\tinnerWidth := n.width - 4\n\tif innerWidth < 8 {\n\t\tinnerWidth = 8\n\t}\n\theight := n.height - 2\n\tif height < 4 {\n\t\theight = 4\n\t}\n\n\titemWidth := innerWidth - 2   // border has Padding(0,1) → content area is 2 chars narrower\n\tcontentWidth := itemWidth - 2 // account for Padding(0,1) in row styles\n\tif contentWidth < 4 {\n\t\tcontentWidth = 4\n\t}\n\n\t// Search bar\n\tsearchWidth := innerWidth - 4\n\tif searchWidth < 4 {\n\t\tsearchWidth = 4\n\t}\n\tvar searchBox string\n\tif n.searchActive {\n\t\tsearchText := n.searchQuery\n\t\tif searchText == \"\" {\n\t\t\tsearchText = \" \"\n\t\t}\n\t\tsearchBox = zone.Mark(ZoneNavSearch, navSearchActiveStyle.Width(searchWidth).Render(searchText))\n\t} else {\n\t\tsearchBox = zone.Mark(ZoneNavSearch, navSearchBoxStyle.Width(searchWidth).Render(\"\\uf002 search\"))\n\t}\n\n\t// Build visible items, including section dividers between plan sort-key groups.\n\ttype visItem struct {\n\t\tline   string\n\t\trowIdx int // -1 for section dividers\n\t}\n\titems := make([]visItem, 0, len(n.rows)+4)\n\tselectedDisplayIdx := 0\n\tlastPlanKey := -1\n\tinDeadSection := false\n\n\tfor i, row := range n.rows {\n\t\t// Search filter\n\t\tif n.searchActive && n.searchQuery != \"\" {\n\t\t\tq := strings.ToLower(n.searchQuery)\n\t\t\tif !strings.Contains(strings.ToLower(row.Label), q) &&\n\t\t\t\t!strings.Contains(strings.ToLower(row.PlanFile), q) {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t}\n\n\t\t// Track dead section boundaries to suppress plan-group dividers.\n\t\tif row.Kind == navRowDeadToggle {\n\t\t\tinDeadSection = true\n\t\t} else if row.Kind != navRowPlanHeader && row.Kind != navRowInstance {\n\t\t\tinDeadSection = false\n\t\t}\n\n\t\t// Insert section dividers between plan sort-key groups\n\t\tif row.Kind == navRowPlanHeader && !inDeadSection {\n\t\t\tsk := 2\n\t\t\tif row.HasNotification {\n\t\t\t\tsk = 0\n\t\t\t} else if row.HasRunning {\n\t\t\t\tsk = 1\n\t\t\t}\n\t\t\tif sk != lastPlanKey {\n\t\t\t\tlabel := navSectionLabel(sk)\n\t\t\t\tdivLine := navDividerLine(label, itemWidth)\n\t\t\t\titems = append(items, visItem{line: divLine, rowIdx: -1})\n\t\t\t\tlastPlanKey = sk\n\t\t\t}\n\t\t}\n\t\t// Topic headers are always idle — ensure the idle divider appears.\n\t\tif row.Kind == navRowTopicHeader && lastPlanKey != 2 {\n\t\t\tdivLine := navDividerLine(navSectionLabel(2), itemWidth)\n\t\t\titems = append(items, visItem{line: divLine, rowIdx: -1})\n\t\t\tlastPlanKey = 2\n\t\t}\n\n\t\tif i == n.selectedIdx {\n\t\t\tselectedDisplayIdx = len(items)\n\t\t}\n\n\t\t// Render the row content\n\t\trawLine := n.renderNavRow(row, contentWidth)\n\n\t\t// Apply selection highlighting\n\t\tisSelected := i == n.selectedIdx\n\t\tvar styledLine string\n\t\tif isSelected && n.focused {\n\t\t\tstyledLine = navSelectedRowStyle.Width(itemWidth).Render(ansi.Strip(rawLine))\n\t\t} else if isSelected {\n\t\t\tstyledLine = navActiveRowStyle.Width(itemWidth).Render(ansi.Strip(rawLine))\n\t\t} else if row.Kind == navRowImportAction {\n\t\t\tstyledLine = navImportStyle.Width(itemWidth).Render(rawLine)\n\t\t} else {\n\t\t\tstyledLine = navItemStyle.Width(itemWidth).Render(rawLine)\n\t\t}\n\n\t\titems = append(items, visItem{line: styledLine, rowIdx: i})\n\t}\n\n\t// Scroll window — keep the selected item visible\n\tavail := n.availRows()\n\tstart := selectedDisplayIdx - avail/2\n\tif start < 0 {\n\t\tstart = 0\n\t}\n\tend := start + avail\n\tif end > len(items) {\n\t\tend = len(items)\n\t\tstart = end - avail\n\t\tif start < 0 {\n\t\t\tstart = 0\n\t\t}\n\t}\n\n\tvar bodyLines []string\n\tfor _, item := range items[start:end] {\n\t\tline := item.line\n\t\tif item.rowIdx >= 0 {\n\t\t\tline = zone.Mark(NavRowZoneID(item.rowIdx), line)\n\t\t}\n\t\tbodyLines = append(bodyLines, line)\n\t}\n\tbody := strings.Join(bodyLines, \"\\n\")\n\tif body != \"\" {\n\t\tbody += \"\\n\"\n\t}\n\n\t// Legend — status icon key, centered in the pane\n\tlegendContent := navIdleIconStyle.Render(\"○\") + navLegendLabelStyle.Render(\" idle\") +\n\t\t\"  \" + navRunningIconStyle.Render(\"●\") + navLegendLabelStyle.Render(\" running\") +\n\t\t\"  \" + navNotifyIconStyle.Render(\"◉\") + navLegendLabelStyle.Render(\" review\") +\n\t\t\"  \" + navCompletedIconStyle.Render(\"●\") + navLegendLabelStyle.Render(\" done\")\n\tlegend := lipgloss.NewStyle().Width(innerWidth).Align(lipgloss.Center).Render(legendContent)\n\n\t// Repo switcher\n\tvar repoSection string\n\tif n.repoName != \"\" {\n\t\tbtnWidth := innerWidth - 4\n\t\tif btnWidth < 4 {\n\t\t\tbtnWidth = 4\n\t\t}\n\t\trepoBtn := lipgloss.NewStyle().\n\t\t\tBorder(lipgloss.RoundedBorder()).\n\t\t\tBorderForeground(ColorOverlay).\n\t\t\tPadding(0, 1).\n\t\t\tWidth(btnWidth).\n\t\t\tRender(n.repoName + \" ▾\")\n\t\trepoSection = zone.Mark(ZoneNavRepo, repoBtn)\n\t}\n\n\t// Assemble content with bottom-pinned legend + repo button\n\ttopContent := searchBox + \"\\n\\n\" + body\n\tvar bottomSection string\n\tif repoSection != \"\" {\n\t\tbottomSection = legend + \"\\n\" + repoSection\n\t} else {\n\t\tbottomSection = legend\n\t}\n\n\ttopLines := strings.Count(topContent, \"\\n\") + 1\n\tbottomLines := strings.Count(bottomSection, \"\\n\") + 1\n\tgap := height - topLines - bottomLines + 1\n\tif gap < 1 {\n\t\tgap = 1\n\t}\n\tinnerContent := topContent + strings.Repeat(\"\\n\", gap) + bottomSection\n\n\tbordered := border.Width(innerWidth).Height(height).Render(innerContent)\n\tplaced := lipgloss.Place(n.width, n.height, lipgloss.Left, lipgloss.Top, bordered)\n\n\t// Clamp output to n.height lines\n\tif n.height > 0 {\n\t\tlines := strings.Split(placed, \"\\n\")\n\t\tif len(lines) > n.height {\n\t\t\tlines = lines[:n.height]\n\t\t\tplaced = strings.Join(lines, \"\\n\")\n\t\t}\n\t}\n\treturn zone.Mark(ZoneNavPanel, placed)\n}\n\n// RowCount returns the number of rows in the navigation panel rows slice.\n// Used by zone-based mouse hit detection to iterate row zones.\nfunc (n *NavigationPanel) RowCount() int { return len(n.rows) }\n",
              "after": "package ui\n\nimport (\n\t\"fmt\"\n\t\"sort\"\n\t\"strings\"\n\n\t\"github.com/charmbracelet/bubbles/spinner\"\n\t\"github.com/charmbracelet/lipgloss\"\n\t\"github.com/charmbracelet/x/ansi\"\n\t\"github.com/kastheco/kasmos/config/planstate\"\n\t\"github.com/kastheco/kasmos/session\"\n\tzone \"github.com/lrstanley/bubblezone\"\n\t\"github.com/mattn/go-runewidth\"\n)\n\nconst (\n\tSidebarPlanPrefix        = \"__plan__\"\n\tSidebarTopicPrefix       = \"__topic__\"\n\tSidebarPlanHistoryToggle = \"__plan_history_toggle__\"\n\tSidebarImportClickUp     = \"__import_clickup__\"\n)\n\ntype PlanDisplay struct {\n\tFilename    string\n\tStatus      string\n\tDescription string\n\tBranch      string\n\tTopic       string\n}\n\ntype TopicStatus struct {\n\tHasRunning      bool\n\tHasNotification bool\n}\n\ntype navRowKind int\n\nconst (\n\tnavRowPlanHeader navRowKind = iota\n\tnavRowInstance\n\tnavRowSoloHeader\n\tnavRowTopicHeader\n\tnavRowImportAction\n\tnavRowDeadToggle\n\tnavRowDeadPlan\n\tnavRowHistoryToggle\n\tnavRowHistoryPlan\n\tnavRowCancelled\n)\n\ntype navRow struct {\n\tKind            navRowKind\n\tID              string\n\tLabel           string\n\tPlanFile        string\n\tInstance        *session.Instance\n\tCollapsed       bool\n\tHasRunning      bool\n\tHasNotification bool\n\tIndent          int // indentation level in spaces (0 = top-level)\n}\n\n// Navigation panel styles\nvar (\n\tnavItemStyle          = lipgloss.NewStyle().Foreground(ColorText).Padding(0, 1)\n\tnavSelectedRowStyle   = lipgloss.NewStyle().Background(ColorIris).Foreground(ColorBase).Padding(0, 1)\n\tnavActiveRowStyle     = lipgloss.NewStyle().Background(ColorOverlay).Foreground(ColorText).Padding(0, 1)\n\tnavSectionDivStyle    = lipgloss.NewStyle().Foreground(ColorMuted).Padding(0, 1)\n\tnavPlanLabelStyle     = lipgloss.NewStyle().Foreground(ColorText).Bold(true)\n\tnavInstanceLabelStyle = lipgloss.NewStyle().Foreground(ColorSubtle)\n\tnavRunningIconStyle   = lipgloss.NewStyle().Foreground(ColorFoam)\n\tnavReadyIconStyle     = lipgloss.NewStyle().Foreground(ColorFoam)\n\tnavNotifyIconStyle    = lipgloss.NewStyle().Foreground(ColorRose)\n\tnavPausedIconStyle    = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavCompletedIconStyle = lipgloss.NewStyle().Foreground(ColorFoam).Faint(true)\n\tnavIdleIconStyle      = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavCancelledLblStyle  = lipgloss.NewStyle().Foreground(ColorMuted).Strikethrough(true)\n\tnavImportStyle        = lipgloss.NewStyle().Foreground(ColorFoam).Padding(0, 1)\n\tnavHistoryDivStyle    = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavLegendLabelStyle   = lipgloss.NewStyle().Foreground(ColorMuted)\n\tnavSearchBoxStyle     = lipgloss.NewStyle().Border(lipgloss.RoundedBorder()).BorderForeground(ColorOverlay).Padding(0, 1)\n\tnavSearchActiveStyle  = lipgloss.NewStyle().Border(lipgloss.RoundedBorder()).BorderForeground(ColorFoam).Padding(0, 1)\n)\n\ntype NavigationPanel struct {\n\tspinner *spinner.Model\n\n\trows         []navRow\n\tselectedIdx  int\n\tscrollOffset int\n\n\tplans          []PlanDisplay\n\ttopics         []TopicDisplay\n\tinstances      []*session.Instance\n\tdeadPlans      []PlanDisplay\n\thistoryPlans   []PlanDisplay\n\tpromotedPlans  []PlanDisplay // finished plans promoted to active (have running instances)\n\tcancelled      []PlanDisplay\n\tplanStatuses   map[string]TopicStatus\n\tcollapsed      map[string]bool\n\tuserOverrides  map[string]bool\n\tinspectedPlans map[string]bool\n\n\tdeadExpanded    bool\n\thistoryExpanded bool\n\tsearchActive    bool\n\tsearchQuery     string\n\tclickUpAvail    bool\n\n\trepoName    string\n\trepoHovered bool\n\n\twidth, height int\n\tfocused       bool\n}\n\ntype TopicDisplay struct {\n\tName  string\n\tPlans []PlanDisplay\n}\n\nfunc NewNavigationPanel(sp *spinner.Model) *NavigationPanel {\n\treturn &NavigationPanel{\n\t\tspinner:        sp,\n\t\tplanStatuses:   make(map[string]TopicStatus),\n\t\tcollapsed:      make(map[string]bool),\n\t\tuserOverrides:  make(map[string]bool),\n\t\tinspectedPlans: make(map[string]bool),\n\t\tdeadExpanded:   true,\n\t\tfocused:        true,\n\t}\n}\n\nfunc (n *NavigationPanel) SetData(plans []PlanDisplay, instances []*session.Instance, history []PlanDisplay, cancelled []PlanDisplay, planStatuses map[string]TopicStatus) {\n\tn.plans = plans\n\tn.instances = instances\n\tn.cancelled = cancelled\n\tif planStatuses == nil {\n\t\tn.planStatuses = make(map[string]TopicStatus)\n\t} else {\n\t\tn.planStatuses = planStatuses\n\t}\n\t// Split history into dead (has instances or manually inspected) and history.\n\tn.splitDeadFromHistory(history)\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) SetPlans(plans []PlanDisplay) {\n\tn.plans = plans\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) SetTopicsAndPlans(topics []TopicDisplay, ungrouped []PlanDisplay, history []PlanDisplay, cancelled ...[]PlanDisplay) {\n\tn.topics = topics\n\tif len(cancelled) > 0 {\n\t\tn.cancelled = cancelled[0]\n\t}\n\tplans := make([]PlanDisplay, 0, len(ungrouped))\n\tplans = append(plans, ungrouped...)\n\tfor _, t := range topics {\n\t\tplans = append(plans, t.Plans...)\n\t}\n\tn.plans = plans\n\t// Split history into dead (has instances or manually inspected) and history.\n\tn.splitDeadFromHistory(history)\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) SetItems(_ []string, _ map[string]int, _ int, _ map[string]bool, _ map[string]TopicStatus, planStatuses map[string]TopicStatus) {\n\tif planStatuses != nil {\n\t\tn.planStatuses = planStatuses\n\t}\n\tn.rebuildRows()\n}\n\n// splitDeadFromHistory partitions finished plans into three buckets:\n//   - active (promoted to n.plans): has running/loading instances\n//   - dead: has only non-running instances or was manually inspected\n//   - history: no instances at all\nfunc (n *NavigationPanel) splitDeadFromHistory(finished []PlanDisplay) {\n\ttype planInfo struct {\n\t\thasInstances bool\n\t\thasRunning   bool\n\t}\n\tinfoByPlan := make(map[string]planInfo, len(n.instances))\n\tfor _, inst := range n.instances {\n\t\tif inst.PlanFile != \"\" {\n\t\t\tinfo := infoByPlan[inst.PlanFile]\n\t\t\tinfo.hasInstances = true\n\t\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\t\tinfo.hasRunning = true\n\t\t\t}\n\t\t\tinfoByPlan[inst.PlanFile] = info\n\t\t}\n\t}\n\tn.deadPlans = nil\n\tn.historyPlans = nil\n\tfor _, p := range finished {\n\t\tinfo := infoByPlan[p.Filename]\n\t\tif info.hasRunning {\n\t\t\t// Running instances → promote to active plans list.\n\t\t\tn.plans = append(n.plans, p)\n\t\t} else if info.hasInstances || n.inspectedPlans[p.Filename] {\n\t\t\tn.deadPlans = append(n.deadPlans, p)\n\t\t} else {\n\t\t\tn.historyPlans = append(n.historyPlans, p)\n\t\t}\n\t}\n}\n\n// resplitDead re-partitions dead and history plans based on current instances.\nfunc (n *NavigationPanel) resplitDead() {\n\tall := make([]PlanDisplay, 0, len(n.deadPlans)+len(n.historyPlans))\n\tall = append(all, n.deadPlans...)\n\tall = append(all, n.historyPlans...)\n\tn.splitDeadFromHistory(all)\n}\n\n// InspectPlan moves a history plan into the dead section for manual inspection.\nfunc (n *NavigationPanel) InspectPlan(planFile string) {\n\tif n.inspectedPlans == nil {\n\t\tn.inspectedPlans = make(map[string]bool)\n\t}\n\tn.inspectedPlans[planFile] = true\n\tn.resplitDead()\n\tn.deadExpanded = true\n\tn.rebuildRows()\n}\n\nfunc (n *NavigationPanel) rebuildRows() {\n\tprevID := \"\"\n\tif n.selectedIdx >= 0 && n.selectedIdx < len(n.rows) {\n\t\tprevID = n.rows[n.selectedIdx].ID\n\t}\n\n\tinstancesByPlan := make(map[string][]*session.Instance)\n\tvar solo []*session.Instance\n\tfor _, inst := range n.instances {\n\t\tif inst.PlanFile == \"\" {\n\t\t\tsolo = append(solo, inst)\n\t\t\tcontinue\n\t\t}\n\t\tinstancesByPlan[inst.PlanFile] = append(instancesByPlan[inst.PlanFile], inst)\n\t}\n\n\tsortInstances := func(list []*session.Instance) {\n\t\tsort.SliceStable(list, func(i, j int) bool {\n\t\t\tki := navInstanceSortKey(list[i])\n\t\t\tkj := navInstanceSortKey(list[j])\n\t\t\tif ki != kj {\n\t\t\t\treturn ki < kj\n\t\t\t}\n\t\t\treturn strings.ToLower(list[i].Title) < strings.ToLower(list[j].Title)\n\t\t})\n\t}\n\tfor _, list := range instancesByPlan {\n\t\tsortInstances(list)\n\t}\n\tsortInstances(solo)\n\n\tplans := append([]PlanDisplay(nil), n.plans...)\n\tsort.SliceStable(plans, func(i, j int) bool {\n\t\tpi, pj := plans[i], plans[j]\n\t\tki := navPlanSortKey(pi, instancesByPlan[pi.Filename], n.planStatuses[pi.Filename])\n\t\tkj := navPlanSortKey(pj, instancesByPlan[pj.Filename], n.planStatuses[pj.Filename])\n\t\tif ki != kj {\n\t\t\treturn ki < kj\n\t\t}\n\t\treturn strings.ToLower(planstate.DisplayName(pi.Filename)) < strings.ToLower(planstate.DisplayName(pj.Filename))\n\t})\n\n\trows := make([]navRow, 0, len(plans)+len(n.instances)+len(n.deadPlans)+len(n.historyPlans)+len(n.cancelled)+6)\n\n\t// Helper to append a plan header + its child instances.\n\t// indent is the indentation level in spaces for the plan row.\n\tappendPlan := func(p PlanDisplay, indent int) {\n\t\tinsts := instancesByPlan[p.Filename]\n\t\thasRunning, hasNotification := aggregateNavPlanStatus(insts, n.planStatuses[p.Filename])\n\t\tcollapsed := n.isPlanCollapsed(p.Filename, hasRunning, hasNotification)\n\t\trows = append(rows, navRow{\n\t\t\tKind:            navRowPlanHeader,\n\t\t\tID:              SidebarPlanPrefix + p.Filename,\n\t\t\tLabel:           planstate.DisplayName(p.Filename),\n\t\t\tPlanFile:        p.Filename,\n\t\t\tCollapsed:       collapsed,\n\t\t\tHasRunning:      hasRunning,\n\t\t\tHasNotification: hasNotification,\n\t\t\tIndent:          indent,\n\t\t})\n\t\tif !collapsed {\n\t\t\tfor _, inst := range insts {\n\t\t\t\trows = append(rows, navRow{\n\t\t\t\t\tKind:     navRowInstance,\n\t\t\t\t\tID:       \"inst:\" + inst.Title,\n\t\t\t\t\tLabel:    inst.Title,\n\t\t\t\t\tPlanFile: inst.PlanFile,\n\t\t\t\t\tInstance: inst,\n\t\t\t\t\tIndent:   indent,\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\t}\n\n\t// Dead section: done plans with instances or manually inspected.\n\t// Shown above active plans so they're accessible for cleanup.\n\tif len(n.deadPlans) > 0 {\n\t\trows = append(rows, navRow{Kind: navRowDeadToggle, ID: \"__dead_toggle__\", Label: \"dead\", Collapsed: !n.deadExpanded})\n\t\tif n.deadExpanded {\n\t\t\tfor _, p := range n.deadPlans {\n\t\t\t\tappendPlan(p, 2)\n\t\t\t}\n\t\t}\n\t}\n\n\t// Split plans into active (sort key 0,1) and idle (sort key 2).\n\tvar activePlans, idlePlans []PlanDisplay\n\tfor _, p := range plans {\n\t\tsk := navPlanSortKey(p, instancesByPlan[p.Filename], n.planStatuses[p.Filename])\n\t\tif sk < 2 {\n\t\t\tactivePlans = append(activePlans, p)\n\t\t} else {\n\t\t\tidlePlans = append(idlePlans, p)\n\t\t}\n\t}\n\n\t// Emit active plans flat.\n\tfor _, p := range activePlans {\n\t\tappendPlan(p, 0)\n\t}\n\n\t// Solo instances between active and idle.\n\tif len(solo) > 0 {\n\t\trows = append(rows, navRow{Kind: navRowSoloHeader, ID: \"__solo__\", Label: \"agents\"})\n\t\tfor _, inst := range solo {\n\t\t\trows = append(rows, navRow{Kind: navRowInstance, ID: \"inst:\" + inst.Title, Label: inst.Title, Instance: inst})\n\t\t}\n\t}\n\n\t// Idle plans grouped by topic.\n\t// Build a set of idle filenames for quick lookup.\n\tidleSet := make(map[string]bool, len(idlePlans))\n\tfor _, p := range idlePlans {\n\t\tidleSet[p.Filename] = true\n\t}\n\n\t// Emit topics that contain idle plans.\n\temitted := make(map[string]bool)\n\tfor _, t := range n.topics {\n\t\tvar topicIdlePlans []PlanDisplay\n\t\tfor _, p := range t.Plans {\n\t\t\tif idleSet[p.Filename] {\n\t\t\t\ttopicIdlePlans = append(topicIdlePlans, p)\n\t\t\t}\n\t\t}\n\t\tif len(topicIdlePlans) == 0 {\n\t\t\tcontinue\n\t\t}\n\t\ttopicID := SidebarTopicPrefix + t.Name\n\t\tcollapsed := n.collapsed[topicID]\n\t\trows = append(rows, navRow{\n\t\t\tKind:      navRowTopicHeader,\n\t\t\tID:        topicID,\n\t\t\tLabel:     t.Name,\n\t\t\tCollapsed: collapsed,\n\t\t})\n\t\tif !collapsed {\n\t\t\tfor _, p := range topicIdlePlans {\n\t\t\t\tappendPlan(p, 2)\n\t\t\t\temitted[p.Filename] = true\n\t\t\t}\n\t\t} else {\n\t\t\tfor _, p := range topicIdlePlans {\n\t\t\t\temitted[p.Filename] = true\n\t\t\t}\n\t\t}\n\t}\n\n\t// Emit ungrouped idle plans (no topic).\n\tfor _, p := range idlePlans {\n\t\tif !emitted[p.Filename] {\n\t\t\tappendPlan(p, 0)\n\t\t}\n\t}\n\n\tif n.clickUpAvail {\n\t\trows = append(rows, navRow{Kind: navRowImportAction, ID: SidebarImportClickUp, Label: \"+ import from clickup\"})\n\t}\n\n\tif len(n.historyPlans) > 0 {\n\t\trows = append(rows, navRow{Kind: navRowHistoryToggle, ID: SidebarPlanHistoryToggle, Label: \"history\", Collapsed: !n.historyExpanded})\n\t\tif n.historyExpanded {\n\t\t\tfor _, p := range n.historyPlans {\n\t\t\t\trows = append(rows, navRow{Kind: navRowHistoryPlan, ID: SidebarPlanPrefix + p.Filename, Label: planstate.DisplayName(p.Filename), PlanFile: p.Filename})\n\t\t\t}\n\t\t}\n\t}\n\n\tfor _, p := range n.cancelled {\n\t\trows = append(rows, navRow{Kind: navRowCancelled, ID: SidebarPlanPrefix + p.Filename, Label: planstate.DisplayName(p.Filename), PlanFile: p.Filename})\n\t}\n\n\tn.rows = rows\n\tif len(rows) == 0 {\n\t\tn.selectedIdx = 0\n\t\tn.scrollOffset = 0\n\t\treturn\n\t}\n\tif prevID != \"\" {\n\t\tfor i, row := range rows {\n\t\t\tif row.ID == prevID {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n\tif n.selectedIdx >= len(rows) {\n\t\tn.selectedIdx = len(rows) - 1\n\t}\n\tif n.selectedIdx < 0 {\n\t\tn.selectedIdx = 0\n\t}\n\tn.clampScroll()\n}\n\nfunc navInstanceSortKey(inst *session.Instance) int {\n\tif inst.ImplementationComplete {\n\t\treturn 3\n\t}\n\tswitch inst.Status {\n\tcase session.Running, session.Loading:\n\t\treturn 0\n\tcase session.Paused:\n\t\treturn 2\n\t}\n\tif inst.Notified {\n\t\treturn 1\n\t}\n\t// Ready / unknown\n\treturn 3\n}\n\nfunc navPlanSortKey(_ PlanDisplay, insts []*session.Instance, st TopicStatus) int {\n\thasNotification := st.HasNotification\n\thasRunning := st.HasRunning\n\tfor _, inst := range insts {\n\t\tif inst.Notified {\n\t\t\thasNotification = true\n\t\t}\n\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\thasRunning = true\n\t\t}\n\t}\n\tif hasNotification {\n\t\treturn 0\n\t}\n\tif hasRunning {\n\t\treturn 1\n\t}\n\treturn 2\n}\n\nfunc aggregateNavPlanStatus(insts []*session.Instance, st TopicStatus) (bool, bool) {\n\thasRunning := st.HasRunning\n\thasNotification := st.HasNotification\n\tfor _, inst := range insts {\n\t\tif inst.Notified {\n\t\t\thasNotification = true\n\t\t}\n\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\thasRunning = true\n\t\t}\n\t}\n\treturn hasRunning, hasNotification\n}\n\nfunc (n *NavigationPanel) isPlanCollapsed(planFile string, hasRunning, hasNotification bool) bool {\n\tif _, ok := n.userOverrides[planFile]; ok {\n\t\treturn n.collapsed[planFile]\n\t}\n\treturn !hasRunning && !hasNotification\n}\n\nfunc (n *NavigationPanel) SetSize(width, height int) {\n\tn.width, n.height = width, height\n\tn.clampScroll()\n}\nfunc (n *NavigationPanel) SetFocused(focused bool)    { n.focused = focused }\nfunc (n *NavigationPanel) IsFocused() bool            { return n.focused }\nfunc (n *NavigationPanel) SetRepoName(name string)    { n.repoName = name }\nfunc (n *NavigationPanel) SetRepoHovered(h bool)      { n.repoHovered = h }\nfunc (n *NavigationPanel) SetClickUpAvailable(a bool) { n.clickUpAvail = a; n.rebuildRows() }\n\nfunc (n *NavigationPanel) ActivateSearch()        { n.searchActive = true; n.searchQuery = \"\" }\nfunc (n *NavigationPanel) DeactivateSearch()      { n.searchActive = false; n.searchQuery = \"\" }\nfunc (n *NavigationPanel) IsSearchActive() bool   { return n.searchActive }\nfunc (n *NavigationPanel) GetSearchQuery() string { return n.searchQuery }\nfunc (n *NavigationPanel) SetSearchQuery(q string) {\n\tn.searchQuery = q\n\t// If the current selection is hidden by the new filter, snap to the first visible row.\n\tif q != \"\" && len(n.rows) > 0 && !n.rowMatchesSearch(n.selectedIdx) {\n\t\tfor i := range n.rows {\n\t\t\tif n.rows[i].Kind != navRowSoloHeader && n.rowMatchesSearch(i) {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunc (n *NavigationPanel) ToggleSelectedExpand() bool {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn false\n\t}\n\trow := n.rows[n.selectedIdx]\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tn.collapsed[row.PlanFile] = !row.Collapsed\n\t\tn.userOverrides[row.PlanFile] = true\n\t\tn.rebuildRows()\n\t\treturn true\n\tcase navRowTopicHeader:\n\t\tn.collapsed[row.ID] = !row.Collapsed\n\t\tn.rebuildRows()\n\t\treturn true\n\tcase navRowDeadToggle:\n\t\tn.deadExpanded = !n.deadExpanded\n\t\tn.rebuildRows()\n\t\treturn true\n\tcase navRowHistoryToggle:\n\t\tn.historyExpanded = !n.historyExpanded\n\t\tn.rebuildRows()\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\nfunc (n *NavigationPanel) Up() {\n\torig := n.selectedIdx\n\tfor n.selectedIdx > 0 {\n\t\tn.selectedIdx--\n\t\tif n.rows[n.selectedIdx].Kind == navRowSoloHeader {\n\t\t\tcontinue // skip non-selectable divider\n\t\t}\n\t\tif !n.rowMatchesSearch(n.selectedIdx) {\n\t\t\tcontinue // skip rows hidden by search filter\n\t\t}\n\t\tn.clampScroll()\n\t\treturn\n\t}\n\t// No valid row found above — revert.\n\tn.selectedIdx = orig\n}\n\nfunc (n *NavigationPanel) Down() {\n\torig := n.selectedIdx\n\tfor n.selectedIdx+1 < len(n.rows) {\n\t\tn.selectedIdx++\n\t\tif n.rows[n.selectedIdx].Kind == navRowSoloHeader {\n\t\t\tcontinue\n\t\t}\n\t\tif !n.rowMatchesSearch(n.selectedIdx) {\n\t\t\tcontinue\n\t\t}\n\t\tn.clampScroll()\n\t\treturn\n\t}\n\tn.selectedIdx = orig\n}\n\n// rowMatchesSearch returns true if the row at idx is visible under the current\n// search filter. Always true when search is inactive or query is empty.\nfunc (n *NavigationPanel) rowMatchesSearch(idx int) bool {\n\tif !n.searchActive || n.searchQuery == \"\" {\n\t\treturn true\n\t}\n\trow := n.rows[idx]\n\tq := strings.ToLower(n.searchQuery)\n\treturn strings.Contains(strings.ToLower(row.Label), q) ||\n\t\tstrings.Contains(strings.ToLower(row.PlanFile), q)\n}\n\nfunc (n *NavigationPanel) Left() {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn\n\t}\n\trow := n.rows[n.selectedIdx]\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tif !row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t}\n\tcase navRowInstance:\n\t\tfor i := n.selectedIdx - 1; i >= 0; i-- {\n\t\t\tif n.rows[i].Kind == navRowPlanHeader {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunc (n *NavigationPanel) Right() {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn\n\t}\n\trow := n.rows[n.selectedIdx]\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tif row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t} else {\n\t\t\tn.Down()\n\t\t}\n\tcase navRowDeadToggle:\n\t\tif row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t} else {\n\t\t\tn.Down()\n\t\t}\n\tcase navRowHistoryToggle:\n\t\tif row.Collapsed {\n\t\t\tn.ToggleSelectedExpand()\n\t\t}\n\t}\n}\n\nfunc (n *NavigationPanel) GetSelectedInstance() *session.Instance {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn nil\n\t}\n\treturn n.rows[n.selectedIdx].Instance\n}\n\nfunc (n *NavigationPanel) GetSelectedPlanFile() string {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn \"\"\n\t}\n\treturn n.rows[n.selectedIdx].PlanFile\n}\n\nfunc (n *NavigationPanel) IsSelectedPlanHeader() bool {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn false\n\t}\n\tk := n.rows[n.selectedIdx].Kind\n\treturn k == navRowPlanHeader || k == navRowHistoryPlan || k == navRowCancelled\n}\n\n// IsSelectedHistoryPlan returns true if the selected row is a history plan entry.\nfunc (n *NavigationPanel) IsSelectedHistoryPlan() bool {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn false\n\t}\n\treturn n.rows[n.selectedIdx].Kind == navRowHistoryPlan\n}\n\nfunc (n *NavigationPanel) GetSelectedID() string {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn \"\"\n\t}\n\treturn n.rows[n.selectedIdx].ID\n}\n\nfunc (n *NavigationPanel) GetSelectedIdx() int  { return n.selectedIdx }\nfunc (n *NavigationPanel) GetScrollOffset() int { return n.scrollOffset }\n\nfunc (n *NavigationPanel) ClickItem(row int) {\n\tif row >= 0 && row < len(n.rows) {\n\t\tn.selectedIdx = row\n\t\tn.clampScroll()\n\t}\n}\n\nfunc (n *NavigationPanel) SelectByID(id string) bool {\n\tfor i, row := range n.rows {\n\t\tif row.ID == id {\n\t\t\tn.selectedIdx = i\n\t\t\tn.clampScroll()\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}\n\nfunc (n *NavigationPanel) SelectInstance(inst *session.Instance) bool {\n\tfor i, row := range n.rows {\n\t\tif row.Instance == inst {\n\t\t\tn.selectedIdx = i\n\t\t\tn.clampScroll()\n\t\t\treturn true\n\t\t}\n\t}\n\t// Instance not visible — may be under a collapsed plan. Expand it.\n\tif inst.PlanFile != \"\" {\n\t\tn.collapsed[inst.PlanFile] = false\n\t\tn.userOverrides[inst.PlanFile] = true\n\t\tn.rebuildRows()\n\t\tfor i, row := range n.rows {\n\t\t\tif row.Instance == inst {\n\t\t\t\tn.selectedIdx = i\n\t\t\t\tn.clampScroll()\n\t\t\t\treturn true\n\t\t\t}\n\t\t}\n\t}\n\treturn false\n}\n\nfunc (n *NavigationPanel) SetSelectedInstance(idx int) {\n\tif idx < 0 || idx >= len(n.instances) {\n\t\treturn\n\t}\n\t_ = n.SelectInstance(n.instances[idx])\n}\n\nfunc (n *NavigationPanel) SelectedIndex() int {\n\tinst := n.GetSelectedInstance()\n\tif inst == nil {\n\t\treturn 0\n\t}\n\tfor i, item := range n.instances {\n\t\tif item == inst {\n\t\t\treturn i\n\t\t}\n\t}\n\treturn 0\n}\n\nfunc (n *NavigationPanel) CycleNextActive() {\n\tn.cycleActive(1)\n}\n\nfunc (n *NavigationPanel) CyclePrevActive() {\n\tn.cycleActive(-1)\n}\n\nfunc (n *NavigationPanel) cycleActive(step int) {\n\t// Build the cycle list in visual (top-to-bottom) order so Ctrl+Up/Down\n\t// follows the on-screen layout across attention/active/solo sections.\n\t// For collapsed plan headers, insert their hidden instances at the\n\t// header's position so cycling can auto-expand them.\n\tvar ordered []*session.Instance\n\tfor _, row := range n.rows {\n\t\tswitch {\n\t\tcase row.Kind == navRowInstance && row.Instance != nil:\n\t\t\tif !row.Instance.Paused() {\n\t\t\t\tordered = append(ordered, row.Instance)\n\t\t\t}\n\t\tcase row.Kind == navRowPlanHeader && row.Collapsed:\n\t\t\t// Plan is collapsed — its instances aren't in rows.\n\t\t\t// Insert them here so they appear at the right visual position.\n\t\t\tfor _, inst := range n.instances {\n\t\t\t\tif inst.PlanFile == row.PlanFile && !inst.Paused() {\n\t\t\t\t\tordered = append(ordered, inst)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tif len(ordered) == 0 {\n\t\treturn\n\t}\n\n\t// Find current position. Match by instance pointer from the selected row.\n\tcur := -1\n\tsel := n.GetSelectedInstance()\n\tif sel != nil {\n\t\tfor i, inst := range ordered {\n\t\t\tif inst == sel {\n\t\t\t\tcur = i\n\t\t\t\tbreak\n\t\t\t}\n\t\t}\n\t}\n\tif cur < 0 {\n\t\tcur = 0\n\t}\n\n\tnext := (cur + step + len(ordered)) % len(ordered)\n\tn.SelectInstance(ordered[next])\n}\n\nfunc (n *NavigationPanel) GetInstances() []*session.Instance { return n.instances }\nfunc (n *NavigationPanel) TotalInstances() int               { return len(n.instances) }\nfunc (n *NavigationPanel) NumInstances() int                 { return len(n.instances) }\n\nfunc (n *NavigationPanel) AddInstance(inst *session.Instance) func() {\n\tn.instances = append(n.instances, inst)\n\tn.resplitDead()\n\tn.rebuildRows()\n\treturn func() {}\n}\n\nfunc (n *NavigationPanel) RemoveByTitle(title string) *session.Instance {\n\tfor i, inst := range n.instances {\n\t\tif inst.Title == title {\n\t\t\tn.instances = append(n.instances[:i], n.instances[i+1:]...)\n\t\t\tn.resplitDead()\n\t\t\tn.rebuildRows()\n\t\t\treturn inst\n\t\t}\n\t}\n\treturn nil\n}\n\nfunc (n *NavigationPanel) Remove() {\n\tinst := n.GetSelectedInstance()\n\tif inst != nil {\n\t\tn.RemoveByTitle(inst.Title)\n\t}\n}\n\nfunc (n *NavigationPanel) Kill() {\n\tinst := n.GetSelectedInstance()\n\tif inst != nil {\n\t\t_ = inst.Kill()\n\t\tn.RemoveByTitle(inst.Title)\n\t}\n}\n\nfunc (n *NavigationPanel) Attach() (chan struct{}, error) {\n\tinst := n.GetSelectedInstance()\n\tif inst == nil {\n\t\treturn nil, fmt.Errorf(\"no instance selected\")\n\t}\n\treturn inst.Attach()\n}\n\nfunc (n *NavigationPanel) Clear() {\n\tn.instances = nil\n\tn.rows = nil\n\tn.selectedIdx = 0\n\tn.scrollOffset = 0\n}\n\nfunc (n *NavigationPanel) SetSessionPreviewSize(width, height int) error {\n\tvar err error\n\tfor _, item := range n.instances {\n\t\tif !item.Started() || item.Paused() {\n\t\t\tcontinue\n\t\t}\n\t\tif innerErr := item.SetPreviewSize(width, height); innerErr != nil {\n\t\t\terr = innerErr\n\t\t}\n\t}\n\treturn err\n}\n\nfunc (n *NavigationPanel) SelectFirst() {\n\tif len(n.rows) > 0 {\n\t\tn.selectedIdx = 0\n\t\t// Skip non-selectable divider rows.\n\t\tif n.rows[0].Kind == navRowSoloHeader && len(n.rows) > 1 {\n\t\t\tn.selectedIdx = 1\n\t\t}\n\t\tn.clampScroll()\n\t}\n}\n\nfunc (n *NavigationPanel) SelectedSpaceAction() string {\n\tif n.selectedIdx < 0 || n.selectedIdx >= len(n.rows) {\n\t\treturn \"toggle\"\n\t}\n\tswitch n.rows[n.selectedIdx].Kind {\n\tcase navRowPlanHeader, navRowDeadToggle, navRowHistoryToggle:\n\t\tif n.rows[n.selectedIdx].Collapsed {\n\t\t\treturn \"expand\"\n\t\t}\n\t\treturn \"collapse\"\n\tdefault:\n\t\treturn \"toggle\"\n\t}\n}\n\nfunc (n *NavigationPanel) availRows() int {\n\tavail := n.height - 8\n\tif avail < 1 {\n\t\treturn 1\n\t}\n\treturn avail\n}\n\nfunc (n *NavigationPanel) clampScroll() {\n\tif len(n.rows) == 0 {\n\t\tn.scrollOffset = 0\n\t\treturn\n\t}\n\tavail := n.availRows()\n\tif n.selectedIdx < n.scrollOffset {\n\t\tn.scrollOffset = n.selectedIdx\n\t}\n\tif n.selectedIdx >= n.scrollOffset+avail {\n\t\tn.scrollOffset = n.selectedIdx - avail + 1\n\t}\n\tif n.scrollOffset < 0 {\n\t\tn.scrollOffset = 0\n\t}\n}\n\n// FindPlanInstance returns the best interactive candidate for a plan.\n// Priority: running > any non-paused instance. The caller should check\n// Started()/Paused() on the returned instance before entering focus mode.\nfunc (n *NavigationPanel) FindPlanInstance(planFile string) *session.Instance {\n\tvar best *session.Instance\n\tfor _, inst := range n.instances {\n\t\tif inst.PlanFile != planFile || inst.Paused() {\n\t\t\tcontinue\n\t\t}\n\t\tif inst.Status == session.Running || inst.Status == session.Loading {\n\t\t\treturn inst\n\t\t}\n\t\tif best == nil {\n\t\t\tbest = inst\n\t\t}\n\t}\n\treturn best\n}\n\n// navInstanceTitle returns a clean display title for an instance in the sidebar.\nfunc navInstanceTitle(inst *session.Instance) string {\n\tswitch {\n\tcase inst.WaveNumber > 0 && inst.TaskNumber > 0:\n\t\treturn fmt.Sprintf(\"wave %d · task %d\", inst.WaveNumber, inst.TaskNumber)\n\tcase inst.AgentType == session.AgentTypeReviewer && inst.PlanFile != \"\":\n\t\treturn \"review\"\n\tcase inst.AgentType == session.AgentTypePlanner && inst.PlanFile != \"\":\n\t\treturn \"planning\"\n\tcase inst.SoloAgent && inst.PlanFile != \"\":\n\t\treturn planstate.DisplayName(inst.PlanFile)\n\tcase inst.AgentType == session.AgentTypeCoder && inst.PlanFile != \"\" && inst.WaveNumber == 0:\n\t\treturn \"applying fixes\"\n\tdefault:\n\t\treturn inst.Title\n\t}\n}\n\n// navInstanceStatusIcon returns a styled status glyph for an instance.\nfunc (n *NavigationPanel) navInstanceStatusIcon(inst *session.Instance) string {\n\tif inst.SoloAgent && inst.Exited {\n\t\treturn navCancelledLblStyle.Render(\"✕\")\n\t}\n\tif inst.ImplementationComplete {\n\t\treturn navCompletedIconStyle.Render(\"✓\")\n\t}\n\tswitch inst.Status {\n\tcase session.Running, session.Loading:\n\t\tif n.spinner != nil {\n\t\t\treturn strings.TrimRight(n.spinner.View(), \" \")\n\t\t}\n\t\treturn navRunningIconStyle.Render(\"●\")\n\tcase session.Ready:\n\t\tif inst.Notified {\n\t\t\treturn navNotifyIconStyle.Render(\"◉\")\n\t\t}\n\t\treturn navReadyIconStyle.Render(\"●\")\n\tcase session.Paused:\n\t\treturn navPausedIconStyle.Render(\"\\uf04c\")\n\tdefault:\n\t\treturn navIdleIconStyle.Render(\"○\")\n\t}\n}\n\n// navPlanStatusIcon returns a styled status glyph for a plan header row.\nfunc navPlanStatusIcon(row navRow) string {\n\tif row.HasNotification {\n\t\treturn navNotifyIconStyle.Render(\"◉\")\n\t}\n\tif row.HasRunning {\n\t\treturn navRunningIconStyle.Render(\"●\")\n\t}\n\treturn navIdleIconStyle.Render(\"○\")\n}\n\n// navSectionLabel returns a lowercase section label for a plan sort key.\nfunc navSectionLabel(key int) string {\n\tswitch key {\n\tcase 0:\n\t\treturn \"attention\"\n\tcase 1:\n\t\treturn \"active\"\n\tdefault:\n\t\treturn \"plans\"\n\t}\n}\n\n// navDividerLine builds a full-width rule like \"──── label ────\" spanning w cells.\nfunc navDividerLine(label string, w int) string {\n\tinner := \" \" + label + \" \"\n\tinnerW := runewidth.StringWidth(inner)\n\tremaining := w - innerW\n\tif remaining < 2 {\n\t\treturn navHistoryDivStyle.Render(inner)\n\t}\n\tleft := remaining / 2\n\tright := remaining - left\n\treturn navHistoryDivStyle.Render(strings.Repeat(\"─\", left) + inner + strings.Repeat(\"─\", right))\n}\n\n// renderNavRow renders a single row's content (without selection styling).\nfunc (n *NavigationPanel) renderNavRow(row navRow, contentWidth int) string {\n\tswitch row.Kind {\n\tcase navRowPlanHeader:\n\t\tchevron := \"▸\"\n\t\tif !row.Collapsed {\n\t\t\tchevron = \"▾\"\n\t\t}\n\t\tstatusIcon := navPlanStatusIcon(row)\n\t\tstatusW := lipgloss.Width(statusIcon)\n\t\tindent := strings.Repeat(\" \", row.Indent)\n\t\tindentW := row.Indent\n\n\t\tlabel := row.Label\n\t\t// Layout: indent + chevron(1) + space(1) + label + gap + space(1) + status\n\t\tmaxLabel := contentWidth - indentW - 3 - statusW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\n\t\tusedW := indentW + 2 + runewidth.StringWidth(label) + 1 + statusW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\t\t// Plans under topics use normal weight; top-level plans use bold.\n\t\tlabelStyle := navPlanLabelStyle\n\t\tif row.Indent > 0 {\n\t\t\tlabelStyle = navPlanLabelStyle.Bold(false)\n\t\t}\n\t\treturn indent + chevron + \" \" + labelStyle.Render(label) + strings.Repeat(\" \", gap) + \" \" + statusIcon\n\n\tcase navRowInstance:\n\t\tinst := row.Instance\n\t\tisSolo := row.PlanFile == \"\"\n\n\t\tif inst == nil {\n\t\t\tif isSolo {\n\t\t\t\treturn row.Label\n\t\t\t}\n\t\t\treturn \"    \" + row.Label\n\t\t}\n\t\ttitle := navInstanceTitle(inst)\n\t\tstatusIcon := n.navInstanceStatusIcon(inst)\n\t\tstatusW := lipgloss.Width(statusIcon)\n\n\t\tindentW := row.Indent + 4\n\t\tif isSolo {\n\t\t\tindentW = 0\n\t\t}\n\t\t// Layout: indent + title + gap + space(1) + status\n\t\tmaxLabel := contentWidth - indentW - 1 - statusW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(title) > maxLabel {\n\t\t\ttitle = runewidth.Truncate(title, maxLabel-1, \"…\")\n\t\t}\n\n\t\tusedW := indentW + runewidth.StringWidth(title) + 1 + statusW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\n\t\tindent := strings.Repeat(\" \", indentW)\n\t\tlabelStyle := navInstanceLabelStyle\n\t\tif isSolo {\n\t\t\tindent = \"\"\n\t\t\tlabelStyle = navPlanLabelStyle\n\t\t}\n\t\t// Killed solo agents: grey + strikethrough.\n\t\tif inst.SoloAgent && inst.Exited {\n\t\t\tlabelStyle = navCancelledLblStyle\n\t\t\tstatusIcon = navCancelledLblStyle.Render(\"✕\")\n\t\t\tstatusW = lipgloss.Width(statusIcon)\n\t\t\t// Recompute gap with updated status width.\n\t\t\tusedW = indentW + runewidth.StringWidth(title) + 1 + statusW\n\t\t\tgap = contentWidth - usedW\n\t\t\tif gap < 0 {\n\t\t\t\tgap = 0\n\t\t\t}\n\t\t}\n\t\treturn indent + labelStyle.Render(title) + strings.Repeat(\" \", gap) + \" \" + statusIcon\n\n\tcase navRowSoloHeader:\n\t\treturn navDividerLine(\"agents\", contentWidth)\n\n\tcase navRowTopicHeader:\n\t\tchevron := \"▸\"\n\t\tif !row.Collapsed {\n\t\t\tchevron = \"▾\"\n\t\t}\n\t\tlabel := row.Label\n\t\tmaxLabel := contentWidth - 2 // chevron + space\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\t\treturn chevron + \" \" + navPlanLabelStyle.Render(label)\n\n\tcase navRowDeadToggle:\n\t\treturn navDividerLine(\"dead\", contentWidth)\n\n\tcase navRowHistoryToggle:\n\t\tchevron := \"▸\"\n\t\tif !row.Collapsed {\n\t\t\tchevron = \"▾\"\n\t\t}\n\t\treturn navDividerLine(chevron+\" history\", contentWidth)\n\n\tcase navRowHistoryPlan:\n\t\tlabel := row.Label\n\t\tdoneIcon := navCompletedIconStyle.Render(\"●\")\n\t\tdoneW := lipgloss.Width(doneIcon)\n\t\tmaxLabel := contentWidth - 1 - doneW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\t\tusedW := runewidth.StringWidth(label) + 1 + doneW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\t\treturn navIdleIconStyle.Render(label) + strings.Repeat(\" \", gap) + \" \" + doneIcon\n\n\tcase navRowCancelled:\n\t\tlabel := row.Label\n\t\tconst trailW = 2\n\t\tmaxLabel := contentWidth - trailW\n\t\tif maxLabel < 3 {\n\t\t\tmaxLabel = 3\n\t\t}\n\t\tif runewidth.StringWidth(label) > maxLabel {\n\t\t\tlabel = runewidth.Truncate(label, maxLabel-1, \"…\")\n\t\t}\n\t\tusedW := runewidth.StringWidth(label) + trailW\n\t\tgap := contentWidth - usedW\n\t\tif gap < 0 {\n\t\t\tgap = 0\n\t\t}\n\t\treturn navCancelledLblStyle.Render(label) + strings.Repeat(\" \", gap) + \" \" + navCancelledLblStyle.Render(\"✕\")\n\n\tcase navRowImportAction:\n\t\treturn row.Label\n\n\tdefault:\n\t\treturn row.Label\n\t}\n}\n\nfunc (n *NavigationPanel) String() string {\n\tborder := lipgloss.NewStyle().Border(lipgloss.RoundedBorder()).BorderForeground(ColorOverlay).Padding(0, 1)\n\tif n.focused {\n\t\tborder = border.Border(lipgloss.DoubleBorder()).BorderForeground(ColorIris)\n\t}\n\tinnerWidth := n.width - 4\n\tif innerWidth < 8 {\n\t\tinnerWidth = 8\n\t}\n\theight := n.height - 2\n\tif height < 4 {\n\t\theight = 4\n\t}\n\n\titemWidth := innerWidth - 2   // border has Padding(0,1) → content area is 2 chars narrower\n\tcontentWidth := itemWidth - 2 // account for Padding(0,1) in row styles\n\tif contentWidth < 4 {\n\t\tcontentWidth = 4\n\t}\n\n\t// Search bar\n\tsearchWidth := innerWidth - 4\n\tif searchWidth < 4 {\n\t\tsearchWidth = 4\n\t}\n\tvar searchBox string\n\tif n.searchActive {\n\t\tsearchText := n.searchQuery\n\t\tif searchText == \"\" {\n\t\t\tsearchText = \" \"\n\t\t}\n\t\tsearchBox = zone.Mark(ZoneNavSearch, navSearchActiveStyle.Width(searchWidth).Render(searchText))\n\t} else {\n\t\tsearchBox = zone.Mark(ZoneNavSearch, navSearchBoxStyle.Width(searchWidth).Render(\"\\uf002 search\"))\n\t}\n\n\t// Build visible items, including section dividers between plan sort-key groups.\n\ttype visItem struct {\n\t\tline   string\n\t\trowIdx int // -1 for section dividers\n\t}\n\titems := make([]visItem, 0, len(n.rows)+4)\n\tselectedDisplayIdx := 0\n\tlastPlanKey := -1\n\tinDeadSection := false\n\n\tfor i, row := range n.rows {\n\t\t// Search filter\n\t\tif n.searchActive && n.searchQuery != \"\" {\n\t\t\tq := strings.ToLower(n.searchQuery)\n\t\t\tif !strings.Contains(strings.ToLower(row.Label), q) &&\n\t\t\t\t!strings.Contains(strings.ToLower(row.PlanFile), q) {\n\t\t\t\tcontinue\n\t\t\t}\n\t\t}\n\n\t\t// Track dead section boundaries to suppress plan-group dividers.\n\t\tif row.Kind == navRowDeadToggle {\n\t\t\tinDeadSection = true\n\t\t} else if row.Kind != navRowPlanHeader && row.Kind != navRowInstance {\n\t\t\tinDeadSection = false\n\t\t}\n\n\t\t// Insert section dividers between plan sort-key groups\n\t\tif row.Kind == navRowPlanHeader && !inDeadSection {\n\t\t\tsk := 2\n\t\t\tif row.HasNotification {\n\t\t\t\tsk = 0\n\t\t\t} else if row.HasRunning {\n\t\t\t\tsk = 1\n\t\t\t}\n\t\t\tif sk != lastPlanKey {\n\t\t\t\tlabel := navSectionLabel(sk)\n\t\t\t\tdivLine := navDividerLine(label, itemWidth)\n\t\t\t\titems = append(items, visItem{line: divLine, rowIdx: -1})\n\t\t\t\tlastPlanKey = sk\n\t\t\t}\n\t\t}\n\t\t// Topic headers are always idle — ensure the idle divider appears.\n\t\tif row.Kind == navRowTopicHeader && lastPlanKey != 2 {\n\t\t\tdivLine := navDividerLine(navSectionLabel(2), itemWidth)\n\t\t\titems = append(items, visItem{line: divLine, rowIdx: -1})\n\t\t\tlastPlanKey = 2\n\t\t}\n\n\t\tif i == n.selectedIdx {\n\t\t\tselectedDisplayIdx = len(items)\n\t\t}\n\n\t\t// Render the row content\n\t\trawLine := n.renderNavRow(row, contentWidth)\n\n\t\t// Apply selection highlighting\n\t\tisSelected := i == n.selectedIdx\n\t\tvar styledLine string\n\t\tif isSelected && n.focused {\n\t\t\tstyledLine = navSelectedRowStyle.Width(itemWidth).Render(ansi.Strip(rawLine))\n\t\t} else if isSelected {\n\t\t\tstyledLine = navActiveRowStyle.Width(itemWidth).Render(ansi.Strip(rawLine))\n\t\t} else if row.Kind == navRowImportAction {\n\t\t\tstyledLine = navImportStyle.Width(itemWidth).Render(rawLine)\n\t\t} else {\n\t\t\tstyledLine = navItemStyle.Width(itemWidth).Render(rawLine)\n\t\t}\n\n\t\titems = append(items, visItem{line: styledLine, rowIdx: i})\n\t}\n\n\t// Scroll window — keep the selected item visible\n\tavail := n.availRows()\n\tstart := selectedDisplayIdx - avail/2\n\tif start < 0 {\n\t\tstart = 0\n\t}\n\tend := start + avail\n\tif end > len(items) {\n\t\tend = len(items)\n\t\tstart = end - avail\n\t\tif start < 0 {\n\t\t\tstart = 0\n\t\t}\n\t}\n\n\tvar bodyLines []string\n\tfor _, item := range items[start:end] {\n\t\tline := item.line\n\t\tif item.rowIdx >= 0 {\n\t\t\tline = zone.Mark(NavRowZoneID(item.rowIdx), line)\n\t\t}\n\t\tbodyLines = append(bodyLines, line)\n\t}\n\tbody := strings.Join(bodyLines, \"\\n\")\n\tif body != \"\" {\n\t\tbody += \"\\n\"\n\t}\n\n\t// Legend — status icon key, centered in the pane\n\tlegendContent := navIdleIconStyle.Render(\"○\") + navLegendLabelStyle.Render(\" idle\") +\n\t\t\"  \" + navRunningIconStyle.Render(\"●\") + navLegendLabelStyle.Render(\" running\") +\n\t\t\"  \" + navNotifyIconStyle.Render(\"◉\") + navLegendLabelStyle.Render(\" review\") +\n\t\t\"  \" + navCompletedIconStyle.Render(\"●\") + navLegendLabelStyle.Render(\" done\")\n\tlegend := lipgloss.NewStyle().Width(innerWidth).Align(lipgloss.Center).Render(legendContent)\n\n\t// Repo switcher\n\tvar repoSection string\n\tif n.repoName != \"\" {\n\t\tbtnWidth := innerWidth - 4\n\t\tif btnWidth < 4 {\n\t\t\tbtnWidth = 4\n\t\t}\n\t\trepoBtn := lipgloss.NewStyle().\n\t\t\tBorder(lipgloss.RoundedBorder()).\n\t\t\tBorderForeground(ColorOverlay).\n\t\t\tPadding(0, 1).\n\t\t\tWidth(btnWidth).\n\t\t\tRender(n.repoName + \" ▾\")\n\t\trepoSection = zone.Mark(ZoneNavRepo, repoBtn)\n\t}\n\n\t// Assemble content with bottom-pinned legend + repo button\n\ttopContent := searchBox + \"\\n\\n\" + body\n\tvar bottomSection string\n\tif repoSection != \"\" {\n\t\tbottomSection = legend + \"\\n\" + repoSection\n\t} else {\n\t\tbottomSection = legend\n\t}\n\n\ttopLines := strings.Count(topContent, \"\\n\") + 1\n\tbottomLines := strings.Count(bottomSection, \"\\n\") + 1\n\tgap := height - topLines - bottomLines + 1\n\tif gap < 1 {\n\t\tgap = 1\n\t}\n\tinnerContent := topContent + strings.Repeat(\"\\n\", gap) + bottomSection\n\n\tbordered := border.Width(innerWidth).Height(height).Render(innerContent)\n\tplaced := lipgloss.Place(n.width, n.height, lipgloss.Left, lipgloss.Top, bordered)\n\n\t// Clamp output to n.height lines\n\tif n.height > 0 {\n\t\tlines := strings.Split(placed, \"\\n\")\n\t\tif len(lines) > n.height {\n\t\t\tlines = lines[:n.height]\n\t\t\tplaced = strings.Join(lines, \"\\n\")\n\t\t}\n\t}\n\treturn zone.Mark(ZoneNavPanel, placed)\n}\n\n// RowCount returns the number of rows in the navigation panel rows slice.\n// Used by zone-based mouse hit detection to iterate row zones.\nfunc (n *NavigationPanel) RowCount() int { return len(n.rows) }\n",
              "additions": 1,
              "deletions": 0,
              "status": "modified"
            }
          ]
        },
        "agent": "custodial",
        "model": {
          "providerID": "anthropic",
          "modelID": "claude-opus-4-6"
        },
        "id": "msg_ca135a66d001GE55syAdC1BgpX",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "text",
          "text": "dont implement this, take the contents of it and merge it with the description of review-use-kas-verify then mark this plan cancelled",
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135a66d001GE55syAdC1BgpX"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231173763,
          "completed": 1772231178553
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 34931,
          "input": 3,
          "output": 121,
          "reasoning": 0,
          "cache": {
            "read": 0,
            "write": 34807
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca135a683001CuPEiC5BGc26PO",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135a683001CuPEiC5BGc26PO"
        },
        {
          "type": "text",
          "text": "\n\nLet me find both plan files first.",
          "time": {
            "start": 1772231177640,
            "end": 1772231177640
          },
          "id": "prt_ca135b35e00254CjCRm4fUUUuS",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135a683001CuPEiC5BGc26PO"
        },
        {
          "type": "tool",
          "callID": "toolu_01AsvfVKYbymoJtFm1AJhE5p",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "docs/plans/*implement-a-custom*"
            },
            "output": "No files found",
            "title": "",
            "metadata": {
              "count": 0,
              "truncated": false
            },
            "time": {
              "start": 1772231178221,
              "end": 1772231178226
            }
          },
          "id": "prt_ca135b5a9001WhWjp1Os1SDpk7",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135a683001CuPEiC5BGc26PO"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "docs/plans/*review-use-kas-verify*"
            },
            "output": "No files found",
            "title": "",
            "metadata": {
              "count": 0,
              "truncated": false
            },
            "time": {
              "start": 1772231178473,
              "end": 1772231178478
            }
          },
          "id": "prt_ca135b7ef001pXPht03Bm2u6kz",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135a683001CuPEiC5BGc26PO"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "cost": 0,
          "tokens": {
            "total": 34931,
            "input": 3,
            "output": 121,
            "reasoning": 0,
            "cache": {
              "read": 0,
              "write": 34807
            }
          },
          "id": "prt_ca135b931001PtPk0H2jE7LLSw",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135a683001CuPEiC5BGc26PO"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231178554,
          "completed": 1772231182240
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 35135,
          "input": 1,
          "output": 132,
          "reasoning": 0,
          "cache": {
            "read": 34807,
            "write": 195
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca135b93a001wxgQ534xq16Mya",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "id": "prt_ca135c2dc001Ymjjd5xCmhzQvJ",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135b93a001wxgQ534xq16Mya"
        },
        {
          "type": "tool",
          "callID": "toolu_01G6G5M924dK41Nw3t7W6S46",
          "tool": "glob",
          "state": {
            "status": "completed",
            "input": {
              "pattern": "docs/plans/*"
            },
            "output": "/home/kas/dev/kasmos/docs/plans/plan-state.json\n/home/kas/dev/kasmos/docs/plans/2026-02-27-external-plan-reviewer.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-plan-review.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-reliable-planner-completion.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-chat-and-custodial-customizations.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-quit-confirmation-dialog.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-kasmos-custom-skills.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-kasmos-native-skills-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-create-kasmos-custodial-agent.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-create-kasmos-custodial-agent-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-simplify-new-plan.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-tmux-session-summary.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-tmux-session-summary-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-27-release-1-0-0-failures.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-release-v1-0-0.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-new-plan-cli-command.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-kas-verify-loop.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-release-v1-0-0-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-tmux-session-browser.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-tmux-session-browser-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-bubblezone-mouse.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-bubblezone-mouse-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-kas-verify-loop-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-detect-allow-perms.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-detect-allow-perms-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-redesign-instance-list.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-redesign-instance-list-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-stepthrough-worktrees.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-subtask-self-awareness.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-subtask-self-awareness-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-spawn-agent.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-spawn-agent-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-remove-dev-skills.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-details-tab.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-details-tab-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-26-cleanup-superpowers-cmds.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-opencode-default-harness.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-enforce-cli-tools.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-enforce-cli-tools-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-wizard-tui-redesign.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-review-approval-gate.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-review-approval-gate-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-solo-agent-mode.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-solo-agent-mode-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-simplify-plan-creation.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-simplify-plan-creation-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-scroll-overflow.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-scroll-overflow-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-prompt-via-cli.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-prompt-via-cli-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-improve-cli-tools.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-contextual-status-bar.md\n/home/kas/dev/kasmos/docs/plans/2026-02-25-contextual-status-bar-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-sentry-integration.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-sentry-integration-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-spring.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-spring-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-20-kq-init-plan.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-live-preview-terminal.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-live-preview-terminal-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-list-left-mark-complete.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-orphan-session-recovery.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-clickup-import.md\n/home/kas/dev/kasmos/docs/plans/2026-02-24-orphan-session-recovery-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-23-clickup-import-design.md\n/home/kas/dev/kasmos/docs/plans/.plan-state.lock\n/home/kas/dev/kasmos/docs/plans/SESSION-HANDOFF.md\n/home/kas/dev/kasmos/docs/plans/PRIORITY-ROADMAP.md\n/home/kas/dev/kasmos/docs/plans/2026-02-23-update-ascii-art.md\n/home/kas/dev/kasmos/docs/plans/2026-02-23-plan-state-machine.md\n/home/kas/dev/kasmos/docs/plans/2026-02-23-plan-state-machine-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-wave-orchestration.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-wave-orchestration-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-tree-mode-sidebar-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-tab-focus-ring.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-tab-focus-ring-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-rename-to-kasmos.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-rename-to-kasmos-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-planner-exit-prompt.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-planner-exit-prompt-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-disable-cache-focused.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-async-metadata-tick.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-2-tree-mode-wiring.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-1c-highlight-boost-list.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-1b-tree-navigation.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-1a-tree-renderer.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-plan-lifecycle-sessions.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-plan-instance-grouping.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-plan-centric-sidebar.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-global-skill-sync.md\n/home/kas/dev/kasmos/docs/plans/2026-02-20-task-orchestration.md\n/home/kas/dev/kasmos/docs/plans/2026-02-20-plan-orchestration.md\n/home/kas/dev/kasmos/docs/plans/2026-02-22-kq-check.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-topics-collision-domains.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-topics-as-collision-domains-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-sidebar-toggle.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-sidebar-toggle-design.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-sidebar-nav-showhide.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-rose-pine-moon.md\n/home/kas/dev/kasmos/docs/plans/2026-02-21-rose-pine-moon-design.md\n\n(Results are truncated: showing first 100 results. Consider using a more specific path or pattern.)",
            "title": "",
            "metadata": {
              "count": 100,
              "truncated": true
            },
            "time": {
              "start": 1772231181430,
              "end": 1772231181435
            }
          },
          "id": "prt_ca135c2dc002msvjss17uNu3nU",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135b93a001wxgQ534xq16Mya"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "kas plan list 2>/dev/null || echo \"kas plan command not available\"",
              "description": "List all kasmos plans"
            },
            "output": "done           2026-02-20-kq-init-design.md\ndone           2026-02-20-plan-orchestration-design.md\ndone           2026-02-20-plan-orchestration.md\ndone           2026-02-20-project-skills-distribution.md\ndone           2026-02-20-task-orchestration-design.md\ndone           2026-02-20-task-orchestration.md\ndone           2026-02-20-tool-discovery-design.md\ndone           2026-02-20-wizard-ux-design.md\ndone           2026-02-20-wizard-ux.md\ndone           2026-02-21-agent-customize-gate.md\ndone           2026-02-21-fix-naming-and-toast-wrap.md\ndone           2026-02-21-fix-plan-state-machine.md\ndone           2026-02-21-generate-opencode-jsonc-design.md\ndone           2026-02-21-generate-opencode-jsonc.md\ndone           2026-02-21-global-skill-sync.md\ndone           2026-02-21-init-wizard-refinements.md\ndone           2026-02-21-osc11-terminal-bg-design.md\ndone           2026-02-21-osc11-terminal-bg.md\ncancelled      2026-02-21-plan-centric-sidebar.md\ndone           2026-02-21-plan-instance-grouping.md\ndone           2026-02-21-plan-lifecycle-sessions.md\ndone           2026-02-21-rose-pine-moon-design.md\ndone           2026-02-21-rose-pine-moon.md\ndone           2026-02-21-sidebar-nav-showhide.md\ndone           2026-02-21-sidebar-toggle-design.md\ndone           2026-02-21-sidebar-toggle.md\ndone           2026-02-21-topics-as-collision-domains-design.md\ndone           2026-02-21-topics-collision-domains.md\ndone           2026-02-22-1a-tree-renderer.md                     kas/1a-tree-renderer-plan\ndone           2026-02-22-1b-tree-navigation.md                   kas/1b-tree-navigation-plan\ndone           2026-02-22-1c-highlight-boost-list.md              plan/1c-highlight-boost-list\ndone           2026-02-22-2-tree-mode-wiring.md                   plan/2-tree-mode-wiring\ndone           2026-02-22-async-metadata-tick.md\ndone           2026-02-22-center-col-v-align.md                   plan/center-col-v-align\ncancelled      2026-02-22-center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet.md plan/center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet\ndone           2026-02-22-customize-superpowers.md                plan/customize-superpowers\ncancelled      2026-02-22-detect-permissions-needed.md            plan/detect-permissions-needed\ndone           2026-02-22-disable-cache-focused.md                plan/disable-cache-focused\ndone           2026-02-22-dupe-task-after-plan-change.md          plan/dupe-task-after-plan-change\ndone           2026-02-22-kq-check.md\ncancelled      2026-02-22-parallelize-superpowers.md              plan/parallelize-superpowers\ndone           2026-02-22-planner-exit-prompt.md\ndone           2026-02-22-remove-right-sidbar-right-to-focus-session.md plan/remove-right-sidbar-right-to-focus-session\ndone           2026-02-22-rename-to-kasmos.md                     plan/rename-to-kasmos\ndone           2026-02-22-shorten-cta.md                          plan/shorten-cta\ndone           2026-02-22-tab-focus-ring.md\ndone           2026-02-22-update-shortcut-hints.md                plan/update-shortcut-hints\ndone           2026-02-22-wave-orchestration.md                   plan/wave-orchestration\ndone           2026-02-23-plan-state-machine.md                   plan/plan-state-machine\ndone           2026-02-23-update-ascii-art.md                     plan/update-ascii-art\ncancelled      2026-02-24-add-episodic-memory.md                  plan/add-episodic-memory\ndone           2026-02-24-clickup-import.md                       plan/clickup-import\ndone           2026-02-24-live-preview-terminal.md                plan/live-preview-terminal\ncancelled      2026-02-24-orphan-session-recovery.md              plan/orphan-session-recovery\ncancelled      2026-02-24-parallel-fix-agents.md                  plan/parallel-fix-agents\ndone           2026-02-24-review-approval-gate.md                 plan/review-approval-gate\ndone           2026-02-24-sentry-integration.md                   plan/sentry-integration\ndone           2026-02-24-spring.md                               plan/spring\ndone           2026-02-24-wizard-tui-redesign.md                  plan/wizard-tui-redesign\ndone           2026-02-25-alt-v-not-working.md                    plan/alt-v-not-working\ndone           2026-02-25-contextual-status-bar.md                plan/contextual-status-bar\ndone           2026-02-25-enforce-cli-tools.md                    plan/enforce-cli-tools\ndone           2026-02-25-fix-planner-missing-waves.md            plan/fix-planner-missing-waves\ndone           2026-02-25-improve-cli-tools.md                    plan/improve-cli-tools\ndone           2026-02-25-new-plan-tab-cycle.md                   plan/new-plan-tab-cycle\ndone           2026-02-25-opencode-default-harness.md             plan/opencode-default-harness\ndone           2026-02-25-prompt-via-cli.md                       plan/prompt-via-cli\nready          2026-02-25-reintegrate-auto-accept.md              plan/reintegrate-auto-accept\ndone           2026-02-25-scroll-overflow.md                      plan/scroll-overflow\ndone           2026-02-25-show-plan-name-for-topics.md            plan/show-plan-name-for-topics\ndone           2026-02-25-simplify-plan-creation.md               plan/simplify-plan-creation\ndone           2026-02-25-solo-agent-mode.md                      plan/solo-agent-mode\ndone           2026-02-26-bubblezone-mouse.md                     plan/bubblezone\ndone           2026-02-26-cleanup-superpowers-cmds.md             plan/cleanup-superpowers-cmds\ndone           2026-02-26-details-tab.md                          plan/details-tab\ndone           2026-02-26-detect-allow-perms.md                   plan/detect-allow-perms\ndone           2026-02-26-enter-not-reachable.md                  plan/enter-not-reachable\ndone           2026-02-26-kas-verify-loop.md                      plan/kas-verify-loop\nplanning       2026-02-26-new-plan-cli-command.md                 plan/new-cli-command\ncancelled      2026-02-26-no-plan-to-implement-prompt.md          plan/no-plan-to-implement-prompt\ndone           2026-02-26-redesign-instance-list.md\ndone           2026-02-26-release-v1-0-0.md                       plan/release-v1-0-0\nready          2026-02-26-sentry-analysis.md                      plan/sentry-analysis\ndone           2026-02-26-spawn-agent.md                          plan/spawn-agent\ndone           2026-02-26-stepthrough-worktrees.md                plan/stepthrough-worktrees\ndone           2026-02-26-tmux-session-browser.md                 plan/tmux-session-browser\ncancelled      2026-02-26-validate-recent-merges.md               plan/validate-recent-merges\ndone           2026-02-26-yes-keybind.md                          plan/yes-keybind\ndone           2026-02-27-always-focus-sidebar.md                 plan/always-focus-sidebar\nready          2026-02-27-audit-log.md                            plan/audit-log\ncancelled      2026-02-27-build-custom-skills-replaced.md         plan/build-custom-skills\ndone           2026-02-27-canceled-plans-delay-removal.md         plan/canceled-plans-delay-removal\ndone           2026-02-27-chat-and-custodial-customizations.md    plan/chat-and-custodial-customizations\nready          2026-02-27-cleanup-tracked-state.md                plan/cleanup-tracked-state\nready          2026-02-27-create-a-debugging-skill-and-agent-type-should.md plan/create-a-debugging-skill-and-agent-type-should\ndone           2026-02-27-create-kasmos-custodial-agent.md        plan/create-kasmos-custodial-agent\ncancelled      2026-02-27-ctrl-ud-pagination.md                   plan/ctrl-ud-pagination\ndone           2026-02-27-disable-cla-for-prs.md                  plan/disable-cla-for-prs\ndone           2026-02-27-fix-wave-header-generation.md           plan/fix-wave-header-generation\nimplementing   2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md plan/implement-a-custom-kas-verify-tiered-review-process-for\ncancelled      2026-02-27-improve-planner-to-implementation.md    plan/improve-planner-to-implementation\ndone           2026-02-27-kasmos-custom-skills.md                 plan/kasmos-custom-skills\ndone           2026-02-27-kasmos-native-skills-design.md\ndone           2026-02-27-kasmos-native-skills.md\nready          2026-02-27-new-plan-issues.md                      plan/new-plan-issues\ndone           2026-02-27-plan-review.md                          plan/plan-review\ndone           2026-02-27-quit-confirmation-dialog.md             plan/quit-confirmation-dialog\ndone           2026-02-27-release-1-0-0-failures.md               plan/release-1-0-0-failures\ndone           2026-02-27-release-v1-1.md                         plan/release-v1-1\ndone           2026-02-27-reliable-planner-completion.md          plan/reliable-planner-completion\ndone           2026-02-27-rename-plan-menu.md                     plan/rename-plan-menu\nready          2026-02-27-review-use-kas-verify.md                plan/review-use-kas-verify\nready          2026-02-27-set-status-context-menu.md              plan/set-status-context-menu\ndone           2026-02-27-simplify-new-plan.md                    plan/simplify-new-plan\ndone           2026-02-27-tmux-session-summary.md                 plan/tmux-session-summary\n",
            "title": "List all kasmos plans",
            "metadata": {
              "output": "done           2026-02-20-kq-init-design.md\ndone           2026-02-20-plan-orchestration-design.md\ndone           2026-02-20-plan-orchestration.md\ndone           2026-02-20-project-skills-distribution.md\ndone           2026-02-20-task-orchestration-design.md\ndone           2026-02-20-task-orchestration.md\ndone           2026-02-20-tool-discovery-design.md\ndone           2026-02-20-wizard-ux-design.md\ndone           2026-02-20-wizard-ux.md\ndone           2026-02-21-agent-customize-gate.md\ndone           2026-02-21-fix-naming-and-toast-wrap.md\ndone           2026-02-21-fix-plan-state-machine.md\ndone           2026-02-21-generate-opencode-jsonc-design.md\ndone           2026-02-21-generate-opencode-jsonc.md\ndone           2026-02-21-global-skill-sync.md\ndone           2026-02-21-init-wizard-refinements.md\ndone           2026-02-21-osc11-terminal-bg-design.md\ndone           2026-02-21-osc11-terminal-bg.md\ncancelled      2026-02-21-plan-centric-sidebar.md\ndone           2026-02-21-plan-instance-grouping.md\ndone           2026-02-21-plan-lifecycle-sessions.md\ndone           2026-02-21-rose-pine-moon-design.md\ndone           2026-02-21-rose-pine-moon.md\ndone           2026-02-21-sidebar-nav-showhide.md\ndone           2026-02-21-sidebar-toggle-design.md\ndone           2026-02-21-sidebar-toggle.md\ndone           2026-02-21-topics-as-collision-domains-design.md\ndone           2026-02-21-topics-collision-domains.md\ndone           2026-02-22-1a-tree-renderer.md                     kas/1a-tree-renderer-plan\ndone           2026-02-22-1b-tree-navigation.md                   kas/1b-tree-navigation-plan\ndone           2026-02-22-1c-highlight-boost-list.md              plan/1c-highlight-boost-list\ndone           2026-02-22-2-tree-mode-wiring.md                   plan/2-tree-mode-wiring\ndone           2026-02-22-async-metadata-tick.md\ndone           2026-02-22-center-col-v-align.md                   plan/center-col-v-align\ncancelled      2026-02-22-center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet.md plan/center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet\ndone           2026-02-22-customize-superpowers.md                plan/customize-superpowers\ncancelled      2026-02-22-detect-permissions-needed.md            plan/detect-permissions-needed\ndone           2026-02-22-disable-cache-focused.md                plan/disable-cache-focused\ndone           2026-02-22-dupe-task-after-plan-change.md          plan/dupe-task-after-plan-change\ndone           2026-02-22-kq-check.md\ncancelled      2026-02-22-parallelize-superpowers.md              plan/parallelize-superpowers\ndone           2026-02-22-planner-exit-prompt.md\ndone           2026-02-22-remove-right-sidbar-right-to-focus-session.md plan/remove-right-sidbar-right-to-focus-session\ndone           2026-02-22-rename-to-kasmos.md                     plan/rename-to-kasmos\ndone           2026-02-22-shorten-cta.md                          plan/shorten-cta\ndone           2026-02-22-tab-focus-ring.md\ndone           2026-02-22-update-shortcut-hints.md                plan/update-shortcut-hints\ndone           2026-02-22-wave-orchestration.md                   plan/wave-orchestration\ndone           2026-02-23-plan-state-machine.md                   plan/plan-state-machine\ndone           2026-02-23-update-ascii-art.md                     plan/update-ascii-art\ncancelled      2026-02-24-add-episodic-memory.md                  plan/add-episodic-memory\ndone           2026-02-24-clickup-import.md                       plan/clickup-import\ndone           2026-02-24-live-preview-terminal.md                plan/live-preview-terminal\ncancelled      2026-02-24-orphan-session-recovery.md              plan/orphan-session-recovery\ncancelled      2026-02-24-parallel-fix-agents.md                  plan/parallel-fix-agents\ndone           2026-02-24-review-approval-gate.md                 plan/review-approval-gate\ndone           2026-02-24-sentry-integration.md                   plan/sentry-integration\ndone           2026-02-24-spring.md                               plan/spring\ndone           2026-02-24-wizard-tui-redesign.md                  plan/wizard-tui-redesign\ndone           2026-02-25-alt-v-not-working.md                    plan/alt-v-not-working\ndone           2026-02-25-contextual-status-bar.md                plan/contextual-status-bar\ndone           2026-02-25-enforce-cli-tools.md                    plan/enforce-cli-tools\ndone           2026-02-25-fix-planner-missing-waves.md            plan/fix-planner-missing-waves\ndone           2026-02-25-improve-cli-tools.md                    plan/improve-cli-tools\ndone           2026-02-25-new-plan-tab-cycle.md                   plan/new-plan-tab-cycle\ndone           2026-02-25-opencode-default-harness.md             plan/opencode-default-harness\ndone           2026-02-25-prompt-via-cli.md                       plan/prompt-via-cli\nready          2026-02-25-reintegrate-auto-accept.md              plan/reintegrate-auto-accept\ndone           2026-02-25-scroll-overflow.md                      plan/scroll-overflow\ndone           2026-02-25-show-plan-name-for-topics.md            plan/show-plan-name-for-topics\ndone           2026-02-25-simplify-plan-creation.md               plan/simplify-plan-creation\ndone           2026-02-25-solo-agent-mode.md                      plan/solo-agent-mode\ndone           2026-02-26-bubblezone-mouse.md                     plan/bubblezone\ndone           2026-02-26-cleanup-superpowers-cmds.md             plan/cleanup-superpowers-cmds\ndone           2026-02-26-details-tab.md                          plan/details-tab\ndone           2026-02-26-detect-allow-perms.md                   plan/detect-allow-perms\ndone           2026-02-26-enter-not-reachable.md                  plan/enter-not-reachable\ndone           2026-02-26-kas-verify-loop.md                      plan/kas-verify-loop\nplanning       2026-02-26-new-plan-cli-command.md                 plan/new-cli-command\ncancelled      2026-02-26-no-plan-to-implement-prompt.md          plan/no-plan-to-implement-prompt\ndone           2026-02-26-redesign-instance-list.md\ndone           2026-02-26-release-v1-0-0.md                       plan/release-v1-0-0\nready          2026-02-26-sentry-analysis.md                      plan/sentry-analysis\ndone           2026-02-26-spawn-agent.md                          plan/spawn-agent\ndone           2026-02-26-stepthrough-worktrees.md                plan/stepthrough-worktrees\ndone           2026-02-26-tmux-session-browser.md                 plan/tmux-session-browser\ncancelled      2026-02-26-validate-recent-merges.md               plan/validate-recent-merges\ndone           2026-02-26-yes-keybind.md                          plan/yes-keybind\ndone           2026-02-27-always-focus-sidebar.md                 plan/always-focus-sidebar\nready          2026-02-27-audit-log.md                            plan/audit-log\ncancelled      2026-02-27-build-custom-skills-replaced.md         plan/build-custom-skills\ndone           2026-02-27-canceled-plans-delay-removal.md         plan/canceled-plans-delay-removal\ndone           2026-02-27-chat-and-custodial-customizations.md    plan/chat-and-custodial-customizations\nready          2026-02-27-cleanup-tracked-state.md                plan/cleanup-tracked-state\nready          2026-02-27-create-a-debugging-skill-and-agent-type-should.md plan/create-a-debugging-skill-and-agent-type-should\ndone           2026-02-27-create-kasmos-custodial-agent.md        plan/create-kasmos-custodial-agent\ncancelled      2026-02-27-ctrl-ud-pagination.md                   plan/ctrl-ud-pagination\ndone           2026-02-27-disable-cla-for-prs.md                  plan/disable-cla-for-prs\ndone           2026-02-27-fix-wave-header-generation.md           plan/fix-wave-header-generation\nimplementing   2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md plan/implement-a-custom-kas-verify-tiered-review-process-for\ncancelled      2026-02-27-improve-planner-to-implementation.md    plan/improve-planner-to-implementation\ndone           2026-02-27-kasmos-custom-skills.md                 plan/kasmos-custom-skills\ndone           2026-02-27-kasmos-native-skills-design.md\ndone           2026-02-27-kasmos-native-skills.md\nready          2026-02-27-new-plan-issues.md                      plan/new-plan-issues\ndone           2026-02-27-plan-review.md                          plan/plan-review\ndone           2026-02-27-quit-confirmation-dialog.md             plan/quit-confirmation-dialog\ndone           2026-02-27-release-1-0-0-failures.md               plan/release-1-0-0-failures\ndone           2026-02-27-release-v1-1.md                         plan/release-v1-1\ndone           2026-02-27-reliable-planner-completion.md          plan/reliable-planner-completion\ndone           2026-02-27-rename-plan-menu.md                     plan/rename-plan-menu\nready          2026-02-27-review-use-kas-verify.md                plan/review-use-kas-verify\nready          2026-02-27-set-status-context-menu.md              plan/set-status-context-menu\ndone           2026-02-27-simplify-new-plan.md                    plan/simplify-new-plan\ndone           2026-02-27-tmux-session-summary.md                 plan/tmux-session-summary\n",
              "exit": 0,
              "description": "List all kasmos plans",
              "truncated": false
            },
            "time": {
              "start": 1772231182201,
              "end": 1772231182231
            }
          },
          "id": "prt_ca135c4770010MDvtMqLWbQvfi",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135b93a001wxgQ534xq16Mya"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "cost": 0,
          "tokens": {
            "total": 35135,
            "input": 1,
            "output": 132,
            "reasoning": 0,
            "cache": {
              "read": 34807,
              "write": 195
            }
          },
          "id": "prt_ca135c797001M0kyPovwEnt7Hi",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135b93a001wxgQ534xq16Mya"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231182241,
          "completed": 1772231186879
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 41292,
          "input": 1,
          "output": 172,
          "reasoning": 0,
          "cache": {
            "read": 35002,
            "write": 6117
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca135c7a1001G315j3cXE9MJZo",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "id": "prt_ca135d298001M9E25J4Ru94jDA",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135c7a1001G315j3cXE9MJZo"
        },
        {
          "type": "text",
          "text": "Found both plans. Let me read them.",
          "time": {
            "start": 1772231185695,
            "end": 1772231185695
          },
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135c7a1001G315j3cXE9MJZo"
        },
        {
          "type": "tool",
          "callID": "toolu_01BtgUUFBL7UqSwC8JURu7Rc",
          "tool": "read",
          "state": {
            "status": "error",
            "input": {
              "filePath": "/home/kas/dev/kasmos/docs/plans/2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md"
            },
            "error": "Error: File not found: /home/kas/dev/kasmos/docs/plans/2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md",
            "time": {
              "start": 1772231186372,
              "end": 1772231186373
            }
          },
          "id": "prt_ca135d521001z0EO2z1Z5hpmeT",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135c7a1001G315j3cXE9MJZo"
        },
        {
          "type": "tool",
          "callID": "toolu_01JLSRosQnQefGoM7q47c1pX",
          "tool": "read",
          "state": {
            "status": "error",
            "input": {
              "filePath": "/home/kas/dev/kasmos/docs/plans/2026-02-27-review-use-kas-verify.md"
            },
            "error": "Error: File not found: /home/kas/dev/kasmos/docs/plans/2026-02-27-review-use-kas-verify.md",
            "time": {
              "start": 1772231186845,
              "end": 1772231186846
            }
          },
          "id": "prt_ca135d7c5001D4zgIzaXuYgqhG",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135c7a1001G315j3cXE9MJZo"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "cost": 0,
          "tokens": {
            "total": 41292,
            "input": 1,
            "output": 172,
            "reasoning": 0,
            "cache": {
              "read": 35002,
              "write": 6117
            }
          },
          "id": "prt_ca135d9b7001EiB27Ka7rE1Bxs",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135c7a1001G315j3cXE9MJZo"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231186880,
          "completed": 1772231191237
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 41607,
          "input": 1,
          "output": 167,
          "reasoning": 0,
          "cache": {
            "read": 41119,
            "write": 320
          }
        },
        "finish": "tool-calls",
        "id": "REDACTED",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "id": "prt_ca135e5120018gew9YCTN9tDfx",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "tool",
          "callID": "toolu_01EXAsGRE3EBGJz2oQGG2K4C",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "fd 'implement-a-custom' docs/plans/",
              "description": "Find implement-a-custom plan file"
            },
            "output": "",
            "title": "Find implement-a-custom plan file",
            "metadata": {
              "output": "",
              "exit": 0,
              "description": "Find implement-a-custom plan file",
              "truncated": false
            },
            "time": {
              "start": 1772231190701,
              "end": 1772231190705
            }
          },
          "id": "prt_ca135e512002aLNw38Kg3Hy3cc",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "fd 'review-use-kas-verify' docs/plans/",
              "description": "Find review-use-kas-verify plan file"
            },
            "output": "",
            "title": "Find review-use-kas-verify plan file",
            "metadata": {
              "output": "",
              "exit": 0,
              "description": "Find review-use-kas-verify plan file",
              "truncated": false
            },
            "time": {
              "start": 1772231191200,
              "end": 1772231191206
            }
          },
          "id": "prt_ca135e8ae0016KTfsUDkq8TGAK",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "e49ad4b0625909dc99189999433ac34d485ea39e",
          "cost": 0,
          "tokens": {
            "total": 41607,
            "input": 1,
            "output": 167,
            "reasoning": 0,
            "cache": {
              "read": 41119,
              "write": 320
            }
          },
          "id": "prt_ca135eabe0017httU8u9VrV7Uw",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231191238,
          "completed": 1772231195351
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 41791,
          "input": 1,
          "output": 107,
          "reasoning": 0,
          "cache": {
            "read": 41439,
            "write": 244
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca135eac6001uXW5zzrec1OgVj",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135eac6001uXW5zzrec1OgVj"
        },
        {
          "type": "text",
          "text": "The files aren't on disk in the current worktree. Let me check which branch/worktree they live on.",
          "time": {
            "start": 1772231194687,
            "end": 1772231194687
          },
          "id": "prt_ca135f561001vogvg3C4PY5Aya",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135eac6001uXW5zzrec1OgVj"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "git worktree list",
              "description": "List all git worktrees"
            },
            "output": "/home/kas/dev/kasmos                                                   c1d9af7 [main]\n/home/kas/dev/kasmos/.worktrees/plan-bubblezone                        d58d63c [plan/bubblezone]\n/home/kas/dev/kasmos/.worktrees/plan-chat-and-custodial-customizations a65d024 [plan/chat-and-custodial-customizations]\n/home/kas/dev/kasmos/.worktrees/plan-clickup-import                    51867ef [plan/clickup-import]\n/home/kas/dev/kasmos/.worktrees/plan-detect-allow-perms                994bf97 [plan/detect-allow-perms]\n/home/kas/dev/kasmos/.worktrees/plan-quit-confirmation-dialog          fb1b06d [plan/quit-confirmation-dialog]\n/home/kas/dev/kasmos/.worktrees/plan-redesign-instance-list            45bd84c [plan/redesign-instance-list]\n/home/kas/dev/kasmos/.worktrees/plan-reliable-planner-completion       711bb2b [plan/reliable-planner-completion]\n/home/kas/dev/kasmos/.worktrees/plan-stepthrough-worktrees             d170775 [plan/stepthrough-worktrees]\n",
            "title": "List all git worktrees",
            "metadata": {
              "output": "/home/kas/dev/kasmos                                                   c1d9af7 [main]\n/home/kas/dev/kasmos/.worktrees/plan-bubblezone                        d58d63c [plan/bubblezone]\n/home/kas/dev/kasmos/.worktrees/plan-chat-and-custodial-customizations a65d024 [plan/chat-and-custodial-customizations]\n/home/kas/dev/kasmos/.worktrees/plan-clickup-import                    51867ef [plan/clickup-import]\n/home/kas/dev/kasmos/.worktrees/plan-detect-allow-perms                994bf97 [plan/detect-allow-perms]\n/home/kas/dev/kasmos/.worktrees/plan-quit-confirmation-dialog          fb1b06d [plan/quit-confirmation-dialog]\n/home/kas/dev/kasmos/.worktrees/plan-redesign-instance-list            45bd84c [plan/redesign-instance-list]\n/home/kas/dev/kasmos/.worktrees/plan-reliable-planner-completion       711bb2b [plan/reliable-planner-completion]\n/home/kas/dev/kasmos/.worktrees/plan-stepthrough-worktrees             d170775 [plan/stepthrough-worktrees]\n",
              "exit": 0,
              "description": "List all git worktrees",
              "truncated": false
            },
            "time": {
              "start": 1772231195306,
              "end": 1772231195309
            }
          },
          "id": "prt_ca135f841001maBI5LPPncRztt",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135eac6001uXW5zzrec1OgVj"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "cost": 0,
          "tokens": {
            "total": 41791,
            "input": 1,
            "output": 107,
            "reasoning": 0,
            "cache": {
              "read": 41439,
              "write": 244
            }
          },
          "id": "prt_ca135facf001dJHQi0Rj7cMQHN",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135eac6001uXW5zzrec1OgVj"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231195352,
          "completed": 1772231200198
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 42377,
          "input": 1,
          "output": 248,
          "reasoning": 0,
          "cache": {
            "read": 41683,
            "write": 445
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca135fad8001Uw2MgjWP7Z1LM6",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "id": "prt_ca13604b9001wZ92JL1AKooTux",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135fad8001Uw2MgjWP7Z1LM6"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "git show plan/implement-a-custom-kas-verify-tiered-review-process-for:docs/plans/2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md 2>/dev/null || echo \"NOT FOUND on branch\"",
              "description": "Read plan from its branch"
            },
            "output": "NOT FOUND on branch\n",
            "title": "Read plan from its branch",
            "metadata": {
              "output": "NOT FOUND on branch\n",
              "exit": 0,
              "description": "Read plan from its branch",
              "truncated": false
            },
            "time": {
              "start": 1772231199326,
              "end": 1772231199329
            }
          },
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135fad8001Uw2MgjWP7Z1LM6"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "git show plan/review-use-kas-verify:docs/plans/2026-02-27-review-use-kas-verify.md 2>/dev/null || echo \"NOT FOUND on branch\"",
              "description": "Read review plan from its branch"
            },
            "output": "NOT FOUND on branch\n",
            "title": "Read review plan from its branch",
            "metadata": {
              "output": "NOT FOUND on branch\n",
              "exit": 0,
              "description": "Read review plan from its branch",
              "truncated": false
            },
            "time": {
              "start": 1772231200166,
              "end": 1772231200169
            }
          },
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135fad8001Uw2MgjWP7Z1LM6"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "cost": 0,
          "tokens": {
            "total": 42377,
            "input": 1,
            "output": 248,
            "reasoning": 0,
            "cache": {
              "read": 41683,
              "write": 445
            }
          },
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca135fad8001Uw2MgjWP7Z1LM6"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231200200,
          "completed": 1772231204358
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 42643,
          "input": 1,
          "output": 189,
          "reasoning": 0,
          "cache": {
            "read": 42128,
            "write": 325
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca1360dc80016pNfh5AWK537Tr",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "id": "prt_ca13616fa001hmIQX3KMrjUkpR",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1360dc80016pNfh5AWK537Tr"
        },
        {
          "type": "tool",
          "callID": "toolu_01XV83FA9a7kgRGEFtW77VUV",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "git log --all --oneline -- 'docs/plans/*implement-a-custom*' | head -5",
              "description": "Find commits with implement-a-custom plan"
            },
            "output": "",
            "title": "Find commits with implement-a-custom plan",
            "metadata": {
              "output": "",
              "exit": 0,
              "description": "Find commits with implement-a-custom plan",
              "truncated": false
            },
            "time": {
              "start": 1772231203644,
              "end": 1772231203685
            }
          },
          "id": "prt_ca13616fa002cDRcduMuQNI8zP",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1360dc80016pNfh5AWK537Tr"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "git log --all --oneline -- 'docs/plans/*review-use-kas*' | head -5",
              "description": "Find commits with review-use-kas plan"
            },
            "output": "",
            "title": "Find commits with review-use-kas plan",
            "metadata": {
              "output": "",
              "exit": 0,
              "description": "Find commits with review-use-kas plan",
              "truncated": false
            },
            "time": {
              "start": 1772231204318,
              "end": 1772231204338
            }
          },
          "id": "prt_ca1361b65001lcobIJK79c5XQm",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1360dc80016pNfh5AWK537Tr"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "cost": 0,
          "tokens": {
            "total": 42643,
            "input": 1,
            "output": 189,
            "reasoning": 0,
            "cache": {
              "read": 42128,
              "write": 325
            }
          },
          "id": "prt_ca1361dfe001rI08f1AshQrj3O",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1360dc80016pNfh5AWK537Tr"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231204359,
          "completed": 1772231208404
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 42828,
          "input": 1,
          "output": 108,
          "reasoning": 0,
          "cache": {
            "read": 42453,
            "write": 266
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca1361e07001eBpgOYLxcTddMM",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "id": "prt_ca13627cb001HtYYL23E5tFd6o",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1361e07001eBpgOYLxcTddMM"
        },
        {
          "type": "text",
          "text": "These plans exist in plan-state.json but the actual markdown files haven't been written to disk yet. Let me check the state file to understand what's tracked.",
          "time": {
            "start": 1772231207905,
            "end": 1772231207905
          },
          "id": "prt_ca13627cb002w97d0TC33R690H",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1361e07001eBpgOYLxcTddMM"
        },
        {
          "type": "tool",
          "callID": "toolu_01PrBa4pjTpfzL99poEzabyR",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/kas/dev/kasmos/docs/plans/plan-state.json"
            },
            "output": "<path>/home/kas/dev/kasmos/docs/plans/plan-state.json</path>\n<type>file</type>\n<content>1: {\n2:   \"topics\": {\n3:     \"automation\": {\n4:       \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n5:     },\n6:     \"sidebar\": {\n7:       \"created_at\": \"2026-02-22T18:00:00Z\"\n8:     },\n9:     \"tools\": {\n10:       \"created_at\": \"2026-02-24T20:03:01Z\"\n11:     },\n12:     \"ui\": {\n13:       \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n14:     },\n15:     \"verify\": {\n16:       \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n17:     },\n18:     \"workflow\": {\n19:       \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n20:     }\n21:   },\n22:   \"plans\": {\n23:     \"2026-02-20-kq-init-design.md\": {\n24:       \"status\": \"done\",\n25:       \"created_at\": \"0001-01-01T00:00:00Z\",\n26:       \"implemented\": \"2026-02-20\"\n27:     },\n28:     \"2026-02-20-plan-orchestration-design.md\": {\n29:       \"status\": \"done\",\n30:       \"created_at\": \"0001-01-01T00:00:00Z\"\n31:     },\n32:     \"2026-02-20-plan-orchestration.md\": {\n33:       \"status\": \"done\",\n34:       \"created_at\": \"0001-01-01T00:00:00Z\",\n35:       \"implemented\": \"2026-02-20\"\n36:     },\n37:     \"2026-02-20-project-skills-distribution.md\": {\n38:       \"status\": \"done\",\n39:       \"created_at\": \"0001-01-01T00:00:00Z\",\n40:       \"implemented\": \"2026-02-20\"\n41:     },\n42:     \"2026-02-20-task-orchestration-design.md\": {\n43:       \"status\": \"done\",\n44:       \"created_at\": \"0001-01-01T00:00:00Z\",\n45:       \"implemented\": \"2026-02-20\"\n46:     },\n47:     \"2026-02-20-task-orchestration.md\": {\n48:       \"status\": \"done\",\n49:       \"created_at\": \"0001-01-01T00:00:00Z\",\n50:       \"implemented\": \"2026-02-20\"\n51:     },\n52:     \"2026-02-20-tool-discovery-design.md\": {\n53:       \"status\": \"done\",\n54:       \"created_at\": \"0001-01-01T00:00:00Z\",\n55:       \"implemented\": \"2026-02-20\"\n56:     },\n57:     \"2026-02-20-wizard-ux-design.md\": {\n58:       \"status\": \"done\",\n59:       \"created_at\": \"0001-01-01T00:00:00Z\"\n60:     },\n61:     \"2026-02-20-wizard-ux.md\": {\n62:       \"status\": \"done\",\n63:       \"created_at\": \"0001-01-01T00:00:00Z\",\n64:       \"implemented\": \"2026-02-21\"\n65:     },\n66:     \"2026-02-21-agent-customize-gate.md\": {\n67:       \"status\": \"done\",\n68:       \"created_at\": \"0001-01-01T00:00:00Z\",\n69:       \"implemented\": \"2026-02-21\"\n70:     },\n71:     \"2026-02-21-fix-naming-and-toast-wrap.md\": {\n72:       \"status\": \"done\",\n73:       \"created_at\": \"0001-01-01T00:00:00Z\",\n74:       \"implemented\": \"2026-02-21\"\n75:     },\n76:     \"2026-02-21-fix-plan-state-machine.md\": {\n77:       \"status\": \"done\",\n78:       \"created_at\": \"0001-01-01T00:00:00Z\",\n79:       \"implemented\": \"2026-02-21\"\n80:     },\n81:     \"2026-02-21-generate-opencode-jsonc-design.md\": {\n82:       \"status\": \"done\",\n83:       \"created_at\": \"0001-01-01T00:00:00Z\",\n84:       \"implemented\": \"2026-02-22\"\n85:     },\n86:     \"2026-02-21-generate-opencode-jsonc.md\": {\n87:       \"status\": \"done\",\n88:       \"created_at\": \"0001-01-01T00:00:00Z\",\n89:       \"implemented\": \"2026-02-22\"\n90:     },\n91:     \"2026-02-21-global-skill-sync.md\": {\n92:       \"status\": \"done\",\n93:       \"created_at\": \"0001-01-01T00:00:00Z\",\n94:       \"implemented\": \"2026-02-22\"\n95:     },\n96:     \"2026-02-21-init-wizard-refinements.md\": {\n97:       \"status\": \"done\",\n98:       \"created_at\": \"0001-01-01T00:00:00Z\",\n99:       \"implemented\": \"2026-02-21\"\n100:     },\n101:     \"2026-02-21-osc11-terminal-bg-design.md\": {\n102:       \"status\": \"done\",\n103:       \"created_at\": \"0001-01-01T00:00:00Z\",\n104:       \"implemented\": \"2026-02-21\"\n105:     },\n106:     \"2026-02-21-osc11-terminal-bg.md\": {\n107:       \"status\": \"done\",\n108:       \"created_at\": \"0001-01-01T00:00:00Z\",\n109:       \"implemented\": \"2026-02-21\"\n110:     },\n111:     \"2026-02-21-plan-centric-sidebar.md\": {\n112:       \"status\": \"cancelled\",\n113:       \"created_at\": \"0001-01-01T00:00:00Z\"\n114:     },\n115:     \"2026-02-21-plan-instance-grouping.md\": {\n116:       \"status\": \"done\",\n117:       \"created_at\": \"0001-01-01T00:00:00Z\"\n118:     },\n119:     \"2026-02-21-plan-lifecycle-sessions.md\": {\n120:       \"status\": \"done\",\n121:       \"created_at\": \"0001-01-01T00:00:00Z\"\n122:     },\n123:     \"2026-02-21-rose-pine-moon-design.md\": {\n124:       \"status\": \"done\",\n125:       \"created_at\": \"0001-01-01T00:00:00Z\",\n126:       \"implemented\": \"2026-02-21\"\n127:     },\n128:     \"2026-02-21-rose-pine-moon.md\": {\n129:       \"status\": \"done\",\n130:       \"created_at\": \"0001-01-01T00:00:00Z\",\n131:       \"implemented\": \"2026-02-21\"\n132:     },\n133:     \"2026-02-21-sidebar-nav-showhide.md\": {\n134:       \"status\": \"done\",\n135:       \"created_at\": \"0001-01-01T00:00:00Z\",\n136:       \"implemented\": \"2026-02-21\"\n137:     },\n138:     \"2026-02-21-sidebar-toggle-design.md\": {\n139:       \"status\": \"done\",\n140:       \"created_at\": \"0001-01-01T00:00:00Z\",\n141:       \"implemented\": \"2026-02-21\"\n142:     },\n143:     \"2026-02-21-sidebar-toggle.md\": {\n144:       \"status\": \"done\",\n145:       \"created_at\": \"0001-01-01T00:00:00Z\",\n146:       \"implemented\": \"2026-02-21\"\n147:     },\n148:     \"2026-02-21-topics-as-collision-domains-design.md\": {\n149:       \"status\": \"done\",\n150:       \"created_at\": \"0001-01-01T00:00:00Z\"\n151:     },\n152:     \"2026-02-21-topics-collision-domains.md\": {\n153:       \"status\": \"done\",\n154:       \"created_at\": \"0001-01-01T00:00:00Z\",\n155:       \"implemented\": \"2026-02-21\"\n156:     },\n157:     \"2026-02-22-1a-tree-renderer.md\": {\n158:       \"status\": \"done\",\n159:       \"description\": \"tree-mode rendering branch in Sidebar.String() with indentation, chevrons, and status glyphs\",\n160:       \"branch\": \"kas/1a-tree-renderer-plan\",\n161:       \"topic\": \"sidebar\",\n162:       \"created_at\": \"2026-02-22T18:00:00Z\",\n163:       \"implemented\": \"2026-02-22\"\n164:     },\n165:     \"2026-02-22-1b-tree-navigation.md\": {\n166:       \"status\": \"done\",\n167:       \"description\": \"Left/Right tree-traversal methods and Space/Enter/arrow keybindings for tree-mode sidebar\",\n168:       \"branch\": \"kas/1b-tree-navigation-plan\",\n169:       \"topic\": \"sidebar\",\n170:       \"created_at\": \"2026-02-22T18:00:00Z\",\n171:       \"implemented\": \"2026-02-22\"\n172:     },\n173:     \"2026-02-22-1c-highlight-boost-list.md\": {\n174:       \"status\": \"done\",\n175:       \"description\": \"highlight-boost instance list with partition sort and dimmed rendering for non-matching instances\",\n176:       \"branch\": \"plan/1c-highlight-boost-list\",\n177:       \"topic\": \"sidebar\",\n178:       \"created_at\": \"2026-02-22T18:00:00Z\",\n179:       \"implemented\": \"2026-02-22\"\n180:     },\n181:     \"2026-02-22-2-tree-mode-wiring.md\": {\n182:       \"status\": \"done\",\n183:       \"description\": \"wire tree renderer, navigation, and highlight-boost together; remove DisableTreeMode gate\",\n184:       \"branch\": \"plan/2-tree-mode-wiring\",\n185:       \"topic\": \"sidebar\",\n186:       \"created_at\": \"2026-02-22T18:00:00Z\",\n187:       \"implemented\": \"2026-02-22\"\n188:     },\n189:     \"2026-02-22-async-metadata-tick.md\": {\n190:       \"status\": \"done\",\n191:       \"created_at\": \"0001-01-01T00:00:00Z\",\n192:       \"implemented\": \"2026-02-22\"\n193:     },\n194:     \"2026-02-22-center-col-v-align.md\": {\n195:       \"status\": \"done\",\n196:       \"description\": \"center column is scrolled up slightly and also not bottom aligned\",\n197:       \"branch\": \"plan/center-col-v-align\",\n198:       \"created_at\": \"2026-02-22T08:33:42.034471509Z\"\n199:     },\n200:     \"2026-02-22-center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet.md\": {\n201:       \"status\": \"cancelled\",\n202:       \"branch\": \"plan/center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet\",\n203:       \"created_at\": \"2026-02-22T08:30:57.806756006Z\"\n204:     },\n205:     \"2026-02-22-customize-superpowers.md\": {\n206:       \"status\": \"done\",\n207:       \"description\": \"streamline interactions with superpowers and this app by personalizing the superpowers skills\",\n208:       \"branch\": \"plan/customize-superpowers\",\n209:       \"created_at\": \"2026-02-22T10:10:09.111289772Z\",\n210:       \"implemented\": \"2026-02-24\"\n211:     },\n212:     \"2026-02-22-detect-permissions-needed.md\": {\n213:       \"status\": \"cancelled\",\n214:       \"description\": \"indicate in list view if permissions are needed and switch to live capture (or increased cache r/w if possible) to button presses dont jump back and forth\",\n215:       \"branch\": \"plan/detect-permissions-needed\",\n216:       \"created_at\": \"2026-02-22T08:35:22.645408061Z\"\n217:     },\n218:     \"2026-02-22-disable-cache-focused.md\": {\n219:       \"status\": \"done\",\n220:       \"description\": \"disable cache reading and poll tmux pane directly when focused to improve interactive experience (it glitches a lot currently)\",\n221:       \"branch\": \"plan/disable-cache-focused\",\n222:       \"created_at\": \"2026-02-22T09:56:55.401392089Z\",\n223:       \"implemented\": \"2026-02-22\"\n224:     },\n225:     \"2026-02-22-dupe-task-after-plan-change.md\": {\n226:       \"status\": \"done\",\n227:       \"description\": \"i marked another plan done and suddenly i had 2 of another one that was running even though it hasn't switched to a review agent yet\",\n228:       \"branch\": \"plan/dupe-task-after-plan-change\",\n229:       \"created_at\": \"2026-02-22T10:00:27.703574166Z\"\n230:     },\n231:     \"2026-02-22-kq-check.md\": {\n232:       \"status\": \"done\",\n233:       \"description\": \"kq check command to audit skills sync health across all three layers (global, project, superpowers)\",\n234:       \"created_at\": \"2026-02-22T09:00:00Z\",\n235:       \"implemented\": \"2026-02-22\"\n236:     },\n237:     \"2026-02-22-parallelize-superpowers.md\": {\n238:       \"status\": \"cancelled\",\n239:       \"description\": \"extract any parallelization opportunities by controlling individual task fixes (use new agent for each even if sequential)\",\n240:       \"branch\": \"plan/parallelize-superpowers\",\n241:       \"created_at\": \"2026-02-22T10:04:55.567483368Z\"\n242:     },\n243:     \"2026-02-22-planner-exit-prompt.md\": {\n244:       \"status\": \"done\",\n245:       \"description\": \"show confirmation dialog when planner finishes asking whether to start implementation\",\n246:       \"created_at\": \"2026-02-22T13:00:00Z\",\n247:       \"implemented\": \"2026-02-23\"\n248:     },\n249:     \"2026-02-22-remove-right-sidbar-right-to-focus-session.md\": {\n250:       \"status\": \"done\",\n251:       \"branch\": \"plan/remove-right-sidbar-right-to-focus-session\",\n252:       \"created_at\": \"2026-02-22T12:15:27.104776176Z\",\n253:       \"implemented\": \"2026-02-22\"\n254:     },\n255:     \"2026-02-22-rename-to-kasmos.md\": {\n256:       \"status\": \"done\",\n257:       \"description\": \"switch name back to kasmos and overtake that repo (rename that one to kasmold first)\",\n258:       \"branch\": \"plan/rename-to-kasmos\",\n259:       \"created_at\": \"2026-02-22T09:53:24.333455818Z\"\n260:     },\n261:     \"2026-02-22-shorten-cta.md\": {\n262:       \"status\": \"done\",\n263:       \"description\": \"drop plan from first part of cta below ascii art\",\n264:       \"branch\": \"plan/shorten-cta\",\n265:       \"created_at\": \"2026-02-22T09:54:49.026733734Z\"\n266:     },\n267:     \"2026-02-22-tab-focus-ring.md\": {\n268:       \"status\": \"done\",\n269:       \"description\": \"implement 5-slot Tab focus ring: key defs, focusSlot state, key routing, tests, gradient, help\",\n270:       \"created_at\": \"2026-02-22T18:45:00Z\",\n271:       \"implemented\": \"2026-02-22\"\n272:     },\n273:     \"2026-02-22-update-shortcut-hints.md\": {\n274:       \"status\": \"done\",\n275:       \"description\": \"D kill becomes K kill. i focus agent to i interactive mode. space actions becomes space shortcuts. hide P create PR and c checkout, remove R switch repo, keep the rest.\",\n276:       \"branch\": \"plan/update-shortcut-hints\",\n277:       \"created_at\": \"2026-02-22T12:12:58.588910211Z\"\n278:     },\n279:     \"2026-02-22-wave-orchestration.md\": {\n280:       \"status\": \"done\",\n281:       \"description\": \"implement wave orchestration: plan parser, instance fields, orchestrator state machine, validation gate, prompt builder, wiring, wave badge\",\n282:       \"branch\": \"plan/wave-orchestration\",\n283:       \"created_at\": \"0001-01-01T00:00:00Z\",\n284:       \"implemented\": \"2026-02-22\"\n285:     },\n286:     \"2026-02-23-plan-state-machine.md\": {\n287:       \"status\": \"done\",\n288:       \"description\": \"centralized FSM for plan lifecycle with flock serialization and agent sentinel files\",\n289:       \"branch\": \"plan/plan-state-machine\",\n290:       \"created_at\": \"2026-02-23T14:00:00Z\"\n291:     },\n292:     \"2026-02-23-update-ascii-art.md\": {\n293:       \"status\": \"done\",\n294:       \"description\": \"replace KLIQUE ascii art banner with KASMOS using same ANSI Shadow font\",\n295:       \"branch\": \"plan/update-ascii-art\",\n296:       \"created_at\": \"2026-02-23T18:00:00Z\"\n297:     },\n298:     \"2026-02-24-add-episodic-memory.md\": {\n299:       \"status\": \"cancelled\",\n300:       \"description\": \"add episodic memory as a default skill when running init scaffolding command — shelved: none of the available memory plugins (episodic-memory, psychmem, hmem) are mature enough for dual-harness use yet\",\n301:       \"branch\": \"plan/add-episodic-memory\",\n302:       \"created_at\": \"2026-02-24T03:50:07.986559175Z\"\n303:     },\n304:     \"2026-02-24-clickup-import.md\": {\n305:       \"status\": \"done\",\n306:       \"description\": \"add a feature for importing clickup tasks as plans using the official MCP server. this feature is optional and is only available when the clickup mcp server is detected. have it be an option at the bottom the plans list above history (+ import from clickup) or something like that. once the task details are downloaded, run the plan through superpowers brainstorming using a planning agent automatically to determine if it's ready for implementation or needs to be fleshed out.\",\n307:       \"branch\": \"plan/clickup-import\",\n308:       \"topic\": \"tools\",\n309:       \"created_at\": \"2026-02-24T02:44:43.679630782Z\"\n310:     },\n311:     \"2026-02-24-live-preview-terminal.md\": {\n312:       \"status\": \"done\",\n313:       \"description\": \"replace capture-pane polling with live EmbeddedTerminal VT emulator in preview pane, unify with focus mode\",\n314:       \"branch\": \"plan/live-preview-terminal\",\n315:       \"created_at\": \"2026-02-24T18:00:00Z\",\n316:       \"implemented\": \"2026-02-24\"\n317:     },\n318:     \"2026-02-24-orphan-session-recovery.md\": {\n319:       \"status\": \"cancelled\",\n320:       \"description\": \"detect orphaned tmux sessions from plan agent crashes and let users reattach or kill them from the sidebar context menu\",\n321:       \"branch\": \"plan/orphan-session-recovery\",\n322:       \"created_at\": \"2026-02-24T04:07:00Z\"\n323:     },\n324:     \"2026-02-24-parallel-fix-agents.md\": {\n325:       \"status\": \"cancelled\",\n326:       \"description\": \"currently if the reviewer rejects an implementation, a single coder agent is spawned to address everything. instead, the reviewer agent should automatically propose what fixes need to be made that clearly states what (if anything) can be fixed in parallel. kasmos should then automatically follow those steps. the maximum parallel should follow the same rules\",\n327:       \"branch\": \"plan/parallel-fix-agents\",\n328:       \"topic\": \"automation\",\n329:       \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n330:     },\n331:     \"2026-02-24-review-approval-gate.md\": {\n332:       \"status\": \"done\",\n333:       \"description\": \"manual approval gate after automated review — two-popup flow for merge/PR before plan can be marked done\",\n334:       \"branch\": \"plan/review-approval-gate\",\n335:       \"topic\": \"automation\",\n336:       \"created_at\": \"2026-02-24T23:45:00Z\"\n337:     },\n338:     \"2026-02-24-sentry-integration.md\": {\n339:       \"status\": \"done\",\n340:       \"description\": \"add sentry to the project for better debugging experience\",\n341:       \"branch\": \"plan/sentry-integration\",\n342:       \"topic\": \"tools\",\n343:       \"created_at\": \"2026-02-24T20:03:01.389587403Z\"\n344:     },\n345:     \"2026-02-24-spring.md\": {\n346:       \"status\": \"done\",\n347:       \"description\": \"integrate harmonica to add a spring load-in animation for the kasmos logo on launch — scales from small to big — and vertically center both the logo and the call to action line below it\",\n348:       \"branch\": \"plan/spring\",\n349:       \"topic\": \"ui\",\n350:       \"created_at\": \"2026-02-24T23:30:00Z\"\n351:     },\n352:     \"2026-02-24-wizard-tui-redesign.md\": {\n353:       \"status\": \"done\",\n354:       \"description\": \"replace huh-form init wizard with full-screen bubbletea TUI using Rosé Pine Moon aesthetic\",\n355:       \"branch\": \"plan/wizard-tui-redesign\",\n356:       \"topic\": \"ui\",\n357:       \"created_at\": \"0001-01-01T00:00:00Z\",\n358:       \"implemented\": \"2026-02-25\"\n359:     },\n360:     \"2026-02-25-alt-v-not-working.md\": {\n361:       \"status\": \"done\",\n362:       \"description\": \"alt+v doesnt passthrough in interactive mode (i need for my custom variants toggle keybind)\",\n363:       \"branch\": \"plan/alt-v-not-working\",\n364:       \"topic\": \"ui\",\n365:       \"created_at\": \"2026-02-25T18:58:19.973770029Z\"\n366:     },\n367:     \"2026-02-25-contextual-status-bar.md\": {\n368:       \"status\": \"done\",\n369:       \"description\": \"top status bar showing contextual info (wave progress, repo name, branch) based on focused/selected item\",\n370:       \"branch\": \"plan/contextual-status-bar\",\n371:       \"topic\": \"ui\",\n372:       \"created_at\": \"2026-02-25T22:00:00Z\"\n373:     },\n374:     \"2026-02-25-enforce-cli-tools.md\": {\n375:       \"status\": \"done\",\n376:       \"description\": \"automate cli-tools enforcement hooks installation during kas init for claude and opencode harnesses\",\n377:       \"branch\": \"plan/enforce-cli-tools\",\n378:       \"topic\": \"automation\",\n379:       \"created_at\": \"0001-01-01T00:00:00Z\"\n380:     },\n381:     \"2026-02-25-fix-planner-missing-waves.md\": {\n382:       \"status\": \"done\",\n383:       \"description\": \"the planner agent should always use wave headers when launched via kasmos. a plan i just brainstormed had to go back to planner agent to add the headers\",\n384:       \"branch\": \"plan/fix-planner-missing-waves\",\n385:       \"topic\": \"workflow\",\n386:       \"created_at\": \"2026-02-25T18:40:28.678650334Z\"\n387:     },\n388:     \"2026-02-25-improve-cli-tools.md\": {\n389:       \"status\": \"done\",\n390:       \"description\": \"update cli-tools to be more strict and ensure rg is ALWAYS used over grep as well as other tools\",\n391:       \"branch\": \"plan/improve-cli-tools\",\n392:       \"topic\": \"tools\",\n393:       \"created_at\": \"2026-02-25T17:38:32.640854935Z\"\n394:     },\n395:     \"2026-02-25-new-plan-tab-cycle.md\": {\n396:       \"status\": \"done\",\n397:       \"description\": \"tab and shift tab should cycle through the 2 inputs not deselect once u reach end\",\n398:       \"branch\": \"plan/new-plan-tab-cycle\",\n399:       \"topic\": \"ui\",\n400:       \"created_at\": \"2026-02-25T20:41:20.135133593Z\"\n401:     },\n402:     \"2026-02-25-opencode-default-harness.md\": {\n403:       \"status\": \"done\",\n404:       \"description\": \"opencode should be the default harness for each agent type, not claude\",\n405:       \"branch\": \"plan/opencode-default-harness\",\n406:       \"topic\": \"workflow\",\n407:       \"created_at\": \"2026-02-26T02:24:21.577814842Z\"\n408:     },\n409:     \"2026-02-25-prompt-via-cli.md\": {\n410:       \"status\": \"done\",\n411:       \"description\": \"instead of waiting for the session to become ready to send the prompt text, supply it via --prompt (opencode) or -p (claude) when launching the agent directly\",\n412:       \"branch\": \"plan/prompt-via-cli\",\n413:       \"topic\": \"automation\",\n414:       \"created_at\": \"2026-02-25T17:31:48.642511235Z\"\n415:     },\n416:     \"2026-02-25-reintegrate-auto-accept.md\": {\n417:       \"status\": \"ready\",\n418:       \"branch\": \"plan/reintegrate-auto-accept\",\n419:       \"topic\": \"automation\",\n420:       \"created_at\": \"2026-02-25T19:53:16.45886024Z\"\n421:     },\n422:     \"2026-02-25-scroll-overflow.md\": {\n423:       \"status\": \"done\",\n424:       \"description\": \"manual scroll offset for list and sidebar overflow\",\n425:       \"branch\": \"plan/scroll-overflow\",\n426:       \"topic\": \"ui\",\n427:       \"created_at\": \"2026-02-25T00:00:00Z\"\n428:     },\n429:     \"2026-02-25-show-plan-name-for-topics.md\": {\n430:       \"status\": \"done\",\n431:       \"description\": \"show the plan name you just entered when selecting a topic name because i have a bad memory and forget what plan i was adding\",\n432:       \"branch\": \"plan/show-plan-name-for-topics\",\n433:       \"topic\": \"workflow\",\n434:       \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n435:     },\n436:     \"2026-02-25-simplify-plan-creation.md\": {\n437:       \"status\": \"done\",\n438:       \"description\": \"add name and description for new plans to a single form popup. focuses on name by default - user can use tab navigation to the description input or use arrow down/up to navigate. hitting enter from either input creates the plan since description is optional\",\n439:       \"branch\": \"plan/simplify-plan-creation\",\n440:       \"topic\": \"workflow\",\n441:       \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n442:     },\n443:     \"2026-02-25-solo-agent-mode.md\": {\n444:       \"status\": \"done\",\n445:       \"description\": \"start solo agent context menu action — single coder in worktree with minimal prompt, no wave/review lifecycle\",\n446:       \"branch\": \"plan/solo-agent-mode\",\n447:       \"topic\": \"automation\",\n448:       \"created_at\": \"2026-02-25T22:00:00Z\"\n449:     },\n450:     \"2026-02-26-bubblezone-mouse.md\": {\n451:       \"status\": \"done\",\n452:       \"description\": \"bubblezone zone-per-element mouse hit detection, focus-mode escape via click, SGR mouse forwarding to PTY\",\n453:       \"branch\": \"plan/bubblezone\",\n454:       \"topic\": \"ui\",\n455:       \"created_at\": \"2026-02-22T08:28:43.336094301Z\"\n456:     },\n457:     \"2026-02-26-cleanup-superpowers-cmds.md\": {\n458:       \"status\": \"done\",\n459:       \"description\": \"it seems some superpowers plans keep pushing claude to use grep (specifically writing-plans just now). these should be overriden to reference their modern counterparts\",\n460:       \"branch\": \"plan/cleanup-superpowers-cmds\",\n461:       \"topic\": \"tools\",\n462:       \"created_at\": \"2026-02-26T03:50:14.851365189Z\"\n463:     },\n464:     \"2026-02-26-details-tab.md\": {\n465:       \"status\": \"done\",\n466:       \"description\": \"replace lazygit git tab with a read-only info tab\",\n467:       \"branch\": \"plan/details-tab\",\n468:       \"topic\": \"ui\",\n469:       \"created_at\": \"2026-02-26T02:26:10.767895938Z\"\n470:     },\n471:     \"2026-02-26-detect-allow-perms.md\": {\n472:       \"status\": \"done\",\n473:       \"description\": \"detect when opencode is asking for perms to Allow once, Allow always, Reject. show a popup dialog allowing the user to pick then propagate their change to the session. if they choose approve always (which should be default selection), you'll send right arrow -\\u003e enter -\\u003e enter. approve once is a single enter. reject is right arrow -\\u003e right arrow -\\u003e enter\",\n474:       \"branch\": \"plan/detect-allow-perms\",\n475:       \"topic\": \"automation\",\n476:       \"created_at\": \"2026-02-26T20:16:31.684660209Z\"\n477:     },\n478:     \"2026-02-26-enter-not-reachable.md\": {\n479:       \"status\": \"done\",\n480:       \"description\": \"can't reach the enter button via keyboard navigation in info tab. also move info tab to first position, agent second diff third\",\n481:       \"branch\": \"plan/enter-not-reachable\",\n482:       \"topic\": \"ui\",\n483:       \"created_at\": \"2026-02-26T21:49:47.811876321Z\"\n484:     },\n485:     \"2026-02-26-kas-verify-loop.md\": {\n486:       \"status\": \"done\",\n487:       \"description\": \"update reviewer instructions to loop reviewer \\u003c-\\u003e fixer until all tiers pass and ALL issues have been addressed, no matter the severity\",\n488:       \"branch\": \"plan/kas-verify-loop\",\n489:       \"topic\": \"automation\",\n490:       \"created_at\": \"2026-02-26T20:15:09.857895365Z\"\n491:     },\n492:     \"2026-02-26-new-plan-cli-command.md\": {\n493:       \"status\": \"planning\",\n494:       \"description\": \"kas new [title] [description] # new cli command (also runnable via kas n alias) to quickly create a new plan (no topic) with optional description via cli without having to launch tui\",\n495:       \"branch\": \"plan/new-cli-command\",\n496:       \"topic\": \"tools\",\n497:       \"created_at\": \"2026-02-26T05:07:21.925625953Z\"\n498:     },\n499:     \"2026-02-26-no-plan-to-implement-prompt.md\": {\n500:       \"status\": \"cancelled\",\n501:       \"description\": \"you have to manually kill the planner agent before kasmos shows you the dialog to start implementation\",\n502:       \"branch\": \"plan/no-plan-to-implement-prompt\",\n503:       \"topic\": \"automation\",\n504:       \"created_at\": \"2026-02-26T23:00:00Z\"\n505:     },\n506:     \"2026-02-26-redesign-instance-list.md\": {\n507:       \"status\": \"done\",\n508:       \"created_at\": \"0001-01-01T00:00:00Z\"\n509:     },\n510:     \"2026-02-26-release-v1-0-0.md\": {\n511:       \"status\": \"done\",\n512:       \"description\": \"create github release, update versioning in project and deploy to homebrew\",\n513:       \"branch\": \"plan/release-v1-0-0\",\n514:       \"topic\": \"workflow\",\n515:       \"created_at\": \"2026-02-25T20:40:48.870776932Z\"\n516:     },\n517:     \"2026-02-26-sentry-analysis.md\": {\n518:       \"status\": \"ready\",\n519:       \"description\": \"have an agent go through sentry backlog to pick out some areas for improvement/patching\",\n520:       \"branch\": \"plan/sentry-analysis\",\n521:       \"topic\": \"verify\",\n522:       \"created_at\": \"2026-02-26T05:14:59.843580163Z\"\n523:     },\n524:     \"2026-02-26-spawn-agent.md\": {\n525:       \"status\": \"done\",\n526:       \"description\": \"restore 's' keybind for spawning an agent for manual work. make sure it appears clean in the instance list but doesn't require being attached to a plan and sits outside the normal lifecycle (but can still be killed and managed the same)\",\n527:       \"branch\": \"plan/spawn-agent\",\n528:       \"topic\": \"workflow\",\n529:       \"created_at\": \"2026-02-26T05:20:45.243395804Z\"\n530:     },\n531:     \"2026-02-26-stepthrough-worktrees.md\": {\n532:       \"status\": \"done\",\n533:       \"description\": \"stepthrough git worktree and branch usage in both standard and solo agent workflows. ensure it's being used properly, there are no gaps or incorrect commands, and we're cleanly managing history between parallel plan implementations.\",\n534:       \"branch\": \"plan/stepthrough-worktrees\",\n535:       \"topic\": \"verify\",\n536:       \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n537:     },\n538:     \"2026-02-26-tmux-session-browser.md\": {\n539:       \"status\": \"done\",\n540:       \"description\": \"TUI overlay to browse, kill, and adopt orphaned tmux sessions\",\n541:       \"branch\": \"plan/tmux-session-browser\",\n542:       \"topic\": \"ui\",\n543:       \"created_at\": \"2026-02-26T17:30:00Z\"\n544:     },\n545:     \"2026-02-26-validate-recent-merges.md\": {\n546:       \"status\": \"cancelled\",\n547:       \"description\": \"some work looks like it might've been lost or reverted, review the last few plans merged to determine what's been merged, what's been lost, and what can be recovered\",\n548:       \"branch\": \"plan/validate-recent-merges\",\n549:       \"topic\": \"verify\",\n550:       \"created_at\": \"2026-02-26T05:18:22.559632982Z\"\n551:     },\n552:     \"2026-02-26-yes-keybind.md\": {\n553:       \"status\": \"done\",\n554:       \"description\": \"add a y keybind to the instance list that sends yes to a session waiting for an answer to a yes/no question\",\n555:       \"branch\": \"plan/yes-keybind\",\n556:       \"topic\": \"automation\",\n557:       \"created_at\": \"2026-02-26T16:42:11.713212759Z\"\n558:     },\n559:     \"2026-02-27-always-focus-sidebar.md\": {\n560:       \"status\": \"done\",\n561:       \"description\": \"the purple focus highlight and keyboard should always cling to the sidebar outside of interactive or attach mode. hitting tab required me to navigate left to get back to sidebar when it should just kept my selection and shown the agent tab instead\",\n562:       \"branch\": \"plan/always-focus-sidebar\",\n563:       \"topic\": \"ui\",\n564:       \"created_at\": \"2026-02-27T16:54:32.618130648Z\"\n565:     },\n566:     \"2026-02-27-audit-log.md\": {\n567:       \"status\": \"ready\",\n568:       \"description\": \"log all actions (new 'coder' agent spawned, finished successfully/failed, etc etc). useful for debugging but also browsing history and tracking who did what and why automatically\",\n569:       \"branch\": \"plan/audit-log\",\n570:       \"topic\": \"automation\",\n571:       \"created_at\": \"2026-02-27T07:36:50.243680437Z\"\n572:     },\n573:     \"2026-02-27-build-custom-skills-replaced.md\": {\n574:       \"status\": \"cancelled\",\n575:       \"description\": \"build custom skills\\n\\ngenerate kasmos-specific skills that integrate the existing workflow and superpowers into a self contained, specific skillset\",\n576:       \"branch\": \"plan/build-custom-skills\",\n577:       \"topic\": \"workflow\",\n578:       \"created_at\": \"2026-02-27T18:13:27.704398153Z\"\n579:     },\n580:     \"2026-02-27-canceled-plans-delay-removal.md\": {\n581:       \"status\": \"done\",\n582:       \"description\": \"canceled plans delay removal\\n\\nafter cancelling a plan using the sidebar context menu, it remains in the list for 1-2 sec after closing the menu instead of hiding immediately even if still loading the full side effects in the background\",\n583:       \"branch\": \"plan/canceled-plans-delay-removal\",\n584:       \"topic\": \"ui\",\n585:       \"created_at\": \"2026-02-27T18:36:48.99087766Z\"\n586:     },\n587:     \"2026-02-27-chat-and-custodial-customizations.md\": {\n588:       \"status\": \"done\",\n589:       \"description\": \"rename custodial to custodian and make chat/custodian agent types configurable in the setup wizard\",\n590:       \"branch\": \"plan/chat-and-custodial-customizations\",\n591:       \"topic\": \"workflow\",\n592:       \"created_at\": \"2026-02-27T22:00:00Z\"\n593:     },\n594:     \"2026-02-27-cleanup-tracked-state.md\": {\n595:       \"status\": \"ready\",\n596:       \"description\": \"cleanup tracked state\\n\\nreevaluate what files should be tracked in git. anything covered by scaffolding should probably be excluded and I'm sure there's others that we shouldn't be tracking but are (.codex, .opencode, .claude, etc). evaluate all tracked files and if they reflect best practices for the libraries/frameworks in use\",\n597:       \"branch\": \"plan/cleanup-tracked-state\",\n598:       \"topic\": \"verify\",\n599:       \"created_at\": \"2026-02-27T17:57:15.490968411Z\"\n600:     },\n601:     \"2026-02-27-create-a-debugging-skill-and-agent-type-should.md\": {\n602:       \"status\": \"ready\",\n603:       \"description\": \"create a debugging skill and agent type (should probably replace custodian) that's equipped to handle custodian's work but more importantly, is specialized in debugging and investigating issues, tieing up loose ends and targeted verification\",\n604:       \"branch\": \"plan/create-a-debugging-skill-and-agent-type-should\",\n605:       \"topic\": \"tools\",\n606:       \"created_at\": \"2026-02-27T22:07:33.623625523Z\"\n607:     },\n608:     \"2026-02-27-create-kasmos-custodial-agent.md\": {\n609:       \"status\": \"done\",\n610:       \"description\": \"create custodial agent designed to efficiently and effectively handle touchup tasks and quick fixes geared around issues or ux gaps in the kasmos workflow. things like resetting a plan's status/overriding it, finishing the development branch by merging to main or creating a pr, etc.\",\n611:       \"branch\": \"plan/create-kasmos-custodial-agent\",\n612:       \"topic\": \"workflow\",\n613:       \"created_at\": \"2026-02-27T17:47:32.295296289Z\"\n614:     },\n615:     \"2026-02-27-ctrl-ud-pagination.md\": {\n616:       \"status\": \"cancelled\",\n617:       \"description\": \"configure ctrl+u for paginate up in agent session, d for down. it's not currently working\",\n618:       \"branch\": \"plan/ctrl-ud-pagination\",\n619:       \"topic\": \"workflow\",\n620:       \"created_at\": \"2026-02-27T07:25:38.786253804Z\"\n621:     },\n622:     \"2026-02-27-disable-cla-for-prs.md\": {\n623:       \"status\": \"done\",\n624:       \"branch\": \"plan/disable-cla-for-prs\",\n625:       \"topic\": \"workflow\",\n626:       \"created_at\": \"2026-02-27T16:50:23.219250196Z\",\n627:       \"implemented\": \"2026-02-27\"\n628:     },\n629:     \"2026-02-27-fix-wave-header-generation.md\": {\n630:       \"status\": \"done\",\n631:       \"branch\": \"plan/fix-wave-header-generation\",\n632:       \"topic\": \"automation\",\n633:       \"created_at\": \"2026-02-27T16:16:33.640848697Z\",\n634:       \"implemented\": \"2026-02-27\"\n635:     },\n636:     \"2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md\": {\n637:       \"status\": \"implementing\",\n638:       \"description\": \"implement a custom /kas.verify tiered review process for PRs (evaluate using codex code review or some other github integration to use specific skills/review process we need to research it). this should trigger for new prs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?)\",\n639:       \"branch\": \"plan/implement-a-custom-kas-verify-tiered-review-process-for\",\n640:       \"topic\": \"verify\",\n641:       \"created_at\": \"2026-02-27T21:57:06.660976295Z\"\n642:     },\n643:     \"2026-02-27-improve-planner-to-implementation.md\": {\n644:       \"status\": \"cancelled\",\n645:       \"description\": \"improve planner to implementation\\n\\nthe automated workflow transition doesn't work until you manually kill the agent. retest with new skills and evaluate if it needs ot be fixed. the same goes for the final stages of the lifecycle, the final review and merge/pr finalization is clunky and difficult to manuver\",\n646:       \"branch\": \"plan/improve-planner-to-implementation\",\n647:       \"topic\": \"workflow\",\n648:       \"created_at\": \"2026-02-27T18:35:51.890862288Z\"\n649:     },\n650:     \"2026-02-27-kasmos-custom-skills.md\": {\n651:       \"status\": \"done\",\n652:       \"description\": \"audit cli-tools references, add rg deep reference, write 5 kasmos-native skills (lifecycle/planner/coder/reviewer/custodial), update agent templates and prompt builders, remove old superpowers-derived scaffolded skills\",\n653:       \"branch\": \"plan/kasmos-custom-skills\",\n654:       \"topic\": \"workflow\",\n655:       \"created_at\": \"2026-02-27T00:00:00Z\"\n656:     },\n657:     \"2026-02-27-kasmos-native-skills-design.md\": {\n658:       \"status\": \"done\",\n659:       \"description\": \"design doc for kasmos-native skills system\",\n660:       \"created_at\": \"2026-02-27T00:00:00Z\"\n661:     },\n662:     \"2026-02-27-kasmos-native-skills.md\": {\n663:       \"status\": \"done\",\n664:       \"description\": \"replace superpowers skills with 5 kasmos-native skills\",\n665:       \"topic\": \"workflow\",\n666:       \"created_at\": \"2026-02-27T00:00:00Z\"\n667:     },\n668:     \"2026-02-27-new-plan-issues.md\": {\n669:       \"status\": \"ready\",\n670:       \"description\": \"new-plan-issues\\n\\ndisappears if confirmation dialog shows while making a new plan, losing all contents. also, the box gets bigger when the agent pane either loads a session or switches (due to exit, etc)\",\n671:       \"branch\": \"plan/new-plan-issues\",\n672:       \"topic\": \"ui\",\n673:       \"created_at\": \"2026-02-27T21:49:21.082140797Z\"\n674:     },\n675:     \"2026-02-27-plan-review.md\": {\n676:       \"status\": \"done\",\n677:       \"description\": \"plan-review\\n\\nimplement automatic plan reviews and fixing before writing the plan and proceeding to implementation (either manual or automatic, basically last step in planning is to review the plan)\",\n678:       \"branch\": \"plan/plan-review\",\n679:       \"topic\": \"automation\",\n680:       \"created_at\": \"2026-02-27T20:19:27.808935081Z\"\n681:     },\n682:     \"2026-02-27-quit-confirmation-dialog.md\": {\n683:       \"status\": \"done\",\n684:       \"description\": \"quit confirmation dialog\\n\\nshow a quit confirmation dialog when user presses q\",\n685:       \"branch\": \"plan/quit-confirmation-dialog\",\n686:       \"topic\": \"ui\",\n687:       \"created_at\": \"2026-02-27T18:49:35.747504695Z\"\n688:     },\n689:     \"2026-02-27-release-1-0-0-failures.md\": {\n690:       \"status\": \"done\",\n691:       \"description\": \"check github to see the failure reasons and fix then redeploy v1.0.0\",\n692:       \"branch\": \"plan/release-1-0-0-failures\",\n693:       \"topic\": \"verify\",\n694:       \"created_at\": \"2026-02-27T06:41:42.078871243Z\"\n695:     },\n696:     \"2026-02-27-release-v1-1.md\": {\n697:       \"status\": \"done\",\n698:       \"description\": \"release v1.1\\n\\ncreate new tag to trigger build for v1.1.0 encorporating changes since last night\",\n699:       \"branch\": \"plan/release-v1-1\",\n700:       \"topic\": \"workflow\",\n701:       \"created_at\": \"2026-02-27T19:07:35.357546336Z\"\n702:     },\n703:     \"2026-02-27-reliable-planner-completion.md\": {\n704:       \"status\": \"done\",\n705:       \"description\": \"make planner explicitly confirm with user before signaling completion, instead of relying on agent remembering to touch sentinel after Q\\u0026A\",\n706:       \"branch\": \"plan/reliable-planner-completion\",\n707:       \"topic\": \"workflow\",\n708:       \"created_at\": \"2026-02-27T19:15:00Z\"\n709:     },\n710:     \"2026-02-27-rename-plan-menu.md\": {\n711:       \"status\": \"done\",\n712:       \"description\": \"rename plan menu\\n\\nadd an option to rename plans in their context menu\",\n713:       \"branch\": \"plan/rename-plan-menu\",\n714:       \"topic\": \"ui\",\n715:       \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n716:     },\n717:     \"2026-02-27-review-use-kas-verify.md\": {\n718:       \"status\": \"ready\",\n719:       \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n720:       \"branch\": \"plan/review-use-kas-verify\",\n721:       \"topic\": \"automation\",\n722:       \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n723:     },\n724:     \"2026-02-27-set-status-context-menu.md\": {\n725:       \"status\": \"ready\",\n726:       \"description\": \"set status context menu\\n\\ncurrently there is no way to update a plan status (eg. to fix if incorrect) without triggering automation side effects. i want to be able to correct a wrong plan that got out of sync without automation picking it up\",\n727:       \"branch\": \"plan/set-status-context-menu\",\n728:       \"topic\": \"ui\",\n729:       \"created_at\": \"2026-02-27T21:10:02.331577094Z\"\n730:     },\n731:     \"2026-02-27-simplify-new-plan.md\": {\n732:       \"status\": \"done\",\n733:       \"description\": \"simplify creation of a new plan by only using one multiline input field labeled something like \\\"describe what you want to work on...\\\" as a label then use either a headless claude code call to sonnet-4-6 to derive a title or do it without ai if you can easily. descriptionw will be what the user entered\",\n734:       \"branch\": \"plan/simplify-new-plan\",\n735:       \"topic\": \"workflow\",\n736:       \"created_at\": \"2026-02-27T15:52:02.820017802Z\"\n737:     },\n738:     \"2026-02-27-tmux-session-summary.md\": {\n739:       \"status\": \"done\",\n740:       \"description\": \"show a summary of active tmux sessions that would be shown if you did shift t keybind to browse the sessions, in addition to ones that are shown that aren't in there that are already, like, adopted or were the born with the same plan\",\n741:       \"branch\": \"plan/tmux-session-summary\",\n742:       \"topic\": \"ui\",\n743:       \"created_at\": \"2026-02-27T07:41:00.300934469Z\"\n744:     }\n745:   }\n746: }\n\n(End of file - total 746 lines)\n</content>",
            "title": "docs/plans/plan-state.json",
            "metadata": {
              "preview": "{\n  \"topics\": {\n    \"automation\": {\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"sidebar\": {\n      \"created_at\": \"2026-02-22T18:00:00Z\"\n    },\n    \"tools\": {\n      \"created_at\": \"2026-02-24T20:03:01Z\"\n    },\n    \"ui\": {\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"verify\": {\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"workflow\": {\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    }",
              "truncated": false,
              "loaded": []
            },
            "time": {
              "start": 1772231208362,
              "end": 1772231208367
            }
          },
          "id": "prt_ca1362be1001Ii55dhDw70IFQD",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1361e07001eBpgOYLxcTddMM"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "175e68ee075ed812a458c8c8392050754dad89dd",
          "cost": 0,
          "tokens": {
            "total": 42828,
            "input": 1,
            "output": 108,
            "reasoning": 0,
            "cache": {
              "read": 42453,
              "write": 266
            }
          },
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1361e07001eBpgOYLxcTddMM"
        },
        {
          "type": "patch",
          "hash": "fc152879c530ca85d620c748b31ef4d5d3481a6c",
          "files": [
            "/home/kas/dev/kasmos/ui/nav_panel_test.go"
          ],
          "id": "prt_ca1362dce001u87mq5YqrTL23a",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1361e07001eBpgOYLxcTddMM"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231208406,
          "completed": 1772231218221
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 56902,
          "input": 1,
          "output": 537,
          "reasoning": 0,
          "cache": {
            "read": 42719,
            "write": 13645
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca1362dd6001AVVSqQGnHRVdN9",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "175e68ee075ed812a458c8c8392050754dad89dd",
          "id": "prt_ca13637f8001NOFlf3SlzjMLdT",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1362dd6001AVVSqQGnHRVdN9"
        },
        {
          "type": "text",
          "text": "Now I have the full picture. The \"implement-a-custom\" plan is in `implementing` status and has no markdown file on disk — it only exists as a state entry. The \"review-use-kas-verify\" plan is `ready` with a branch. Let me merge the description content and cancel the implement plan.\n\n**Plan:** Merge the description from `implement-a-custom-kas-verify-tiered-review-process-for` into `review-use-kas-verify`, then cancel the implement plan and clean up its branch.",
          "time": {
            "start": 1772231214618,
            "end": 1772231214618
          },
          "id": "prt_ca13637f8002UtbLx1qziGjsct",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1362dd6001AVVSqQGnHRVdN9"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "edit",
          "state": {
            "status": "error",
            "input": {
              "filePath": "/home/kas/dev/kasmos/docs/plans/plan-state.json",
              "oldString": "    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    }",
              "newString": "    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now. evaluate using codex code review or some other github integration to use specific skills/review process (needs research). this should trigger for new PRs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?).\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    }"
            },
            "error": "Error: File /home/kas/dev/kasmos/docs/plans/plan-state.json has been modified since it was last read.\nLast modification: 2026-02-27T22:26:55.040Z\nLast read: 2026-02-27T22:26:48.366Z\n\nPlease read the file again before modifying it.",
            "time": {
              "start": 1772231218195,
              "end": 1772231218196
            }
          },
          "id": "prt_ca13646200016ercReTHf5MEij",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1362dd6001AVVSqQGnHRVdN9"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "8d41ae825872787ed751d13d86e8c9ae3bab937c",
          "cost": 0,
          "tokens": {
            "total": 56902,
            "input": 1,
            "output": 537,
            "reasoning": 0,
            "cache": {
              "read": 42719,
              "write": 13645
            }
          },
          "id": "prt_ca1365424001i4TRexTFQffvgM",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1362dd6001AVVSqQGnHRVdN9"
        },
        {
          "type": "patch",
          "hash": "175e68ee075ed812a458c8c8392050754dad89dd",
          "files": [
            "/home/kas/dev/kasmos/docs/plans/plan-state.json"
          ],
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1362dd6001AVVSqQGnHRVdN9"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231218223,
          "completed": 1772231221878
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 57110,
          "input": 1,
          "output": 107,
          "reasoning": 0,
          "cache": {
            "read": 56364,
            "write": 638
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca136542f001v6GSvTPYS2p2Kj",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "8d41ae825872787ed751d13d86e8c9ae3bab937c",
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136542f001v6GSvTPYS2p2Kj"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "read",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/kas/dev/kasmos/docs/plans/plan-state.json",
              "offset": 715,
              "limit": 35
            },
            "output": "<path>/home/kas/dev/kasmos/docs/plans/plan-state.json</path>\n<type>file</type>\n<content>715:       \"created_at\": \"2026-02-27T19:15:00Z\"\n716:     },\n717:     \"2026-02-27-rename-plan-menu.md\": {\n718:       \"status\": \"done\",\n719:       \"description\": \"rename plan menu\\n\\nadd an option to rename plans in their context menu\",\n720:       \"branch\": \"plan/rename-plan-menu\",\n721:       \"topic\": \"ui\",\n722:       \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n723:     },\n724:     \"2026-02-27-review-use-kas-verify.md\": {\n725:       \"status\": \"ready\",\n726:       \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n727:       \"branch\": \"plan/review-use-kas-verify\",\n728:       \"topic\": \"automation\",\n729:       \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n730:     },\n731:     \"2026-02-27-set-status-context-menu.md\": {\n732:       \"status\": \"ready\",\n733:       \"description\": \"set status context menu\\n\\ncurrently there is no way to update a plan status (eg. to fix if incorrect) without triggering automation side effects. i want to be able to correct a wrong plan that got out of sync without automation picking it up\",\n734:       \"branch\": \"plan/set-status-context-menu\",\n735:       \"topic\": \"ui\",\n736:       \"created_at\": \"2026-02-27T21:10:02.331577094Z\"\n737:     },\n738:     \"2026-02-27-simplify-new-plan.md\": {\n739:       \"status\": \"done\",\n740:       \"description\": \"simplify creation of a new plan by only using one multiline input field labeled something like \\\"describe what you want to work on...\\\" as a label then use either a headless claude code call to sonnet-4-6 to derive a title or do it without ai if you can easily. descriptionw will be what the user entered\",\n741:       \"branch\": \"plan/simplify-new-plan\",\n742:       \"topic\": \"workflow\",\n743:       \"created_at\": \"2026-02-27T15:52:02.820017802Z\"\n744:     },\n745:     \"2026-02-27-tmux-session-summary.md\": {\n746:       \"status\": \"done\",\n747:       \"description\": \"show a summary of active tmux sessions that would be shown if you did shift t keybind to browse the sessions, in addition to ones that are shown that aren't in there that are already, like, adopted or were the born with the same plan\",\n748:       \"branch\": \"plan/tmux-session-summary\",\n749:       \"topic\": \"ui\",\n\n(Showing lines 715-749 of 753. Use offset=750 to continue.)\n</content>",
            "title": "docs/plans/plan-state.json",
            "metadata": {
              "preview": "      \"created_at\": \"2026-02-27T19:15:00Z\"\n    },\n    \"2026-02-27-rename-plan-menu.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename plan menu\\n\\nadd an option to rename plans in their context menu\",\n      \"branch\": \"plan/rename-plan-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n    },\n    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    },\n    \"2026-02-27-set-status-context-menu.md\": {\n      \"status\": \"ready\",\n      \"description\": \"set status context menu\\n\\ncurrently there is no way to update a plan status (eg. to fix if incorrect) without triggering automation side effects. i want to be able to correct a wrong plan that got out of sync without automation picking it up\",\n      \"branch\": \"plan/set-status-context-menu\",",
              "truncated": true,
              "loaded": []
            },
            "time": {
              "start": 1772231221823,
              "end": 1772231221825
            }
          },
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136542f001v6GSvTPYS2p2Kj"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "8d41ae825872787ed751d13d86e8c9ae3bab937c",
          "cost": 0,
          "tokens": {
            "total": 57110,
            "input": 1,
            "output": 107,
            "reasoning": 0,
            "cache": {
              "read": 56364,
              "write": 638
            }
          },
          "id": "prt_ca136626e001CIjB6z3LOKYd99",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136542f001v6GSvTPYS2p2Kj"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231221879,
          "completed": 1772231227467
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 58332,
          "input": 1,
          "output": 417,
          "reasoning": 0,
          "cache": {
            "read": 57002,
            "write": 912
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca1366277001gpP9wzfDzlc7Pe",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "8d41ae825872787ed751d13d86e8c9ae3bab937c",
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1366277001gpP9wzfDzlc7Pe"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "edit",
          "state": {
            "status": "completed",
            "input": {
              "filePath": "/home/kas/dev/kasmos/docs/plans/plan-state.json",
              "oldString": "    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    }",
              "newString": "    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now. evaluate using codex code review or some other github integration to use specific skills/review process (needs research). this should trigger for new PRs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?).\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    }"
            },
            "output": "Edit applied successfully.",
            "title": "docs/plans/plan-state.json",
            "metadata": {
              "diagnostics": {},
              "diff": "Index: /home/kas/dev/kasmos/docs/plans/plan-state.json\n===================================================================\n--- /home/kas/dev/kasmos/docs/plans/plan-state.json\n+++ /home/kas/dev/kasmos/docs/plans/plan-state.json\n@@ -722,9 +722,9 @@\n   \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n },\n \"2026-02-27-review-use-kas-verify.md\": {\n   \"status\": \"ready\",\n-  \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n+  \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now. evaluate using codex code review or some other github integration to use specific skills/review process (needs research). this should trigger for new PRs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?).\",\n   \"branch\": \"plan/review-use-kas-verify\",\n   \"topic\": \"automation\",\n   \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n },\n",
              "filediff": {
                "file": "/home/kas/dev/kasmos/docs/plans/plan-state.json",
                "before": "{\n  \"topics\": {\n    \"automation\": {\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"sidebar\": {\n      \"created_at\": \"2026-02-22T18:00:00Z\"\n    },\n    \"tools\": {\n      \"created_at\": \"2026-02-24T20:03:01Z\"\n    },\n    \"ui\": {\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"verify\": {\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"workflow\": {\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    }\n  },\n  \"plans\": {\n    \"2026-02-20-kq-init-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-plan-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-plan-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-project-skills-distribution.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-tool-discovery-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-wizard-ux-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-wizard-ux.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-agent-customize-gate.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-naming-and-toast-wrap.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-generate-opencode-jsonc-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-generate-opencode-jsonc.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-global-skill-sync.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-init-wizard-refinements.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-plan-centric-sidebar.md\": {\n      \"status\": \"cancelled\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-instance-grouping.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-lifecycle-sessions.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-rose-pine-moon-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-rose-pine-moon.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-nav-showhide.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-topics-as-collision-domains-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-topics-collision-domains.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-22-1a-tree-renderer.md\": {\n      \"status\": \"done\",\n      \"description\": \"tree-mode rendering branch in Sidebar.String() with indentation, chevrons, and status glyphs\",\n      \"branch\": \"kas/1a-tree-renderer-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1b-tree-navigation.md\": {\n      \"status\": \"done\",\n      \"description\": \"Left/Right tree-traversal methods and Space/Enter/arrow keybindings for tree-mode sidebar\",\n      \"branch\": \"kas/1b-tree-navigation-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1c-highlight-boost-list.md\": {\n      \"status\": \"done\",\n      \"description\": \"highlight-boost instance list with partition sort and dimmed rendering for non-matching instances\",\n      \"branch\": \"plan/1c-highlight-boost-list\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-2-tree-mode-wiring.md\": {\n      \"status\": \"done\",\n      \"description\": \"wire tree renderer, navigation, and highlight-boost together; remove DisableTreeMode gate\",\n      \"branch\": \"plan/2-tree-mode-wiring\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-async-metadata-tick.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-center-col-v-align.md\": {\n      \"status\": \"done\",\n      \"description\": \"center column is scrolled up slightly and also not bottom aligned\",\n      \"branch\": \"plan/center-col-v-align\",\n      \"created_at\": \"2026-02-22T08:33:42.034471509Z\"\n    },\n    \"2026-02-22-center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet.md\": {\n      \"status\": \"cancelled\",\n      \"branch\": \"plan/center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet\",\n      \"created_at\": \"2026-02-22T08:30:57.806756006Z\"\n    },\n    \"2026-02-22-customize-superpowers.md\": {\n      \"status\": \"done\",\n      \"description\": \"streamline interactions with superpowers and this app by personalizing the superpowers skills\",\n      \"branch\": \"plan/customize-superpowers\",\n      \"created_at\": \"2026-02-22T10:10:09.111289772Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-22-detect-permissions-needed.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"indicate in list view if permissions are needed and switch to live capture (or increased cache r/w if possible) to button presses dont jump back and forth\",\n      \"branch\": \"plan/detect-permissions-needed\",\n      \"created_at\": \"2026-02-22T08:35:22.645408061Z\"\n    },\n    \"2026-02-22-disable-cache-focused.md\": {\n      \"status\": \"done\",\n      \"description\": \"disable cache reading and poll tmux pane directly when focused to improve interactive experience (it glitches a lot currently)\",\n      \"branch\": \"plan/disable-cache-focused\",\n      \"created_at\": \"2026-02-22T09:56:55.401392089Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-dupe-task-after-plan-change.md\": {\n      \"status\": \"done\",\n      \"description\": \"i marked another plan done and suddenly i had 2 of another one that was running even though it hasn't switched to a review agent yet\",\n      \"branch\": \"plan/dupe-task-after-plan-change\",\n      \"created_at\": \"2026-02-22T10:00:27.703574166Z\"\n    },\n    \"2026-02-22-kq-check.md\": {\n      \"status\": \"done\",\n      \"description\": \"kq check command to audit skills sync health across all three layers (global, project, superpowers)\",\n      \"created_at\": \"2026-02-22T09:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-parallelize-superpowers.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"extract any parallelization opportunities by controlling individual task fixes (use new agent for each even if sequential)\",\n      \"branch\": \"plan/parallelize-superpowers\",\n      \"created_at\": \"2026-02-22T10:04:55.567483368Z\"\n    },\n    \"2026-02-22-planner-exit-prompt.md\": {\n      \"status\": \"done\",\n      \"description\": \"show confirmation dialog when planner finishes asking whether to start implementation\",\n      \"created_at\": \"2026-02-22T13:00:00Z\",\n      \"implemented\": \"2026-02-23\"\n    },\n    \"2026-02-22-remove-right-sidbar-right-to-focus-session.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/remove-right-sidbar-right-to-focus-session\",\n      \"created_at\": \"2026-02-22T12:15:27.104776176Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-rename-to-kasmos.md\": {\n      \"status\": \"done\",\n      \"description\": \"switch name back to kasmos and overtake that repo (rename that one to kasmold first)\",\n      \"branch\": \"plan/rename-to-kasmos\",\n      \"created_at\": \"2026-02-22T09:53:24.333455818Z\"\n    },\n    \"2026-02-22-shorten-cta.md\": {\n      \"status\": \"done\",\n      \"description\": \"drop plan from first part of cta below ascii art\",\n      \"branch\": \"plan/shorten-cta\",\n      \"created_at\": \"2026-02-22T09:54:49.026733734Z\"\n    },\n    \"2026-02-22-tab-focus-ring.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement 5-slot Tab focus ring: key defs, focusSlot state, key routing, tests, gradient, help\",\n      \"created_at\": \"2026-02-22T18:45:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-update-shortcut-hints.md\": {\n      \"status\": \"done\",\n      \"description\": \"D kill becomes K kill. i focus agent to i interactive mode. space actions becomes space shortcuts. hide P create PR and c checkout, remove R switch repo, keep the rest.\",\n      \"branch\": \"plan/update-shortcut-hints\",\n      \"created_at\": \"2026-02-22T12:12:58.588910211Z\"\n    },\n    \"2026-02-22-wave-orchestration.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement wave orchestration: plan parser, instance fields, orchestrator state machine, validation gate, prompt builder, wiring, wave badge\",\n      \"branch\": \"plan/wave-orchestration\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-23-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"description\": \"centralized FSM for plan lifecycle with flock serialization and agent sentinel files\",\n      \"branch\": \"plan/plan-state-machine\",\n      \"created_at\": \"2026-02-23T14:00:00Z\"\n    },\n    \"2026-02-23-update-ascii-art.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace KLIQUE ascii art banner with KASMOS using same ANSI Shadow font\",\n      \"branch\": \"plan/update-ascii-art\",\n      \"created_at\": \"2026-02-23T18:00:00Z\"\n    },\n    \"2026-02-24-add-episodic-memory.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"add episodic memory as a default skill when running init scaffolding command — shelved: none of the available memory plugins (episodic-memory, psychmem, hmem) are mature enough for dual-harness use yet\",\n      \"branch\": \"plan/add-episodic-memory\",\n      \"created_at\": \"2026-02-24T03:50:07.986559175Z\"\n    },\n    \"2026-02-24-clickup-import.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a feature for importing clickup tasks as plans using the official MCP server. this feature is optional and is only available when the clickup mcp server is detected. have it be an option at the bottom the plans list above history (+ import from clickup) or something like that. once the task details are downloaded, run the plan through superpowers brainstorming using a planning agent automatically to determine if it's ready for implementation or needs to be fleshed out.\",\n      \"branch\": \"plan/clickup-import\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T02:44:43.679630782Z\"\n    },\n    \"2026-02-24-live-preview-terminal.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace capture-pane polling with live EmbeddedTerminal VT emulator in preview pane, unify with focus mode\",\n      \"branch\": \"plan/live-preview-terminal\",\n      \"created_at\": \"2026-02-24T18:00:00Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-24-orphan-session-recovery.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"detect orphaned tmux sessions from plan agent crashes and let users reattach or kill them from the sidebar context menu\",\n      \"branch\": \"plan/orphan-session-recovery\",\n      \"created_at\": \"2026-02-24T04:07:00Z\"\n    },\n    \"2026-02-24-parallel-fix-agents.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"currently if the reviewer rejects an implementation, a single coder agent is spawned to address everything. instead, the reviewer agent should automatically propose what fixes need to be made that clearly states what (if anything) can be fixed in parallel. kasmos should then automatically follow those steps. the maximum parallel should follow the same rules\",\n      \"branch\": \"plan/parallel-fix-agents\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"2026-02-24-review-approval-gate.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual approval gate after automated review — two-popup flow for merge/PR before plan can be marked done\",\n      \"branch\": \"plan/review-approval-gate\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:45:00Z\"\n    },\n    \"2026-02-24-sentry-integration.md\": {\n      \"status\": \"done\",\n      \"description\": \"add sentry to the project for better debugging experience\",\n      \"branch\": \"plan/sentry-integration\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T20:03:01.389587403Z\"\n    },\n    \"2026-02-24-spring.md\": {\n      \"status\": \"done\",\n      \"description\": \"integrate harmonica to add a spring load-in animation for the kasmos logo on launch — scales from small to big — and vertically center both the logo and the call to action line below it\",\n      \"branch\": \"plan/spring\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-24T23:30:00Z\"\n    },\n    \"2026-02-24-wizard-tui-redesign.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace huh-form init wizard with full-screen bubbletea TUI using Rosé Pine Moon aesthetic\",\n      \"branch\": \"plan/wizard-tui-redesign\",\n      \"topic\": \"ui\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-25\"\n    },\n    \"2026-02-25-alt-v-not-working.md\": {\n      \"status\": \"done\",\n      \"description\": \"alt+v doesnt passthrough in interactive mode (i need for my custom variants toggle keybind)\",\n      \"branch\": \"plan/alt-v-not-working\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T18:58:19.973770029Z\"\n    },\n    \"2026-02-25-contextual-status-bar.md\": {\n      \"status\": \"done\",\n      \"description\": \"top status bar showing contextual info (wave progress, repo name, branch) based on focused/selected item\",\n      \"branch\": \"plan/contextual-status-bar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-25-enforce-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"automate cli-tools enforcement hooks installation during kas init for claude and opencode harnesses\",\n      \"branch\": \"plan/enforce-cli-tools\",\n      \"topic\": \"automation\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-25-fix-planner-missing-waves.md\": {\n      \"status\": \"done\",\n      \"description\": \"the planner agent should always use wave headers when launched via kasmos. a plan i just brainstormed had to go back to planner agent to add the headers\",\n      \"branch\": \"plan/fix-planner-missing-waves\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:40:28.678650334Z\"\n    },\n    \"2026-02-25-improve-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"update cli-tools to be more strict and ensure rg is ALWAYS used over grep as well as other tools\",\n      \"branch\": \"plan/improve-cli-tools\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-25T17:38:32.640854935Z\"\n    },\n    \"2026-02-25-new-plan-tab-cycle.md\": {\n      \"status\": \"done\",\n      \"description\": \"tab and shift tab should cycle through the 2 inputs not deselect once u reach end\",\n      \"branch\": \"plan/new-plan-tab-cycle\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T20:41:20.135133593Z\"\n    },\n    \"2026-02-25-opencode-default-harness.md\": {\n      \"status\": \"done\",\n      \"description\": \"opencode should be the default harness for each agent type, not claude\",\n      \"branch\": \"plan/opencode-default-harness\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T02:24:21.577814842Z\"\n    },\n    \"2026-02-25-prompt-via-cli.md\": {\n      \"status\": \"done\",\n      \"description\": \"instead of waiting for the session to become ready to send the prompt text, supply it via --prompt (opencode) or -p (claude) when launching the agent directly\",\n      \"branch\": \"plan/prompt-via-cli\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T17:31:48.642511235Z\"\n    },\n    \"2026-02-25-reintegrate-auto-accept.md\": {\n      \"status\": \"ready\",\n      \"branch\": \"plan/reintegrate-auto-accept\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T19:53:16.45886024Z\"\n    },\n    \"2026-02-25-scroll-overflow.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual scroll offset for list and sidebar overflow\",\n      \"branch\": \"plan/scroll-overflow\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T00:00:00Z\"\n    },\n    \"2026-02-25-show-plan-name-for-topics.md\": {\n      \"status\": \"done\",\n      \"description\": \"show the plan name you just entered when selecting a topic name because i have a bad memory and forget what plan i was adding\",\n      \"branch\": \"plan/show-plan-name-for-topics\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"2026-02-25-simplify-plan-creation.md\": {\n      \"status\": \"done\",\n      \"description\": \"add name and description for new plans to a single form popup. focuses on name by default - user can use tab navigation to the description input or use arrow down/up to navigate. hitting enter from either input creates the plan since description is optional\",\n      \"branch\": \"plan/simplify-plan-creation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    },\n    \"2026-02-25-solo-agent-mode.md\": {\n      \"status\": \"done\",\n      \"description\": \"start solo agent context menu action — single coder in worktree with minimal prompt, no wave/review lifecycle\",\n      \"branch\": \"plan/solo-agent-mode\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-26-bubblezone-mouse.md\": {\n      \"status\": \"done\",\n      \"description\": \"bubblezone zone-per-element mouse hit detection, focus-mode escape via click, SGR mouse forwarding to PTY\",\n      \"branch\": \"plan/bubblezone\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-22T08:28:43.336094301Z\"\n    },\n    \"2026-02-26-cleanup-superpowers-cmds.md\": {\n      \"status\": \"done\",\n      \"description\": \"it seems some superpowers plans keep pushing claude to use grep (specifically writing-plans just now). these should be overriden to reference their modern counterparts\",\n      \"branch\": \"plan/cleanup-superpowers-cmds\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T03:50:14.851365189Z\"\n    },\n    \"2026-02-26-details-tab.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace lazygit git tab with a read-only info tab\",\n      \"branch\": \"plan/details-tab\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T02:26:10.767895938Z\"\n    },\n    \"2026-02-26-detect-allow-perms.md\": {\n      \"status\": \"done\",\n      \"description\": \"detect when opencode is asking for perms to Allow once, Allow always, Reject. show a popup dialog allowing the user to pick then propagate their change to the session. if they choose approve always (which should be default selection), you'll send right arrow -\\u003e enter -\\u003e enter. approve once is a single enter. reject is right arrow -\\u003e right arrow -\\u003e enter\",\n      \"branch\": \"plan/detect-allow-perms\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:16:31.684660209Z\"\n    },\n    \"2026-02-26-enter-not-reachable.md\": {\n      \"status\": \"done\",\n      \"description\": \"can't reach the enter button via keyboard navigation in info tab. also move info tab to first position, agent second diff third\",\n      \"branch\": \"plan/enter-not-reachable\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T21:49:47.811876321Z\"\n    },\n    \"2026-02-26-kas-verify-loop.md\": {\n      \"status\": \"done\",\n      \"description\": \"update reviewer instructions to loop reviewer \\u003c-\\u003e fixer until all tiers pass and ALL issues have been addressed, no matter the severity\",\n      \"branch\": \"plan/kas-verify-loop\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:15:09.857895365Z\"\n    },\n    \"2026-02-26-new-plan-cli-command.md\": {\n      \"status\": \"planning\",\n      \"description\": \"kas new [title] [description] # new cli command (also runnable via kas n alias) to quickly create a new plan (no topic) with optional description via cli without having to launch tui\",\n      \"branch\": \"plan/new-cli-command\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T05:07:21.925625953Z\"\n    },\n    \"2026-02-26-no-plan-to-implement-prompt.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"you have to manually kill the planner agent before kasmos shows you the dialog to start implementation\",\n      \"branch\": \"plan/no-plan-to-implement-prompt\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T23:00:00Z\"\n    },\n    \"2026-02-26-redesign-instance-list.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-26-release-v1-0-0.md\": {\n      \"status\": \"done\",\n      \"description\": \"create github release, update versioning in project and deploy to homebrew\",\n      \"branch\": \"plan/release-v1-0-0\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T20:40:48.870776932Z\"\n    },\n    \"2026-02-26-sentry-analysis.md\": {\n      \"status\": \"ready\",\n      \"description\": \"have an agent go through sentry backlog to pick out some areas for improvement/patching\",\n      \"branch\": \"plan/sentry-analysis\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:14:59.843580163Z\"\n    },\n    \"2026-02-26-spawn-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"restore 's' keybind for spawning an agent for manual work. make sure it appears clean in the instance list but doesn't require being attached to a plan and sits outside the normal lifecycle (but can still be killed and managed the same)\",\n      \"branch\": \"plan/spawn-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T05:20:45.243395804Z\"\n    },\n    \"2026-02-26-stepthrough-worktrees.md\": {\n      \"status\": \"done\",\n      \"description\": \"stepthrough git worktree and branch usage in both standard and solo agent workflows. ensure it's being used properly, there are no gaps or incorrect commands, and we're cleanly managing history between parallel plan implementations.\",\n      \"branch\": \"plan/stepthrough-worktrees\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"2026-02-26-tmux-session-browser.md\": {\n      \"status\": \"done\",\n      \"description\": \"TUI overlay to browse, kill, and adopt orphaned tmux sessions\",\n      \"branch\": \"plan/tmux-session-browser\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T17:30:00Z\"\n    },\n    \"2026-02-26-validate-recent-merges.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"some work looks like it might've been lost or reverted, review the last few plans merged to determine what's been merged, what's been lost, and what can be recovered\",\n      \"branch\": \"plan/validate-recent-merges\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:18:22.559632982Z\"\n    },\n    \"2026-02-26-yes-keybind.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a y keybind to the instance list that sends yes to a session waiting for an answer to a yes/no question\",\n      \"branch\": \"plan/yes-keybind\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T16:42:11.713212759Z\"\n    },\n    \"2026-02-27-always-focus-sidebar.md\": {\n      \"status\": \"done\",\n      \"description\": \"the purple focus highlight and keyboard should always cling to the sidebar outside of interactive or attach mode. hitting tab required me to navigate left to get back to sidebar when it should just kept my selection and shown the agent tab instead\",\n      \"branch\": \"plan/always-focus-sidebar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T16:54:32.618130648Z\"\n    },\n    \"2026-02-27-audit-log.md\": {\n      \"status\": \"ready\",\n      \"description\": \"log all actions (new 'coder' agent spawned, finished successfully/failed, etc etc). useful for debugging but also browsing history and tracking who did what and why automatically\",\n      \"branch\": \"plan/audit-log\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T07:36:50.243680437Z\"\n    },\n    \"2026-02-27-build-custom-skills-replaced.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"build custom skills\\n\\ngenerate kasmos-specific skills that integrate the existing workflow and superpowers into a self contained, specific skillset\",\n      \"branch\": \"plan/build-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:13:27.704398153Z\"\n    },\n    \"2026-02-27-canceled-plans-delay-removal.md\": {\n      \"status\": \"done\",\n      \"description\": \"canceled plans delay removal\\n\\nafter cancelling a plan using the sidebar context menu, it remains in the list for 1-2 sec after closing the menu instead of hiding immediately even if still loading the full side effects in the background\",\n      \"branch\": \"plan/canceled-plans-delay-removal\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:36:48.99087766Z\"\n    },\n    \"2026-02-27-chat-about-this-menu-option-that-opens-up.md\": {\n      \"status\": \"ready\",\n      \"description\": \"chat about this menu option that opens up custodian agent with plan info and prompts user to ask a question\",\n      \"branch\": \"plan/chat-about-this-menu-option-that-opens-up\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T22:26:55.041161118Z\"\n    },\n    \"2026-02-27-chat-and-custodial-customizations.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename custodial to custodian and make chat/custodian agent types configurable in the setup wizard\",\n      \"branch\": \"plan/chat-and-custodial-customizations\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T22:00:00Z\"\n    },\n    \"2026-02-27-cleanup-tracked-state.md\": {\n      \"status\": \"ready\",\n      \"description\": \"cleanup tracked state\\n\\nreevaluate what files should be tracked in git. anything covered by scaffolding should probably be excluded and I'm sure there's others that we shouldn't be tracking but are (.codex, .opencode, .claude, etc). evaluate all tracked files and if they reflect best practices for the libraries/frameworks in use\",\n      \"branch\": \"plan/cleanup-tracked-state\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T17:57:15.490968411Z\"\n    },\n    \"2026-02-27-create-a-debugging-skill-and-agent-type-should.md\": {\n      \"status\": \"ready\",\n      \"description\": \"create a debugging skill and agent type (should probably replace custodian) that's equipped to handle custodian's work but more importantly, is specialized in debugging and investigating issues, tieing up loose ends and targeted verification\",\n      \"branch\": \"plan/create-a-debugging-skill-and-agent-type-should\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-27T22:07:33.623625523Z\"\n    },\n    \"2026-02-27-create-kasmos-custodial-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"create custodial agent designed to efficiently and effectively handle touchup tasks and quick fixes geared around issues or ux gaps in the kasmos workflow. things like resetting a plan's status/overriding it, finishing the development branch by merging to main or creating a pr, etc.\",\n      \"branch\": \"plan/create-kasmos-custodial-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T17:47:32.295296289Z\"\n    },\n    \"2026-02-27-ctrl-ud-pagination.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"configure ctrl+u for paginate up in agent session, d for down. it's not currently working\",\n      \"branch\": \"plan/ctrl-ud-pagination\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T07:25:38.786253804Z\"\n    },\n    \"2026-02-27-disable-cla-for-prs.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/disable-cla-for-prs\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T16:50:23.219250196Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-fix-wave-header-generation.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/fix-wave-header-generation\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T16:16:33.640848697Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md\": {\n      \"status\": \"implementing\",\n      \"description\": \"implement a custom /kas.verify tiered review process for PRs (evaluate using codex code review or some other github integration to use specific skills/review process we need to research it). this should trigger for new prs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?)\",\n      \"branch\": \"plan/implement-a-custom-kas-verify-tiered-review-process-for\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T21:57:06.660976295Z\"\n    },\n    \"2026-02-27-improve-planner-to-implementation.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"improve planner to implementation\\n\\nthe automated workflow transition doesn't work until you manually kill the agent. retest with new skills and evaluate if it needs ot be fixed. the same goes for the final stages of the lifecycle, the final review and merge/pr finalization is clunky and difficult to manuver\",\n      \"branch\": \"plan/improve-planner-to-implementation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:35:51.890862288Z\"\n    },\n    \"2026-02-27-kasmos-custom-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"audit cli-tools references, add rg deep reference, write 5 kasmos-native skills (lifecycle/planner/coder/reviewer/custodial), update agent templates and prompt builders, remove old superpowers-derived scaffolded skills\",\n      \"branch\": \"plan/kasmos-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills-design.md\": {\n      \"status\": \"done\",\n      \"description\": \"design doc for kasmos-native skills system\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace superpowers skills with 5 kasmos-native skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-new-plan-issues.md\": {\n      \"status\": \"ready\",\n      \"description\": \"new-plan-issues\\n\\ndisappears if confirmation dialog shows while making a new plan, losing all contents. also, the box gets bigger when the agent pane either loads a session or switches (due to exit, etc)\",\n      \"branch\": \"plan/new-plan-issues\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:49:21.082140797Z\"\n    },\n    \"2026-02-27-plan-review.md\": {\n      \"status\": \"done\",\n      \"description\": \"plan-review\\n\\nimplement automatic plan reviews and fixing before writing the plan and proceeding to implementation (either manual or automatic, basically last step in planning is to review the plan)\",\n      \"branch\": \"plan/plan-review\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:19:27.808935081Z\"\n    },\n    \"2026-02-27-quit-confirmation-dialog.md\": {\n      \"status\": \"done\",\n      \"description\": \"quit confirmation dialog\\n\\nshow a quit confirmation dialog when user presses q\",\n      \"branch\": \"plan/quit-confirmation-dialog\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:49:35.747504695Z\"\n    },\n    \"2026-02-27-release-1-0-0-failures.md\": {\n      \"status\": \"done\",\n      \"description\": \"check github to see the failure reasons and fix then redeploy v1.0.0\",\n      \"branch\": \"plan/release-1-0-0-failures\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T06:41:42.078871243Z\"\n    },\n    \"2026-02-27-release-v1-1.md\": {\n      \"status\": \"done\",\n      \"description\": \"release v1.1\\n\\ncreate new tag to trigger build for v1.1.0 encorporating changes since last night\",\n      \"branch\": \"plan/release-v1-1\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:07:35.357546336Z\"\n    },\n    \"2026-02-27-reliable-planner-completion.md\": {\n      \"status\": \"done\",\n      \"description\": \"make planner explicitly confirm with user before signaling completion, instead of relying on agent remembering to touch sentinel after Q\\u0026A\",\n      \"branch\": \"plan/reliable-planner-completion\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:15:00Z\"\n    },\n    \"2026-02-27-rename-plan-menu.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename plan menu\\n\\nadd an option to rename plans in their context menu\",\n      \"branch\": \"plan/rename-plan-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n    },\n    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now.\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    },\n    \"2026-02-27-set-status-context-menu.md\": {\n      \"status\": \"ready\",\n      \"description\": \"set status context menu\\n\\ncurrently there is no way to update a plan status (eg. to fix if incorrect) without triggering automation side effects. i want to be able to correct a wrong plan that got out of sync without automation picking it up\",\n      \"branch\": \"plan/set-status-context-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:10:02.331577094Z\"\n    },\n    \"2026-02-27-simplify-new-plan.md\": {\n      \"status\": \"done\",\n      \"description\": \"simplify creation of a new plan by only using one multiline input field labeled something like \\\"describe what you want to work on...\\\" as a label then use either a headless claude code call to sonnet-4-6 to derive a title or do it without ai if you can easily. descriptionw will be what the user entered\",\n      \"branch\": \"plan/simplify-new-plan\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T15:52:02.820017802Z\"\n    },\n    \"2026-02-27-tmux-session-summary.md\": {\n      \"status\": \"done\",\n      \"description\": \"show a summary of active tmux sessions that would be shown if you did shift t keybind to browse the sessions, in addition to ones that are shown that aren't in there that are already, like, adopted or were the born with the same plan\",\n      \"branch\": \"plan/tmux-session-summary\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T07:41:00.300934469Z\"\n    }\n  }\n}\n",
                "after": "{\n  \"topics\": {\n    \"automation\": {\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"sidebar\": {\n      \"created_at\": \"2026-02-22T18:00:00Z\"\n    },\n    \"tools\": {\n      \"created_at\": \"2026-02-24T20:03:01Z\"\n    },\n    \"ui\": {\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"verify\": {\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"workflow\": {\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    }\n  },\n  \"plans\": {\n    \"2026-02-20-kq-init-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-plan-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-plan-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-project-skills-distribution.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-task-orchestration.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-tool-discovery-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-20\"\n    },\n    \"2026-02-20-wizard-ux-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-20-wizard-ux.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-agent-customize-gate.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-naming-and-toast-wrap.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-fix-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-generate-opencode-jsonc-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-generate-opencode-jsonc.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-global-skill-sync.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-21-init-wizard-refinements.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-osc11-terminal-bg.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-plan-centric-sidebar.md\": {\n      \"status\": \"cancelled\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-instance-grouping.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-plan-lifecycle-sessions.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-rose-pine-moon-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-rose-pine-moon.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-nav-showhide.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-sidebar-toggle.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-21-topics-as-collision-domains-design.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-21-topics-collision-domains.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-21\"\n    },\n    \"2026-02-22-1a-tree-renderer.md\": {\n      \"status\": \"done\",\n      \"description\": \"tree-mode rendering branch in Sidebar.String() with indentation, chevrons, and status glyphs\",\n      \"branch\": \"kas/1a-tree-renderer-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1b-tree-navigation.md\": {\n      \"status\": \"done\",\n      \"description\": \"Left/Right tree-traversal methods and Space/Enter/arrow keybindings for tree-mode sidebar\",\n      \"branch\": \"kas/1b-tree-navigation-plan\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-1c-highlight-boost-list.md\": {\n      \"status\": \"done\",\n      \"description\": \"highlight-boost instance list with partition sort and dimmed rendering for non-matching instances\",\n      \"branch\": \"plan/1c-highlight-boost-list\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-2-tree-mode-wiring.md\": {\n      \"status\": \"done\",\n      \"description\": \"wire tree renderer, navigation, and highlight-boost together; remove DisableTreeMode gate\",\n      \"branch\": \"plan/2-tree-mode-wiring\",\n      \"topic\": \"sidebar\",\n      \"created_at\": \"2026-02-22T18:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-async-metadata-tick.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-center-col-v-align.md\": {\n      \"status\": \"done\",\n      \"description\": \"center column is scrolled up slightly and also not bottom aligned\",\n      \"branch\": \"plan/center-col-v-align\",\n      \"created_at\": \"2026-02-22T08:33:42.034471509Z\"\n    },\n    \"2026-02-22-center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet.md\": {\n      \"status\": \"cancelled\",\n      \"branch\": \"plan/center-pane-scrolled-up-slightly-and-isn-t-aligned-with-bottom-yet\",\n      \"created_at\": \"2026-02-22T08:30:57.806756006Z\"\n    },\n    \"2026-02-22-customize-superpowers.md\": {\n      \"status\": \"done\",\n      \"description\": \"streamline interactions with superpowers and this app by personalizing the superpowers skills\",\n      \"branch\": \"plan/customize-superpowers\",\n      \"created_at\": \"2026-02-22T10:10:09.111289772Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-22-detect-permissions-needed.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"indicate in list view if permissions are needed and switch to live capture (or increased cache r/w if possible) to button presses dont jump back and forth\",\n      \"branch\": \"plan/detect-permissions-needed\",\n      \"created_at\": \"2026-02-22T08:35:22.645408061Z\"\n    },\n    \"2026-02-22-disable-cache-focused.md\": {\n      \"status\": \"done\",\n      \"description\": \"disable cache reading and poll tmux pane directly when focused to improve interactive experience (it glitches a lot currently)\",\n      \"branch\": \"plan/disable-cache-focused\",\n      \"created_at\": \"2026-02-22T09:56:55.401392089Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-dupe-task-after-plan-change.md\": {\n      \"status\": \"done\",\n      \"description\": \"i marked another plan done and suddenly i had 2 of another one that was running even though it hasn't switched to a review agent yet\",\n      \"branch\": \"plan/dupe-task-after-plan-change\",\n      \"created_at\": \"2026-02-22T10:00:27.703574166Z\"\n    },\n    \"2026-02-22-kq-check.md\": {\n      \"status\": \"done\",\n      \"description\": \"kq check command to audit skills sync health across all three layers (global, project, superpowers)\",\n      \"created_at\": \"2026-02-22T09:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-parallelize-superpowers.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"extract any parallelization opportunities by controlling individual task fixes (use new agent for each even if sequential)\",\n      \"branch\": \"plan/parallelize-superpowers\",\n      \"created_at\": \"2026-02-22T10:04:55.567483368Z\"\n    },\n    \"2026-02-22-planner-exit-prompt.md\": {\n      \"status\": \"done\",\n      \"description\": \"show confirmation dialog when planner finishes asking whether to start implementation\",\n      \"created_at\": \"2026-02-22T13:00:00Z\",\n      \"implemented\": \"2026-02-23\"\n    },\n    \"2026-02-22-remove-right-sidbar-right-to-focus-session.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/remove-right-sidbar-right-to-focus-session\",\n      \"created_at\": \"2026-02-22T12:15:27.104776176Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-rename-to-kasmos.md\": {\n      \"status\": \"done\",\n      \"description\": \"switch name back to kasmos and overtake that repo (rename that one to kasmold first)\",\n      \"branch\": \"plan/rename-to-kasmos\",\n      \"created_at\": \"2026-02-22T09:53:24.333455818Z\"\n    },\n    \"2026-02-22-shorten-cta.md\": {\n      \"status\": \"done\",\n      \"description\": \"drop plan from first part of cta below ascii art\",\n      \"branch\": \"plan/shorten-cta\",\n      \"created_at\": \"2026-02-22T09:54:49.026733734Z\"\n    },\n    \"2026-02-22-tab-focus-ring.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement 5-slot Tab focus ring: key defs, focusSlot state, key routing, tests, gradient, help\",\n      \"created_at\": \"2026-02-22T18:45:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-22-update-shortcut-hints.md\": {\n      \"status\": \"done\",\n      \"description\": \"D kill becomes K kill. i focus agent to i interactive mode. space actions becomes space shortcuts. hide P create PR and c checkout, remove R switch repo, keep the rest.\",\n      \"branch\": \"plan/update-shortcut-hints\",\n      \"created_at\": \"2026-02-22T12:12:58.588910211Z\"\n    },\n    \"2026-02-22-wave-orchestration.md\": {\n      \"status\": \"done\",\n      \"description\": \"implement wave orchestration: plan parser, instance fields, orchestrator state machine, validation gate, prompt builder, wiring, wave badge\",\n      \"branch\": \"plan/wave-orchestration\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-22\"\n    },\n    \"2026-02-23-plan-state-machine.md\": {\n      \"status\": \"done\",\n      \"description\": \"centralized FSM for plan lifecycle with flock serialization and agent sentinel files\",\n      \"branch\": \"plan/plan-state-machine\",\n      \"created_at\": \"2026-02-23T14:00:00Z\"\n    },\n    \"2026-02-23-update-ascii-art.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace KLIQUE ascii art banner with KASMOS using same ANSI Shadow font\",\n      \"branch\": \"plan/update-ascii-art\",\n      \"created_at\": \"2026-02-23T18:00:00Z\"\n    },\n    \"2026-02-24-add-episodic-memory.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"add episodic memory as a default skill when running init scaffolding command — shelved: none of the available memory plugins (episodic-memory, psychmem, hmem) are mature enough for dual-harness use yet\",\n      \"branch\": \"plan/add-episodic-memory\",\n      \"created_at\": \"2026-02-24T03:50:07.986559175Z\"\n    },\n    \"2026-02-24-clickup-import.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a feature for importing clickup tasks as plans using the official MCP server. this feature is optional and is only available when the clickup mcp server is detected. have it be an option at the bottom the plans list above history (+ import from clickup) or something like that. once the task details are downloaded, run the plan through superpowers brainstorming using a planning agent automatically to determine if it's ready for implementation or needs to be fleshed out.\",\n      \"branch\": \"plan/clickup-import\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T02:44:43.679630782Z\"\n    },\n    \"2026-02-24-live-preview-terminal.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace capture-pane polling with live EmbeddedTerminal VT emulator in preview pane, unify with focus mode\",\n      \"branch\": \"plan/live-preview-terminal\",\n      \"created_at\": \"2026-02-24T18:00:00Z\",\n      \"implemented\": \"2026-02-24\"\n    },\n    \"2026-02-24-orphan-session-recovery.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"detect orphaned tmux sessions from plan agent crashes and let users reattach or kill them from the sidebar context menu\",\n      \"branch\": \"plan/orphan-session-recovery\",\n      \"created_at\": \"2026-02-24T04:07:00Z\"\n    },\n    \"2026-02-24-parallel-fix-agents.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"currently if the reviewer rejects an implementation, a single coder agent is spawned to address everything. instead, the reviewer agent should automatically propose what fixes need to be made that clearly states what (if anything) can be fixed in parallel. kasmos should then automatically follow those steps. the maximum parallel should follow the same rules\",\n      \"branch\": \"plan/parallel-fix-agents\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:14:58.827108721Z\"\n    },\n    \"2026-02-24-review-approval-gate.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual approval gate after automated review — two-popup flow for merge/PR before plan can be marked done\",\n      \"branch\": \"plan/review-approval-gate\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-24T23:45:00Z\"\n    },\n    \"2026-02-24-sentry-integration.md\": {\n      \"status\": \"done\",\n      \"description\": \"add sentry to the project for better debugging experience\",\n      \"branch\": \"plan/sentry-integration\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-24T20:03:01.389587403Z\"\n    },\n    \"2026-02-24-spring.md\": {\n      \"status\": \"done\",\n      \"description\": \"integrate harmonica to add a spring load-in animation for the kasmos logo on launch — scales from small to big — and vertically center both the logo and the call to action line below it\",\n      \"branch\": \"plan/spring\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-24T23:30:00Z\"\n    },\n    \"2026-02-24-wizard-tui-redesign.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace huh-form init wizard with full-screen bubbletea TUI using Rosé Pine Moon aesthetic\",\n      \"branch\": \"plan/wizard-tui-redesign\",\n      \"topic\": \"ui\",\n      \"created_at\": \"0001-01-01T00:00:00Z\",\n      \"implemented\": \"2026-02-25\"\n    },\n    \"2026-02-25-alt-v-not-working.md\": {\n      \"status\": \"done\",\n      \"description\": \"alt+v doesnt passthrough in interactive mode (i need for my custom variants toggle keybind)\",\n      \"branch\": \"plan/alt-v-not-working\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T18:58:19.973770029Z\"\n    },\n    \"2026-02-25-contextual-status-bar.md\": {\n      \"status\": \"done\",\n      \"description\": \"top status bar showing contextual info (wave progress, repo name, branch) based on focused/selected item\",\n      \"branch\": \"plan/contextual-status-bar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-25-enforce-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"automate cli-tools enforcement hooks installation during kas init for claude and opencode harnesses\",\n      \"branch\": \"plan/enforce-cli-tools\",\n      \"topic\": \"automation\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-25-fix-planner-missing-waves.md\": {\n      \"status\": \"done\",\n      \"description\": \"the planner agent should always use wave headers when launched via kasmos. a plan i just brainstormed had to go back to planner agent to add the headers\",\n      \"branch\": \"plan/fix-planner-missing-waves\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:40:28.678650334Z\"\n    },\n    \"2026-02-25-improve-cli-tools.md\": {\n      \"status\": \"done\",\n      \"description\": \"update cli-tools to be more strict and ensure rg is ALWAYS used over grep as well as other tools\",\n      \"branch\": \"plan/improve-cli-tools\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-25T17:38:32.640854935Z\"\n    },\n    \"2026-02-25-new-plan-tab-cycle.md\": {\n      \"status\": \"done\",\n      \"description\": \"tab and shift tab should cycle through the 2 inputs not deselect once u reach end\",\n      \"branch\": \"plan/new-plan-tab-cycle\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T20:41:20.135133593Z\"\n    },\n    \"2026-02-25-opencode-default-harness.md\": {\n      \"status\": \"done\",\n      \"description\": \"opencode should be the default harness for each agent type, not claude\",\n      \"branch\": \"plan/opencode-default-harness\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T02:24:21.577814842Z\"\n    },\n    \"2026-02-25-prompt-via-cli.md\": {\n      \"status\": \"done\",\n      \"description\": \"instead of waiting for the session to become ready to send the prompt text, supply it via --prompt (opencode) or -p (claude) when launching the agent directly\",\n      \"branch\": \"plan/prompt-via-cli\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T17:31:48.642511235Z\"\n    },\n    \"2026-02-25-reintegrate-auto-accept.md\": {\n      \"status\": \"ready\",\n      \"branch\": \"plan/reintegrate-auto-accept\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T19:53:16.45886024Z\"\n    },\n    \"2026-02-25-scroll-overflow.md\": {\n      \"status\": \"done\",\n      \"description\": \"manual scroll offset for list and sidebar overflow\",\n      \"branch\": \"plan/scroll-overflow\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-25T00:00:00Z\"\n    },\n    \"2026-02-25-show-plan-name-for-topics.md\": {\n      \"status\": \"done\",\n      \"description\": \"show the plan name you just entered when selecting a topic name because i have a bad memory and forget what plan i was adding\",\n      \"branch\": \"plan/show-plan-name-for-topics\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:29:04.610125585Z\"\n    },\n    \"2026-02-25-simplify-plan-creation.md\": {\n      \"status\": \"done\",\n      \"description\": \"add name and description for new plans to a single form popup. focuses on name by default - user can use tab navigation to the description input or use arrow down/up to navigate. hitting enter from either input creates the plan since description is optional\",\n      \"branch\": \"plan/simplify-plan-creation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T18:28:33.075480763Z\"\n    },\n    \"2026-02-25-solo-agent-mode.md\": {\n      \"status\": \"done\",\n      \"description\": \"start solo agent context menu action — single coder in worktree with minimal prompt, no wave/review lifecycle\",\n      \"branch\": \"plan/solo-agent-mode\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-25T22:00:00Z\"\n    },\n    \"2026-02-26-bubblezone-mouse.md\": {\n      \"status\": \"done\",\n      \"description\": \"bubblezone zone-per-element mouse hit detection, focus-mode escape via click, SGR mouse forwarding to PTY\",\n      \"branch\": \"plan/bubblezone\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-22T08:28:43.336094301Z\"\n    },\n    \"2026-02-26-cleanup-superpowers-cmds.md\": {\n      \"status\": \"done\",\n      \"description\": \"it seems some superpowers plans keep pushing claude to use grep (specifically writing-plans just now). these should be overriden to reference their modern counterparts\",\n      \"branch\": \"plan/cleanup-superpowers-cmds\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T03:50:14.851365189Z\"\n    },\n    \"2026-02-26-details-tab.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace lazygit git tab with a read-only info tab\",\n      \"branch\": \"plan/details-tab\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T02:26:10.767895938Z\"\n    },\n    \"2026-02-26-detect-allow-perms.md\": {\n      \"status\": \"done\",\n      \"description\": \"detect when opencode is asking for perms to Allow once, Allow always, Reject. show a popup dialog allowing the user to pick then propagate their change to the session. if they choose approve always (which should be default selection), you'll send right arrow -\\u003e enter -\\u003e enter. approve once is a single enter. reject is right arrow -\\u003e right arrow -\\u003e enter\",\n      \"branch\": \"plan/detect-allow-perms\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:16:31.684660209Z\"\n    },\n    \"2026-02-26-enter-not-reachable.md\": {\n      \"status\": \"done\",\n      \"description\": \"can't reach the enter button via keyboard navigation in info tab. also move info tab to first position, agent second diff third\",\n      \"branch\": \"plan/enter-not-reachable\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T21:49:47.811876321Z\"\n    },\n    \"2026-02-26-kas-verify-loop.md\": {\n      \"status\": \"done\",\n      \"description\": \"update reviewer instructions to loop reviewer \\u003c-\\u003e fixer until all tiers pass and ALL issues have been addressed, no matter the severity\",\n      \"branch\": \"plan/kas-verify-loop\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T20:15:09.857895365Z\"\n    },\n    \"2026-02-26-new-plan-cli-command.md\": {\n      \"status\": \"planning\",\n      \"description\": \"kas new [title] [description] # new cli command (also runnable via kas n alias) to quickly create a new plan (no topic) with optional description via cli without having to launch tui\",\n      \"branch\": \"plan/new-cli-command\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-26T05:07:21.925625953Z\"\n    },\n    \"2026-02-26-no-plan-to-implement-prompt.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"you have to manually kill the planner agent before kasmos shows you the dialog to start implementation\",\n      \"branch\": \"plan/no-plan-to-implement-prompt\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T23:00:00Z\"\n    },\n    \"2026-02-26-redesign-instance-list.md\": {\n      \"status\": \"done\",\n      \"created_at\": \"0001-01-01T00:00:00Z\"\n    },\n    \"2026-02-26-release-v1-0-0.md\": {\n      \"status\": \"done\",\n      \"description\": \"create github release, update versioning in project and deploy to homebrew\",\n      \"branch\": \"plan/release-v1-0-0\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-25T20:40:48.870776932Z\"\n    },\n    \"2026-02-26-sentry-analysis.md\": {\n      \"status\": \"ready\",\n      \"description\": \"have an agent go through sentry backlog to pick out some areas for improvement/patching\",\n      \"branch\": \"plan/sentry-analysis\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:14:59.843580163Z\"\n    },\n    \"2026-02-26-spawn-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"restore 's' keybind for spawning an agent for manual work. make sure it appears clean in the instance list but doesn't require being attached to a plan and sits outside the normal lifecycle (but can still be killed and managed the same)\",\n      \"branch\": \"plan/spawn-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-26T05:20:45.243395804Z\"\n    },\n    \"2026-02-26-stepthrough-worktrees.md\": {\n      \"status\": \"done\",\n      \"description\": \"stepthrough git worktree and branch usage in both standard and solo agent workflows. ensure it's being used properly, there are no gaps or incorrect commands, and we're cleanly managing history between parallel plan implementations.\",\n      \"branch\": \"plan/stepthrough-worktrees\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:12:08.563058582Z\"\n    },\n    \"2026-02-26-tmux-session-browser.md\": {\n      \"status\": \"done\",\n      \"description\": \"TUI overlay to browse, kill, and adopt orphaned tmux sessions\",\n      \"branch\": \"plan/tmux-session-browser\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-26T17:30:00Z\"\n    },\n    \"2026-02-26-validate-recent-merges.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"some work looks like it might've been lost or reverted, review the last few plans merged to determine what's been merged, what's been lost, and what can be recovered\",\n      \"branch\": \"plan/validate-recent-merges\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-26T05:18:22.559632982Z\"\n    },\n    \"2026-02-26-yes-keybind.md\": {\n      \"status\": \"done\",\n      \"description\": \"add a y keybind to the instance list that sends yes to a session waiting for an answer to a yes/no question\",\n      \"branch\": \"plan/yes-keybind\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-26T16:42:11.713212759Z\"\n    },\n    \"2026-02-27-always-focus-sidebar.md\": {\n      \"status\": \"done\",\n      \"description\": \"the purple focus highlight and keyboard should always cling to the sidebar outside of interactive or attach mode. hitting tab required me to navigate left to get back to sidebar when it should just kept my selection and shown the agent tab instead\",\n      \"branch\": \"plan/always-focus-sidebar\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T16:54:32.618130648Z\"\n    },\n    \"2026-02-27-audit-log.md\": {\n      \"status\": \"ready\",\n      \"description\": \"log all actions (new 'coder' agent spawned, finished successfully/failed, etc etc). useful for debugging but also browsing history and tracking who did what and why automatically\",\n      \"branch\": \"plan/audit-log\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T07:36:50.243680437Z\"\n    },\n    \"2026-02-27-build-custom-skills-replaced.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"build custom skills\\n\\ngenerate kasmos-specific skills that integrate the existing workflow and superpowers into a self contained, specific skillset\",\n      \"branch\": \"plan/build-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:13:27.704398153Z\"\n    },\n    \"2026-02-27-canceled-plans-delay-removal.md\": {\n      \"status\": \"done\",\n      \"description\": \"canceled plans delay removal\\n\\nafter cancelling a plan using the sidebar context menu, it remains in the list for 1-2 sec after closing the menu instead of hiding immediately even if still loading the full side effects in the background\",\n      \"branch\": \"plan/canceled-plans-delay-removal\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:36:48.99087766Z\"\n    },\n    \"2026-02-27-chat-about-this-menu-option-that-opens-up.md\": {\n      \"status\": \"ready\",\n      \"description\": \"chat about this menu option that opens up custodian agent with plan info and prompts user to ask a question\",\n      \"branch\": \"plan/chat-about-this-menu-option-that-opens-up\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T22:26:55.041161118Z\"\n    },\n    \"2026-02-27-chat-and-custodial-customizations.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename custodial to custodian and make chat/custodian agent types configurable in the setup wizard\",\n      \"branch\": \"plan/chat-and-custodial-customizations\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T22:00:00Z\"\n    },\n    \"2026-02-27-cleanup-tracked-state.md\": {\n      \"status\": \"ready\",\n      \"description\": \"cleanup tracked state\\n\\nreevaluate what files should be tracked in git. anything covered by scaffolding should probably be excluded and I'm sure there's others that we shouldn't be tracking but are (.codex, .opencode, .claude, etc). evaluate all tracked files and if they reflect best practices for the libraries/frameworks in use\",\n      \"branch\": \"plan/cleanup-tracked-state\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T17:57:15.490968411Z\"\n    },\n    \"2026-02-27-create-a-debugging-skill-and-agent-type-should.md\": {\n      \"status\": \"ready\",\n      \"description\": \"create a debugging skill and agent type (should probably replace custodian) that's equipped to handle custodian's work but more importantly, is specialized in debugging and investigating issues, tieing up loose ends and targeted verification\",\n      \"branch\": \"plan/create-a-debugging-skill-and-agent-type-should\",\n      \"topic\": \"tools\",\n      \"created_at\": \"2026-02-27T22:07:33.623625523Z\"\n    },\n    \"2026-02-27-create-kasmos-custodial-agent.md\": {\n      \"status\": \"done\",\n      \"description\": \"create custodial agent designed to efficiently and effectively handle touchup tasks and quick fixes geared around issues or ux gaps in the kasmos workflow. things like resetting a plan's status/overriding it, finishing the development branch by merging to main or creating a pr, etc.\",\n      \"branch\": \"plan/create-kasmos-custodial-agent\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T17:47:32.295296289Z\"\n    },\n    \"2026-02-27-ctrl-ud-pagination.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"configure ctrl+u for paginate up in agent session, d for down. it's not currently working\",\n      \"branch\": \"plan/ctrl-ud-pagination\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T07:25:38.786253804Z\"\n    },\n    \"2026-02-27-disable-cla-for-prs.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/disable-cla-for-prs\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T16:50:23.219250196Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-fix-wave-header-generation.md\": {\n      \"status\": \"done\",\n      \"branch\": \"plan/fix-wave-header-generation\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T16:16:33.640848697Z\",\n      \"implemented\": \"2026-02-27\"\n    },\n    \"2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md\": {\n      \"status\": \"implementing\",\n      \"description\": \"implement a custom /kas.verify tiered review process for PRs (evaluate using codex code review or some other github integration to use specific skills/review process we need to research it). this should trigger for new prs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?)\",\n      \"branch\": \"plan/implement-a-custom-kas-verify-tiered-review-process-for\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T21:57:06.660976295Z\"\n    },\n    \"2026-02-27-improve-planner-to-implementation.md\": {\n      \"status\": \"cancelled\",\n      \"description\": \"improve planner to implementation\\n\\nthe automated workflow transition doesn't work until you manually kill the agent. retest with new skills and evaluate if it needs ot be fixed. the same goes for the final stages of the lifecycle, the final review and merge/pr finalization is clunky and difficult to manuver\",\n      \"branch\": \"plan/improve-planner-to-implementation\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T18:35:51.890862288Z\"\n    },\n    \"2026-02-27-kasmos-custom-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"audit cli-tools references, add rg deep reference, write 5 kasmos-native skills (lifecycle/planner/coder/reviewer/custodial), update agent templates and prompt builders, remove old superpowers-derived scaffolded skills\",\n      \"branch\": \"plan/kasmos-custom-skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills-design.md\": {\n      \"status\": \"done\",\n      \"description\": \"design doc for kasmos-native skills system\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-kasmos-native-skills.md\": {\n      \"status\": \"done\",\n      \"description\": \"replace superpowers skills with 5 kasmos-native skills\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T00:00:00Z\"\n    },\n    \"2026-02-27-new-plan-issues.md\": {\n      \"status\": \"ready\",\n      \"description\": \"new-plan-issues\\n\\ndisappears if confirmation dialog shows while making a new plan, losing all contents. also, the box gets bigger when the agent pane either loads a session or switches (due to exit, etc)\",\n      \"branch\": \"plan/new-plan-issues\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:49:21.082140797Z\"\n    },\n    \"2026-02-27-plan-review.md\": {\n      \"status\": \"done\",\n      \"description\": \"plan-review\\n\\nimplement automatic plan reviews and fixing before writing the plan and proceeding to implementation (either manual or automatic, basically last step in planning is to review the plan)\",\n      \"branch\": \"plan/plan-review\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:19:27.808935081Z\"\n    },\n    \"2026-02-27-quit-confirmation-dialog.md\": {\n      \"status\": \"done\",\n      \"description\": \"quit confirmation dialog\\n\\nshow a quit confirmation dialog when user presses q\",\n      \"branch\": \"plan/quit-confirmation-dialog\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:49:35.747504695Z\"\n    },\n    \"2026-02-27-release-1-0-0-failures.md\": {\n      \"status\": \"done\",\n      \"description\": \"check github to see the failure reasons and fix then redeploy v1.0.0\",\n      \"branch\": \"plan/release-1-0-0-failures\",\n      \"topic\": \"verify\",\n      \"created_at\": \"2026-02-27T06:41:42.078871243Z\"\n    },\n    \"2026-02-27-release-v1-1.md\": {\n      \"status\": \"done\",\n      \"description\": \"release v1.1\\n\\ncreate new tag to trigger build for v1.1.0 encorporating changes since last night\",\n      \"branch\": \"plan/release-v1-1\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:07:35.357546336Z\"\n    },\n    \"2026-02-27-reliable-planner-completion.md\": {\n      \"status\": \"done\",\n      \"description\": \"make planner explicitly confirm with user before signaling completion, instead of relying on agent remembering to touch sentinel after Q\\u0026A\",\n      \"branch\": \"plan/reliable-planner-completion\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T19:15:00Z\"\n    },\n    \"2026-02-27-rename-plan-menu.md\": {\n      \"status\": \"done\",\n      \"description\": \"rename plan menu\\n\\nadd an option to rename plans in their context menu\",\n      \"branch\": \"plan/rename-plan-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T18:37:12.286068441Z\"\n    },\n    \"2026-02-27-review-use-kas-verify.md\": {\n      \"status\": \"ready\",\n      \"description\": \"review use kas.verify\\n\\nthe review process should use a customized version of /kas.verify to perform tiered analysis instead of the simpler review process used now. evaluate using codex code review or some other github integration to use specific skills/review process (needs research). this should trigger for new PRs (not drafts) and kasmos should monitor the state of it somewhere non-invasive like a status bar (maybe bottom left or right?).\",\n      \"branch\": \"plan/review-use-kas-verify\",\n      \"topic\": \"automation\",\n      \"created_at\": \"2026-02-27T20:18:11.25355817Z\"\n    },\n    \"2026-02-27-set-status-context-menu.md\": {\n      \"status\": \"ready\",\n      \"description\": \"set status context menu\\n\\ncurrently there is no way to update a plan status (eg. to fix if incorrect) without triggering automation side effects. i want to be able to correct a wrong plan that got out of sync without automation picking it up\",\n      \"branch\": \"plan/set-status-context-menu\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T21:10:02.331577094Z\"\n    },\n    \"2026-02-27-simplify-new-plan.md\": {\n      \"status\": \"done\",\n      \"description\": \"simplify creation of a new plan by only using one multiline input field labeled something like \\\"describe what you want to work on...\\\" as a label then use either a headless claude code call to sonnet-4-6 to derive a title or do it without ai if you can easily. descriptionw will be what the user entered\",\n      \"branch\": \"plan/simplify-new-plan\",\n      \"topic\": \"workflow\",\n      \"created_at\": \"2026-02-27T15:52:02.820017802Z\"\n    },\n    \"2026-02-27-tmux-session-summary.md\": {\n      \"status\": \"done\",\n      \"description\": \"show a summary of active tmux sessions that would be shown if you did shift t keybind to browse the sessions, in addition to ones that are shown that aren't in there that are already, like, adopted or were the born with the same plan\",\n      \"branch\": \"plan/tmux-session-summary\",\n      \"topic\": \"ui\",\n      \"created_at\": \"2026-02-27T07:41:00.300934469Z\"\n    }\n  }\n}\n",
                "additions": 1,
                "deletions": 1
              },
              "truncated": false
            },
            "time": {
              "start": 1772231227340,
              "end": 1772231227346
            }
          },
          "id": "prt_ca1366cb4002s0ev1ZZP1wlthN",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1366277001gpP9wzfDzlc7Pe"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "a0ac929f2e2a4b37627548dae9cf618916c2eb71",
          "cost": 0,
          "tokens": {
            "total": 58332,
            "input": 1,
            "output": 417,
            "reasoning": 0,
            "cache": {
              "read": 57002,
              "write": 912
            }
          },
          "id": "prt_ca1367840001lE4sbAVE7ZdphW",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1366277001gpP9wzfDzlc7Pe"
        },
        {
          "type": "patch",
          "hash": "8d41ae825872787ed751d13d86e8c9ae3bab937c",
          "files": [
            "/home/kas/dev/kasmos/docs/plans/plan-state.json"
          ],
          "id": "prt_ca136784a001dOIpDpjXrwyI6Y",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1366277001gpP9wzfDzlc7Pe"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231227469,
          "completed": 1772231233591
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 58464,
          "input": 1,
          "output": 117,
          "reasoning": 0,
          "cache": {
            "read": 57914,
            "write": 432
          }
        },
        "finish": "tool-calls",
        "id": "REDACTED",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "a0ac929f2e2a4b37627548dae9cf618916c2eb71",
          "id": "prt_ca13688c20016iUIvjMs1imWgl",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "text",
          "text": "Now cancel the implement plan:",
          "time": {
            "start": 1772231232142,
            "end": 1772231232142
          },
          "id": "prt_ca13688c2002ovTvC1fnnz0em0",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "tool",
          "callID": "REDACTED",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "kas plan set-status 2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md cancelled --force",
              "description": "Cancel the duplicate implement plan"
            },
            "output": "2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md → cancelled\n",
            "title": "Cancel the duplicate implement plan",
            "metadata": {
              "output": "2026-02-27-implement-a-custom-kas-verify-tiered-review-process-for.md → cancelled\n",
              "exit": 0,
              "description": "Cancel the duplicate implement plan",
              "truncated": false
            },
            "time": {
              "start": 1772231233436,
              "end": 1772231233455
            }
          },
          "id": "prt_ca1368aa000148Vd9yhYwyaXNZ",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "b3ea8e560cb08270e0f590724beaed8462fe70d3",
          "cost": 0,
          "tokens": {
            "total": 58464,
            "input": 1,
            "output": 117,
            "reasoning": 0,
            "cache": {
              "read": 57914,
              "write": 432
            }
          },
          "id": "prt_ca136902d001b4fl2w6ql0MN13",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        },
        {
          "type": "patch",
          "hash": "a0ac929f2e2a4b37627548dae9cf618916c2eb71",
          "files": [
            "/home/kas/dev/kasmos/docs/plans/plan-state.json"
          ],
          "id": "prt_ca1369036001qz1Nk0l5BCU61n",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "REDACTED"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231233593,
          "completed": 1772231238600
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 58657,
          "input": 1,
          "output": 151,
          "reasoning": 0,
          "cache": {
            "read": 58346,
            "write": 159
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca1369039001MW6AZgNpVpl08S",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "b3ea8e560cb08270e0f590724beaed8462fe70d3",
          "id": "prt_ca1369d7c0017NjZ6cpz50NJ6i",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1369039001MW6AZgNpVpl08S"
        },
        {
          "type": "text",
          "text": "Now clean up the branch:",
          "time": {
            "start": 1772231237300,
            "end": 1772231237300
          },
          "id": "prt_ca1369d7d00186W5Jplt4jvF0K",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1369039001MW6AZgNpVpl08S"
        },
        {
          "type": "tool",
          "callID": "toolu_01VUysuYXVsDsG1W7eVAJPUa",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "git branch -d plan/implement-a-custom-kas-verify-tiered-review-process-for 2>/dev/null || git branch -D plan/implement-a-custom-kas-verify-tiered-review-process-for 2>/dev/null || echo \"branch not found locally\"",
              "description": "Delete the cancelled plan's branch"
            },
            "output": "branch not found locally\n",
            "title": "Delete the cancelled plan's branch",
            "metadata": {
              "output": "branch not found locally\n",
              "exit": 0,
              "description": "Delete the cancelled plan's branch",
              "truncated": false
            },
            "time": {
              "start": 1772231238570,
              "end": 1772231238574
            }
          },
          "id": "prt_ca1369eb50013oyPQ467zR1Jw5",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1369039001MW6AZgNpVpl08S"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "b3ea8e560cb08270e0f590724beaed8462fe70d3",
          "cost": 0,
          "tokens": {
            "total": 58657,
            "input": 1,
            "output": 151,
            "reasoning": 0,
            "cache": {
              "read": 58346,
              "write": 159
            }
          },
          "id": "prt_ca136a3c0001mOLOnULIfglWGu",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca1369039001MW6AZgNpVpl08S"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231238601,
          "completed": 1772231241965
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 58762,
          "input": 1,
          "output": 88,
          "reasoning": 0,
          "cache": {
            "read": 58505,
            "write": 168
          }
        },
        "finish": "tool-calls",
        "id": "msg_ca136a3c9001xEOq2g5gp6xgT2",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "b3ea8e560cb08270e0f590724beaed8462fe70d3",
          "id": "REDACTED",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136a3c9001xEOq2g5gp6xgT2"
        },
        {
          "type": "tool",
          "callID": "toolu_01T6KCPoFwxCgwvK1yBSA46C",
          "tool": "bash",
          "state": {
            "status": "completed",
            "input": {
              "command": "git branch -r | rg 'implement-a-custom'",
              "description": "Check for remote branch"
            },
            "output": "",
            "title": "Check for remote branch",
            "metadata": {
              "output": "",
              "exit": 1,
              "description": "Check for remote branch",
              "truncated": false
            },
            "time": {
              "start": 1772231241931,
              "end": 1772231241934
            }
          },
          "id": "prt_ca136ad400015zvcRTMjMGMkku",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136a3c9001xEOq2g5gp6xgT2"
        },
        {
          "type": "step-finish",
          "reason": "tool-calls",
          "snapshot": "c7dcfc34abffa1cd857488cff68e821bfd0a4a7a",
          "cost": 0,
          "tokens": {
            "total": 58762,
            "input": 1,
            "output": 88,
            "reasoning": 0,
            "cache": {
              "read": 58505,
              "write": 168
            }
          },
          "id": "prt_ca136b0e3001O4cKP8h86rq5L8",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136a3c9001xEOq2g5gp6xgT2"
        },
        {
          "type": "patch",
          "hash": "b3ea8e560cb08270e0f590724beaed8462fe70d3",
          "files": [
            "/home/kas/dev/kasmos/ui/navigation_panel.go"
          ],
          "id": "prt_ca136b0eb001eKHE6Ja09z1VDa",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136a3c9001xEOq2g5gp6xgT2"
        }
      ]
    },
    {
      "info": {
        "role": "assistant",
        "time": {
          "created": 1772231241968,
          "completed": 1772231249643
        },
        "parentID": "msg_ca135a66d001GE55syAdC1BgpX",
        "modelID": "claude-opus-4-6",
        "providerID": "anthropic",
        "mode": "custodial",
        "agent": "custodial",
        "path": {
          "cwd": "/home/kas/dev/kasmos",
          "root": "/home/kas/dev/kasmos"
        },
        "cost": 0,
        "tokens": {
          "total": 58923,
          "input": 1,
          "output": 135,
          "reasoning": 0,
          "cache": {
            "read": 58673,
            "write": 114
          }
        },
        "finish": "stop",
        "id": "msg_ca136b0f00010DrTr1r5YaUdY3",
        "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab"
      },
      "parts": [
        {
          "type": "step-start",
          "snapshot": "c7dcfc34abffa1cd857488cff68e821bfd0a4a7a",
          "id": "prt_ca136c2280011mfHMFNqnfPeli",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136b0f00010DrTr1r5YaUdY3"
        },
        {
          "type": "text",
          "text": "No remote branch either — clean.\n\n**Done.** Here's what changed:\n\n1. **Merged description** from `implement-a-custom-kas-verify-tiered-review-process-for` into `review-use-kas-verify` — added the codex/github integration research requirement, PR trigger (not drafts), and status bar monitoring idea.\n2. **Cancelled** `implement-a-custom-kas-verify-tiered-review-process-for` (`implementing` → `cancelled`).\n3. No branch cleanup needed — the branch never existed locally or remotely.",
          "time": {
            "start": 1772231249559,
            "end": 1772231249559
          },
          "id": "prt_ca136c228002QTX43WZ3q7HPZU",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136b0f00010DrTr1r5YaUdY3"
        },
        {
          "type": "step-finish",
          "reason": "stop",
          "snapshot": "33bfac21582181b334d53804cf46231bcce44a6a",
          "cost": 0,
          "tokens": {
            "total": 58923,
            "input": 1,
            "output": 135,
            "reasoning": 0,
            "cache": {
              "read": 58673,
              "write": 114
            }
          },
          "id": "prt_ca136cee1001flRAKA2Z1ZLDea",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136b0f00010DrTr1r5YaUdY3"
        },
        {
          "type": "patch",
          "hash": "c7dcfc34abffa1cd857488cff68e821bfd0a4a7a",
          "files": [
            "/home/kas/dev/kasmos/docs/plans/plan-state.json"
          ],
          "id": "prt_ca136cee90018icjQ54ZjfM3AN",
          "sessionID": "ses_35ecac6d0ffeT7P5wyNhPA7vab",
          "messageID": "msg_ca136b0f00010DrTr1r5YaUdY3"
        }
      ]
    }
  ]
}
